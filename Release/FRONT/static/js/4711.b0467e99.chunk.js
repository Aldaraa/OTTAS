"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[4711],{4711:function(e,a,t){t.r(a),t.d(a,{default:function(){return F}});var n=t(29439),l=t(76047),o=t(2880),s=t(47313),r=t(58467),i=t(93031),d=t(14576),m=t(10658),c=t.n(m),u=t(1413),p=t(40765),x=t(56573),h=t(42614),f=(t(14261),t(58922)),b=t(26672),g=t(2135),v=t(46417);var D=function(e){var a,t,o=e.propData,r=e.startDate,i=(0,s.useState)(null),d=(0,n.Z)(i,2),m=d[0],u=d[1],p=(0,s.useState)(!1),h=(0,n.Z)(p,2),D=h[0],j=h[1];(0,s.useEffect)((function(){y()}),[]);var y=function(){j(!0),(0,x.Z)({method:"post",url:"tas/room/assignanalyze",data:{startDate:c()(r).format("YYYY-MM-DD"),endDate:c()(r).format("YYYY-MM-DD"),roomId:o.data.data.RoomId}}).then((function(e){u(e.data)})).finally((function(){return j(!1)}))},N=[{label:"Person #",name:"Id",alignment:"left",width:"70px"},{label:"Fullname",name:"Firstname",alignment:"left",cellRender:function(e){return(0,v.jsx)("div",{className:"flex items-center gap-3 group px-1 py-[2px]",children:(0,v.jsxs)("div",{id:"emp".concat(e.data.Id),style:{fontSize:"12px"},className:"flex items-center gap-1",children:[(0,v.jsx)("i",{className:"dx-icon-home text-green-500"}),1===e.data.Gender?(0,v.jsx)(b.FaMale,{className:"text-blue-600"}):(0,v.jsx)(b.FaFemale,{className:"text-pink-500"}),(0,v.jsx)(g.Link,{to:"/tas/roomassign/".concat(e.data.Id,"/roombooking"),target:"_blank",children:(0,v.jsxs)("span",{className:"text-blue-500 hover:underline whitespace-pre-wrap",children:[e.value," ",e.data.Lastname]})})]})})}},{label:"Department",name:"DepartmentName",alignment:"left",cellRender:function(e){return(0,v.jsx)("span",{className:"text-[12px] px-1",children:e.value})}},{label:"Employer",name:"EmployerName",alignment:"left",cellRender:function(e){return(0,v.jsx)("span",{className:"text-[12px] px-1",children:e.value})}},{label:"In Date",name:"InDate",alignment:"center",width:70,cellRender:function(e){var a=e.value;return(0,v.jsx)("span",{className:"text-[12px]",children:a?c()(a).format("YYYY-MM-DD"):null})}}],w=[{label:"Person #",name:"Id",alignment:"left",width:"70px"},{label:"Fullname",name:"Firstname",alignment:"left",cellRender:function(e){return(0,v.jsx)("div",{className:"flex items-center gap-3 group px-1 py-1",children:(0,v.jsxs)("div",{id:"emp".concat(e.data.Id),style:{fontSize:"12px"},className:"flex items-center gap-1",children:[e.data.RoomOwner?(0,v.jsx)("i",{className:"dx-icon-home text-green-500"}):(0,v.jsx)("i",{className:"dx-icon-home text-gray-400"}),1===e.data.Gender?(0,v.jsx)(b.FaMale,{className:"text-blue-600"}):(0,v.jsx)(b.FaFemale,{className:"text-pink-500"}),(0,v.jsx)(g.Link,{to:"/tas/roomassign/".concat(e.data.Id,"/roombooking"),target:"_blank",children:(0,v.jsxs)("span",{className:"cursor-pointer text-blue-500 hover:underline",children:[e.value," ",e.data.Lastname]})})]})})}},{label:"Department",name:"DepartmentName",alignment:"left",cellRender:function(e){return(0,v.jsx)("span",{className:"text-[12px]",children:e.value})}},{label:"Employer",name:"EmployerName",alignment:"left",cellRender:function(e){return(0,v.jsx)("span",{className:"text-[12px] px-1",children:e.value})}},{label:"Shift",name:"ShiftCode",alignment:"center"},{label:"Out Date",name:"OutDate",alignment:"center",width:70,cellRender:function(e){var a=e.value;return(0,v.jsx)("span",{className:"text-[12px]",children:a?c()(a).format("YYYY-MM-DD"):null})}}],S=[{key:"1",label:"Owner",children:(0,v.jsx)("div",{className:"py-4 ",children:(0,v.jsx)(f.Z,{data:null===m||void 0===m?void 0:m.ownerInfo,columns:N,focusedRowEnabled:!1,showColumnLines:!0,className:"",containerClass:"shadow-none flex-1 border pb-2 mx-4",keyExpr:"Id",pager:(null===m||void 0===m||null===(a=m.ownerInfo)||void 0===a?void 0:a.length)>20,sorting:!1,loading:D,columnAutoWidth:!0})})},{key:"2",label:"OnSite",children:(0,v.jsx)("div",{className:"py-4",children:(0,v.jsx)(f.Z,{data:null===m||void 0===m?void 0:m.GuestFutureInfo,columns:w,focusedRowEnabled:!1,showColumnLines:!0,className:"",containerClass:"shadow-none flex-1 pb-2 border mx-4",keyExpr:"Id",pager:(null===m||void 0===m||null===(t=m.HistoryInfo)||void 0===t?void 0:t.length)>20,sorting:!1,loading:D,columnAutoWidth:!0})})}];return(0,v.jsx)("div",{children:(0,v.jsx)("div",{className:"rounded-ot bg-white shadow-md",children:(0,v.jsx)(l.Z,{items:S,type:"card",size:"small"})})})};var j=function(e){var a,t=e.onSelect,l=e.fromDate,r=(0,s.useState)([]),i=(0,n.Z)(r,2),d=i[0],m=i[1],f=(0,s.useState)(!1),b=(0,n.Z)(f,2),g=b[0],j=b[1],y=(0,s.useState)(!1),N=(0,n.Z)(y,2),w=N[0],S=N[1],F=(0,s.useContext)(h.V).state,R=o.Form.useForm(),I=(0,n.Z)(R,1)[0],Y=[{label:"Camp",name:"CampId",className:"col-span-6 mb-2",type:"select",inputprops:{options:null===(a=F.referData)||void 0===a?void 0:a.camps}},{label:"Room Number",name:"RoomNumber",className:"col-span-6 mb-2"},{label:"Room Type",name:"RoomTypeId",className:"col-span-6 mb-2",type:"select",depindex:"CampId",inputprops:{optionsurl:"tas/roomtype?active=1&campId=",loading:F.customLoading,optionvalue:"Id",optionlabel:"Description"}},{label:"Bed Count",name:"BedCount",className:"col-span-6 mb-2",type:"number",inputprops:{min:0}},{label:"Private",name:"Private",className:"col-span-12 xl:col-span-6 2xl:col-span-2 mb-2",type:"check",inputprops:{indeterminatewith:!0}}],C=[{label:"Room Number",name:"roomNumber",width:"150px"},{label:"Bed #",name:"BedCount",alignment:"left"},{label:"Owner #",name:"OwnerCount",alignment:"left"},{label:"OnSite",name:"Employees",alignment:"left"},{label:"",name:"action",width:"90px",cellRender:function(e){return(0,v.jsx)("div",{className:"flex gap-4",children:(0,v.jsx)("button",{type:"button",className:"edit-button",onClick:function(){return t(e.data)},children:"Select"})})}}];return(0,v.jsxs)("div",{children:[(0,v.jsx)(o.Form,{form:I,fields:Y,size:"small",className:"border rounded-ot p-4 gap-x-8 mb-5",onFinish:function(e){j(!0),S(!0),(0,x.Z)({method:"post",url:"tas/room/roomassignavialable",data:(0,u.Z)((0,u.Z)({},e),{},{Private:e.Private,startDate:c()(l).format("YYYY-MM-DD")})}).then((function(e){m(e.data)})).catch((function(e){})).then((function(){j(!1),S(!1)}))},initValues:{Private:null},children:(0,v.jsx)("div",{className:"col-span-12 flex justify-end",children:(0,v.jsx)(o.Button,{htmlType:"submit",icon:(0,v.jsx)(p.Z,{}),loading:w,children:"Search"})})}),(0,v.jsx)(o.Table,{containerClass:"shadow-none border",columns:C,data:d,allowColumnReordering:!1,loading:g,keyExpr:"RoomId",focusedRowEnabled:!1,tableClass:"max-h-[calc(100vh-280px)]",showRowLines:!0,pager:d.length>20,renderDetail:{enabled:!0,component:function(e){return(0,v.jsx)(D,{propData:e,startDate:l})}}})]})};var y=function(e){var a=e.data,t=e.changeTab,l=(0,s.useState)(!1),r=(0,n.Z)(l,2),m=r[0],u=r[1],p=(0,s.useState)(null),f=(0,n.Z)(p,2),b=f[0],g=f[1],D=(0,s.useState)(!1),y=(0,n.Z)(D,2),N=y[0],w=y[1],S=(0,s.useState)([]),F=(0,n.Z)(S,2),R=F[0],I=F[1],Y=(0,s.useState)(!1),C=(0,n.Z)(Y,2),Z=C[0],E=C[1],k=(0,s.useContext)(h.V),M=k.action,T=k.state,B=o.Form.useForm(),P=(0,n.Z)(B,1)[0],V=o.Form.useWatch("StartDate",P),O=[{type:"component",component:(0,v.jsx)(o.Form.Item,{name:"StartDate",className:"mb-2 col-span-12",label:"First Night",children:(0,v.jsx)(i.Z,{})})},{type:"component",component:(0,v.jsx)(o.Form.Item,{noStyle:!0,shouldUpdate:function(e,a){return e.StartDate!==a.StartDate},children:function(e){var a=e.getFieldValue;e.setFieldValue;return(0,v.jsx)(o.Form.Item,{label:"Room",className:"mb-2 col-span-12",children:(0,v.jsxs)(d.Z,{direction:"horizontal",children:[(0,v.jsx)("div",{className:"w-[300px] border border-[#d9d9d9] bg-gray-50 text-gray-600 h-[30px] rounded-md p-1 px-2 flex items-center",children:null===b||void 0===b?void 0:b.Descr}),(0,v.jsx)(o.Button,{disabled:!a("StartDate"),style:{width:80},onClick:function(){return w(!0)},children:"Change"})]})})}})}],L=[{label:"#",name:"EmployeeId",alignment:"left",width:80},{label:"Fullname",name:"FullName",alignment:"left",cellRender:function(e){return(0,v.jsxs)("span",{className:"text-[12px] px-1",children:[e.data.Firstname," ",e.data.Lastname]})}},{label:"People Type",name:"PeopleTypeName",alignment:"left"},{label:"Employer",name:"EmployerName",alignment:"left"},{label:"Position",name:"PositionName",alignment:"left"}];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(o.Form,{className:"mt-4 max-w-[500px] gap-x-4",fields:O,onFinish:function(e){u(!0),(0,x.Z)({method:"post",url:"tas/roomassignment/ownership",data:{employeeId:a.Id,roomId:b.RoomId,startDate:c()(e.StartDate).format("YYYY-MM-DD")}}).then((function(e){e.data.length>0?(I(e.data),E(!0)):(M.onSuccess("Operation successful"),P.resetFields(),t("roombooking"),M.changedFlight(T.ChangedFlight+1))})).catch((function(e){})).then((function(){return u(!1)}))},initValues:{StartDate:c()()},form:P,labelCol:{flex:"110px"},wrapperCol:{flex:1},children:(0,v.jsx)(o.Form.Item,{className:"col-span-12 flex justify-end mt-2",children:(0,v.jsx)(o.Button,{htmlType:"submit",type:"primary",loading:m,children:"Process"})})}),(0,v.jsx)(o.Modal,{open:N,onCancel:function(){return w(!1)},title:"Assign room",width:900,children:(0,v.jsx)(j,{onSelect:function(e){w(!1),g(e)},fromDate:V})}),(0,v.jsx)(o.Modal,{title:"Room occupancy full",open:Z,onCancel:function(){return E(!1)},width:800,children:(0,v.jsx)(o.Table,{containerClass:"shadow-none border",columns:[{label:"Event Date",name:"EventDate",alignment:"left",cellRender:function(e){var a,t;return(0,v.jsxs)("span",{className:"text-[12px] px-1",children:[c()(e.value).format("YYYY-MM-DD")," ",(0,v.jsxs)("span",{className:"ml-2",children:["(",null===(a=e.data)||void 0===a||null===(t=a.Guests)||void 0===t?void 0:t.length,")"]})]})}}],data:R,allowColumnReordering:!1,keyExpr:"EventDate",focusedRowEnabled:!1,tableClass:"max-h-[600px]",showRowLines:!0,pager:!0,renderDetail:{enabled:!0,component:function(e){var a,t=e.data;return(0,v.jsx)(o.Table,{containerClass:"shadow-none border",columns:L,data:null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.Guests,allowColumnReordering:!1,keyExpr:"EventDate",focusedRowEnabled:!1,showRowLines:!0,pager:t.length>20})}}})})]})};var N=function(e){var a,t=e.onSelect,l=e.startDate,r=e.endDate,i=(0,s.useState)([]),d=(0,n.Z)(i,2),m=d[0],f=d[1],b=(0,s.useState)(!1),g=(0,n.Z)(b,2),D=g[0],j=g[1],y=(0,s.useState)(!1),N=(0,n.Z)(y,2),w=N[0],S=N[1],F=(0,s.useContext)(h.V).state,R=o.Form.useForm(),I=(0,n.Z)(R,1)[0];(0,s.useEffect)((function(){l&&I.setFieldValue("StartDate",l),r&&I.setFieldValue("EndDate",r)}),[l,r]);var Y=[{label:"Start Date",name:"StartDate",className:"col-span-6 mb-2",type:"date",inputprops:{disabled:!0}},{label:"End Date",name:"EndDate",className:"col-span-6 mb-2",type:"date",inputprops:{disabled:!0}},{label:"Camp",name:"CampId",className:"col-span-6 mb-2",type:"select",inputprops:{options:null===(a=F.referData)||void 0===a?void 0:a.camps}},{label:"Room Number",name:"RoomNumber",className:"col-span-6 mb-2"},{label:"Room Type",name:"RoomTypeId",className:"col-span-6 mb-2",type:"select",depindex:"CampId",inputprops:{optionsurl:"tas/roomtype?active=1&campId=",loading:F.customLoading,optionvalue:"Id",optionlabel:"Description"}},{label:"Bed Count",name:"BedCount",className:"col-span-6 mb-2",type:"number",inputprops:{min:0}},{label:"Private",name:"Private",className:"col-span-12 xl:col-span-6 2xl:col-span-2 mb-2",type:"check",inputprops:{indeterminatewith:!0}}],C=[{label:"Room Number",name:"roomNumber",width:"150px"},{label:"Bed #",name:"BedCount",alignment:"left",width:100},{label:"Owner #",name:"RoomOwners",alignment:"left",width:100},{label:"OnSite",name:"Employees",alignment:"left"},{label:"Owner In Date",name:"OwnerInDate",cellRender:function(e){var a=e.value;return(0,v.jsx)("div",{children:a?c()(a).format("YYYY-MM-DD HH:mm"):null})}},{label:"",name:"action",width:"90px",cellRender:function(e){return(0,v.jsx)("div",{className:"flex gap-4",children:(0,v.jsx)("button",{type:"button",className:"edit-button",onClick:function(){return t(e.data)},children:"Select"})})}}];return(0,v.jsxs)("div",{children:[(0,v.jsx)(o.Form,{form:I,fields:Y,size:"small",className:"border rounded-ot p-4 gap-x-8 mb-5",initValues:{Private:null},onFinish:function(e){var a;j(!0),S(!0),(0,x.Z)({method:"post",url:"tas/roomassignment/findavailablebydatesassignment",data:(0,u.Z)((0,u.Z)({},e),{},{EmployeeId:null===(a=F.userProfileData)||void 0===a?void 0:a.Id,Private:e.Private,StartDate:c()(e.StartDate).format("YYYY-MM-DD"),EndDate:c()(e.EndDate).format("YYYY-MM-DD")})}).then((function(e){f(e.data)})).catch((function(e){})).then((function(){j(!1),S(!1)}))},children:(0,v.jsx)("div",{className:"col-span-12 flex justify-end",children:(0,v.jsx)(o.Button,{htmlType:"submit",icon:(0,v.jsx)(p.Z,{}),loading:w,children:"Search"})})}),(0,v.jsx)(o.Table,{containerClass:"shadow-none border",columns:C,data:m,allowColumnReordering:!1,loading:D,keyExpr:"RoomId",focusedRowEnabled:!1,tableClass:"max-h-[500px]",showRowLines:!0,pager:!0,renderDetail:{enabled:!0,component:function(e){return(0,v.jsx)(o.ExpandRowRoomDetail,{propData:e,startDate:l,endDate:r})}}})]})};var w=function(e){var a=e.data,t=e.changeTab,l=(0,s.useState)(!1),i=(0,n.Z)(l,2),m=i[0],p=i[1],h=(0,s.useState)(null),f=(0,n.Z)(h,2),b=f[0],g=f[1],D=(0,s.useState)(null),j=(0,n.Z)(D,2),y=j[0],w=j[1],S=(0,s.useState)(!1),F=(0,n.Z)(S,2),R=F[0],I=F[1],Y=(0,s.useState)(!1),C=(0,n.Z)(Y,2),Z=C[0],E=C[1],k=(0,s.useState)([]),M=(0,n.Z)(k,2),T=M[0],B=M[1],P=o.Form.useForm(),V=(0,n.Z)(P,1)[0],O=((0,r.s0)(),[{label:"First Night",name:"StartDate",className:"col-span-12 mb-2",type:"date",inputprops:{}},{label:"Last Night",name:"EndDate",className:"col-span-12 mb-2",type:"date",inputprops:{}},{type:"component",component:(0,v.jsx)(o.Form.Item,{noStyle:!0,shouldUpdate:function(e,a){return e.StartDate!==a.StartDate||e.EndDate!==a.EndDate},children:function(e){var a=e.getFieldValue;e.setFieldValue;return(0,v.jsx)(o.Form.Item,{label:"Room",name:"RoomId",className:"mb-2 col-span-12",children:(0,v.jsxs)(d.Z,{direction:"horizontal",children:[(0,v.jsx)("div",{className:"w-[300px] border border-[#d9d9d9] bg-gray-50 text-gray-600 h-[30px] rounded-md p-1 px-2 flex items-center",children:null===y||void 0===y?void 0:y.Descr}),(0,v.jsx)(o.Button,{disabled:!a("StartDate")||!a("EndDate"),style:{width:80},onClick:L,children:"Change"})]})})}})}]),L=function(){g({StartDate:V.getFieldValue("StartDate"),EndDate:V.getFieldValue("EndDate")}),I(!0)},z=[{label:"Date",name:"EventDate",cellRender:function(e){return(0,v.jsx)("div",{children:c()(e.value).format("YYYY-MM-DD")})}},{label:"Room Number",name:"RoomNumber",cellRender:function(e){return(0,v.jsx)("div",{children:e.value})}},{label:"Bed Number",name:"BedDescr"}];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(o.Form,{className:"mt-4 max-w-[500px] gap-x-4",fields:O,onFinish:function(e){p(!0),(0,x.Z)({method:"post",url:"tas/roomassignment/temporary",data:(0,u.Z)((0,u.Z)({},e),{},{EndDate:e.EndDate?c()(e.EndDate).format("YYYY-MM-DD"):null,StartDate:e.StartDate?c()(e.StartDate).format("YYYY-MM-DD"):null,employeeId:a.Id,roomId:null===y||void 0===y?void 0:y.RoomId})}).then((function(e){e.data.BedInfo.length>0?(B(e.data.BedInfo),E(!0)):(V.resetFields(),t("roombooking"))})).catch((function(e){})).then((function(){return p(!1)}))},form:V,labelCol:{flex:"110px"},wrapperCol:{flex:1},children:(0,v.jsx)(o.Form.Item,{className:"col-span-12 flex justify-end mt-2",children:(0,v.jsx)(o.Button,{htmlType:"submit",type:"primary",loading:m,children:"Process"})})}),(0,v.jsx)(o.Modal,{open:R,onCancel:function(){return I(!1)},title:"Assign room",width:900,children:(0,v.jsx)(N,{onSelect:function(e){I(!1),w(e)},startDate:null===b||void 0===b?void 0:b.StartDate,endDate:null===b||void 0===b?void 0:b.EndDate})}),(0,v.jsx)(o.Modal,{open:Z,onCancel:function(){return E(!1)},children:(0,v.jsx)(o.Table,{data:T,columns:z,title:(0,v.jsx)("div",{className:"border-b text-sm font-bold py-2",children:"Booked Data"})})})]})};var S=function(e){var a=e.data,t=(e.changeTab,(0,s.useState)(!1)),l=(0,n.Z)(t,2),r=l[0],d=l[1],m=(0,s.useContext)(h.V),u=m.action,p=m.state,f=o.Form.useForm(),b=(0,n.Z)(f,1)[0],g=[{type:"component",component:(0,v.jsx)(o.Form.Item,{name:"StartDate",className:"mb-2 col-span-12",label:"Start Date",rules:[{required:!0,message:"Start date is required"}],children:(0,v.jsx)(i.Z,{})})}];return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(o.Form,{className:"mt-4 max-w-[500px] gap-x-4",fields:g,onFinish:function(e){d(!0),(0,x.Z)({method:"post",url:"tas/roomassignment/removeownership",data:{employeeId:a.Id,startDate:c()(e.StartDate).format("YYYY-MM-DD")}}).then((function(e){b.resetFields(),u.changedFlight(p.ChangedFlight+1)})).catch((function(e){})).then((function(){return d(!1)}))},form:b,labelCol:{flex:"150px"},wrapperCol:{flex:1},initValues:{StartDate:c()()},children:(0,v.jsx)(o.Form.Item,{className:"col-span-12 flex justify-end mt-2",children:(0,v.jsx)(o.Button,{htmlType:"submit",type:"primary",loading:r,children:"Process"})})})})};var F=function(){var e=(0,r.V4)("assignRoomLayout"),a=(0,s.useState)("roombooking"),t=(0,n.Z)(a,2),i=t[0],d=t[1],m=(0,s.useMemo)((function(){var a=[{label:"Room Booking",key:"roombooking",children:(0,v.jsx)(o.ByPersonExtended,{empData:e,changeTab:function(e){return d(e)}})},{label:"Assign Room Ownership",key:"ownership",children:(0,v.jsx)(y,{data:e,changeTab:function(e){return d(e)}})},{label:"Temporary Room Move",key:"temporary",children:(0,v.jsx)(w,{data:e,changeTab:function(e){return d(e)}})}];return null!==e&&void 0!==e&&e.RoomId&&a.push({label:"Remove Ownership",key:"remove",children:(0,v.jsx)(S,{data:e,changeTab:function(e){return d(e)}})}),a}),[e]);return(0,v.jsx)("div",{className:"bg-white p-4 rounded-ot ",children:(0,v.jsx)(l.Z,{activeKey:i,items:m,destroyInactiveTabPane:!0,onChange:function(e){return d(e)},type:"card"})})}}}]);