"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[7737],{37737:function(e,t,a){a.r(t),a.d(t,{default:function(){return q}});var n=a(29439),l=a(93433),s=a(47313),o=a(2880),u=a(23495),r=a(56573),i=a(58467),d=a(2135),c=a(42614),p=a(10658),m=a.n(p),f=a(76629),g=a(56385),v=a.n(g),h=a(1413),b=a(55080),x=a(40765),y=a(31283),D=a(73030),S=a(46417);function N(e,t){var a=!1;return e.length===t.length&&e.forEach((function(e){a=t.includes(e)})),a}var E=["StartDate","EndDate","Id","DocumentType","requestDocumentSearchCurrentStep"],C=["StartDate","EndDate","Id","DocumentType","requestDocumentSearchCurrentStep","ApprovelType","LastModifiedDate","AssignedEmployeeId","EmployerId","RequestedEmployeeId","Keyword"],Z=[{label:"Start Date",value:"StartDate"},{label:"End Date",value:"EndDate"},{label:"Request #",value:"Id"},{label:"Document Type",value:"DocumentType"},{label:"Current Step",value:"requestDocumentSearchCurrentStep"},{label:"Approvel Type",value:"ApprovelType"},{label:"Last Modified",value:"LastModifiedDate"},{label:"Assigned To",value:"AssignedEmployeeId"},{label:"Employer",value:"EmployerId"},{label:"Requested By",value:"RequestedEmployeeId"},{label:"Keyword",value:"Keyword"}];var w=function(e){var t,a,u,i,d,p,g,v,w,I=e.onFinish,T=e.form,j=e.containerClass,q=void 0===j?"":j,A=f.Z.get("tr"),F=f.Z.get("tFields")?f.Z.get("tFields"):[],k=function(e){var t=!0;return e&&(t=!(m()(e)-m()().subtract(1,"hour")>0)),t}(null===A||void 0===A?void 0:A.date)?null:A.sf,R=(0,s.useState)([]),M=(0,n.Z)(R,2),L=M[0],V=M[1],Y=(0,s.useState)([]),z=(0,n.Z)(Y,2),K=z[0],B=z[1],H=(0,s.useState)(F.length>0?F:E),P=(0,n.Z)(H,2),G=P[0],U=P[1],O=(0,s.useState)(!0),W=(0,n.Z)(O,2),_=W[0],J=W[1],Q=(0,s.useState)(!1),X=(0,n.Z)(Q,2),$=X[0],ee=X[1],te=(0,s.useState)(!1),ae=(0,n.Z)(te,2),ne=ae[0],le=ae[1],se=(0,s.useContext)(c.V).state,oe=(0,s.useContext)(c.V);(0,s.useEffect)((function(){ue(),re()}),[]);var ue=function(){(0,r.Z)({method:"get",url:"tas/requestgroupemployee"}).then((function(e){var t,a=[];null===(t=e.data)||void 0===t||t.map((function(e){a.push({value:e.EmployeeId,label:e.FullName})})),V(a)})).catch((function(e){}))},re=function(){(0,r.Z)({method:"get",url:"tas/requestgroup"}).then((function(e){var t,a=[];null===(t=e.data)||void 0===t||t.map((function(e){a.push({value:e.Id,label:e.Description})})),B(a)})).catch((function(e){}))},ie=[{label:"Start Date",name:"StartDate",className:"col-span-6 xl:col-span-4 mb-2",type:"date",inputprops:{className:"w-full"}},{label:"End Date",name:"EndDate",className:"col-span-6 xl:col-span-4 mb-2",type:"date",inputprops:{className:"w-full"}},{label:"Request #",name:"Id",className:"col-span-6 xl:col-span-4 mb-2",type:"number",inputprops:{className:"w-full"}},{label:"Document Type",name:"DocumentType",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",allowClear:!1,options:null!==(t=se.referData)&&void 0!==t&&null!==(a=t.master)&&void 0!==a&&a.documentTypes?[{value:null,label:"All"}].concat((0,l.Z)(null===(u=se.referData)||void 0===u||null===(i=u.master)||void 0===i?void 0:i.documentTypes)):[]}},{label:"Current Step",name:"requestDocumentSearchCurrentStep",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",allowClear:!1,options:null!==(d=se.referData)&&void 0!==d&&null!==(p=d.master)&&void 0!==p&&p.searchCurrentSteps?[{value:null,label:"All"}].concat((0,l.Z)(null===(g=se.referData)||void 0===g||null===(v=g.master)||void 0===v?void 0:v.searchCurrentSteps)):[]}},{label:"Approvel Type",name:"ApprovelType",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",options:K}},{label:"Last Modified",name:"LastModifiedDate",className:"col-span-6 xl:col-span-4 mb-2",type:"date",inputprops:{className:"w-full"}},{label:"Assigned To",name:"AssignedEmployeeId",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",options:L}},{label:"Employer",name:"EmployerId",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",options:null===(w=oe.state.referData)||void 0===w?void 0:w.employers}},{label:"Requested By",name:"RequestedEmployeeId",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"max-w-[300px]",options:L}},{label:"Keyword",name:"Keyword",className:"col-span-6 xl:col-span-4 mb-2"}],de=(0,s.useMemo)((function(){return ie.filter((function(e){return G.includes(e.name)}))}),[G,L,K]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:(0,D.m6)("rounded-ot bg-white p-5 mb-5 shadow-md",q),children:[(0,S.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,S.jsx)("div",{className:"text-lg font-bold mb-3",children:"Search Task"}),(0,S.jsx)(o.Button,{htmlType:"button",onClick:function(){return le(!0)},className:"px-2",icon:(0,S.jsx)(b.Z,{style:{fontSize:"16px"}}),children:"Filter"})]}),(0,S.jsx)(o.Form,{form:T,fields:de,className:"grid grid-cols-12 gap-x-8",onFinish:I,initValues:k?(0,h.Z)((0,h.Z)({},k.model),{},{StartDate:k.model.StartDate?m()(k.model.StartDate):null,EndDate:k.model.EndDate?m()(k.model.EndDate):null}):{StartDate:m()().subtract(14,"day"),EndDate:m()(),Id:"",DocumentType:null,requestDocumentSearchCurrentStep:"Pending",ApprovelType:null,LastModifiedDate:null,AssignedEmployeeId:null,EmployerId:null,RequestedEmployeeId:null,Keyword:""},children:(0,S.jsx)("div",{className:"col-span-12 flex gap-4 justify-end mt-5",children:(0,S.jsx)(o.Button,{htmlType:"submit",icon:(0,S.jsx)(x.Z,{}),children:"Search"})})})]}),(0,S.jsxs)(o.Modal,{open:ne,onCancel:function(){return le(!1)},title:"Filter fields",children:[(0,S.jsxs)("div",{className:"pb-2 mb-2 border-b",children:[(0,S.jsx)(y.Z,{indeterminate:_,checked:$,onChange:function(e){var t=e.target.checked?C:[];f.Z.set("tFields",t),U(t),J(!1),ee(e.target.checked)},children:"Select All"},"selectAll"),(0,S.jsx)(y.Z,{checked:N(E,G),onChange:function(e){var t=e.target.checked?E:[];f.Z.set("tFields",t),U(t),J(t.length<C.length)},children:"Default"},"default")]}),(0,S.jsx)(y.Z.Group,{style:{width:"100%"},value:G,onChange:function(e){f.Z.set("tFields",e);var t=Z.map((function(e){return e.value}));U(e),J(!!e.length&&e.length<t.length),ee(e.length===t.length)},children:(0,S.jsx)("div",{className:"grid grid-cols-12 gap-x-5",children:Z.map((function(e,t){return(0,S.jsx)("div",{className:"col-span-6",children:(0,S.jsx)(y.Z,{value:e.value,children:e.label},"filter-check-item-".concat(t))},"check-box-".concat(t))}))})})]})]})},I=function(e){var t=!0;return e&&(t=!(m()(e)-m()().subtract(1,"hour")>0)),t},T=function(e){if("Non Site Travel"===e.data.DocumentType)return"/guest/request/nonsitetravel/".concat(e.data.Id);if("Profile Changes"===e.data.DocumentType)return"/guest/request/profilechanges/".concat(e.data.Id);if("De Mobilisation"===e.data.DocumentType)return"/guest/request/de-mobilisation/".concat(e.data.Id);if("Site Travel"===e.data.DocumentType){if("ADD"===e.data.DocumentTag)return"/guest/request/sitetravel/addtravel/".concat(e.data.Id);if("RESCHEDULE"===e.data.DocumentTag)return"/guest/request/sitetravel/reschedule/".concat(e.data.Id);if("REMOVE"===e.data.DocumentTag)return"/guest/request/sitetravel/remove/".concat(e.data.Id)}},j=function(e,t){var a=(0,l.Z)(e);t&&v()(t).map((function(e){a[e].groupIndex=t[e]}));return a};var q=function(){var e=f.Z.get("tr"),t=f.Z.get("grouping"),a=I(null===e||void 0===e?void 0:e.date)?null:e.sf,l=I(null===e||void 0===e?void 0:e.date)?null:e.rd,p=(0,i.TH)(),g=(0,s.useState)(l?l.data:[]),h=(0,n.Z)(g,2),b=h[0],x=h[1],y=(0,s.useState)(l?l.totalcount:0),N=(0,n.Z)(y,2),E=N[0],C=N[1],Z=(0,s.useState)(a?a.pageIndex:0),q=(0,n.Z)(Z,2),A=q[0],F=q[1],k=(0,s.useState)(a?a.pageSize:100),R=(0,n.Z)(k,2),M=R[0],L=R[1],V=(0,s.useContext)(c.V).state,Y=(0,s.useContext)(c.V),z=((0,i.s0)(),o.Form.useForm()),K=(0,n.Z)(z,1)[0],B=(0,s.useRef)(null);(0,s.useEffect)((function(){p.state&&K.setFieldValue(p.state.name,p.state.value),e||H(),Y.action.changeMenuKey("/request/task")}),[]),(0,s.useEffect)((function(){b.length>0&&H()}),[A,M]);var H=function(){var e;null===(e=B.current)||void 0===e||e.instance.beginCustomLoading(),(0,r.Z)({method:"post",url:"tas/requestdocument/documentlist",data:{model:K.getFieldsValue(),pageIndex:A,pageSize:M}}).then((function(e){x(e.data.data),C(e.data.totalcount)})).finally((function(){var e;return null===(e=B.current)||void 0===e?void 0:e.instance.endCustomLoading()}))},P=[{label:"",name:"DaysAway",dataType:"string",width:"45px",alignment:"left",cellRender:function(e){var t=e.value;return(0,S.jsx)(o.Tooltip,{title:"Days Away",children:(0,S.jsx)("div",{className:(0,D.m6)("py-[1px] px-[3px] rounded inline-block text-xs min-w-[30px] text-center",t>5?"bg-green-600 text-white":0<t&&t<=5?"bg-orange-500 text-white":"bg-red-500 text-white"),children:t})})}},{label:"#",name:"Id",dataType:"string",width:"65px",cellRender:function(e){return(0,S.jsx)("div",{className:"flex items-center text-blue-500 hover:underline",children:(0,S.jsx)(d.Link,{to:T(e),children:e.value})})}},{label:"CurrentStatus",name:"CurrentStatusGroup",alignment:"left"},{label:"Description",name:"Description",alignment:"left"},{label:"Employer",name:"EmployerName",alignment:"left"},{label:"Subject",name:"EmployeeFullName",alignment:"left"},{label:"Date Requested",name:"RequestedDate",alignment:"left",width:80,cellRender:function(e){return(0,S.jsx)("div",{children:m()(e.value).format("YYYY-MM-DD ddd HH:mm")})}},{label:"Assigned To",name:"AssignedEmployeeFullName",alignment:"left",width:120,cellRender:function(e){return(0,S.jsx)("div",{className:V.userInfo.Id===e.data.AssignedEmployeeId?"font-bold":"",children:e.value})}},{label:"Requester",name:"RequesterFullName",alignment:"left",width:120},{label:"Updated",name:"UpdatedInfo",alignment:"left"}];return(0,S.jsxs)("div",{children:[(0,S.jsx)(d.Link,{to:"/guest",children:(0,S.jsx)(o.Button,{icon:(0,S.jsx)(u.Z,{}),children:"Back"})}),(0,S.jsx)(w,{containerClass:"shadow-none border mt-3",form:K,onFinish:function(e){var t;null===(t=B.current)||void 0===t||t.instance.beginCustomLoading(),(0,r.Z)({method:"post",url:"tas/requestdocument/documentlist",data:{model:e,pageIndex:A,pageSize:M}}).then((function(t){f.Z.set("tr",{rd:t.data,sf:{model:e,pageIndex:A,pageSize:M},date:m()().format("YYYY-MM-DD HH:mm")}),x(t.data.data),C(t.data.totalcount)})).finally((function(){var e;return null===(e=B.current)||void 0===e?void 0:e.instance.endCustomLoading()}))}}),(0,S.jsx)(o.CustomTable,{ref:B,data:b,keyExpr:"Id",columns:j(P,t),onChangePageSize:function(e){return L(e)},onChangePageIndex:function(e){return F(e)},pageSize:M,pageIndex:A,totalCount:E,pagerPosition:"top",isGrouping:!0,columnAutoWidth:!0,showColumnLines:!1,wordWrapEnabled:!0,onOptionChanged:function(e){if("columns"===e.name&&e.fullName.includes("groupIndex")){var t=f.Z.get("grouping")?f.Z.get("grouping"):{};if(void 0!==typeof e.value)t[e.fullName[8]]=e.value,f.Z.set("grouping",t);else if(void 0!==typeof e.previousValue){var a=v()(t);a.filter((function(t){return t!==e.fullName[8]}));var n={};a.map((function(e,t){return n[e]=t})),f.Z.set("grouping",n)}}},tableClass:"max-h-[calc(100vh-200px)]",containerClass:"shadow-none border"})]})}}}]);