"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[7742],{77742:function(e,t,n){n.r(t);var a=n(1413),l=n(29439),o=n(2880),s=n(47313),i=n(65040),r=n(29074),c=n(40765),d=n(42614),u=n(10658),p=n.n(u),m=n(56573),f=n(14261),h=n(38209),x=n(46417);t.default=function(){var e,t,n,u,v,b,g,j=(0,s.useState)([]),D=(0,l.Z)(j,2),Z=D[0],S=D[1],C=(0,s.useState)(0),y=(0,l.Z)(C,2),N=y[0],w=y[1],E=(0,s.useState)(0),k=(0,l.Z)(E,2),F=k[0],I=k[1],B=(0,s.useState)(100),T=(0,l.Z)(B,2),M=T[0],R=T[1],Y=(0,s.useState)(!1),L=(0,l.Z)(Y,2),P=L[0],A=L[1],z=(0,s.useState)(null),V=(0,l.Z)(z,2),O=V[0],H=V[1],W=i.Z.useForm(),q=(0,l.Z)(W,1)[0],G=(0,s.useContext)(d.V),J=G.action,K=G.state,U=(0,s.useRef)(null),_={DepartLocationId:null===(e=K.referData)||void 0===e||null===(t=e.locations)||void 0===t?void 0:t.find((function(e){return"UB"===e.Code})).Id,ArriveLocationId:null===(n=K.referData)||void 0===n||null===(u=n.locations)||void 0===u?void 0:u.find((function(e){return"OT"===e.Code})).Id};(0,s.useEffect)((function(){J.changeMenuKey("/tas/busstop"),$(q.getFieldsValue())}),[]),(0,s.useEffect)((function(){Z.length>0&&$(q.getFieldsValue())}),[F,M]);var $=function(e){var t;null===(t=U.current)||void 0===t||t.instance.beginCustomLoading(),(0,m.Z)({method:"post",url:"tas/transportschedule/busstopschedule",data:{model:(0,a.Z)((0,a.Z)({},e),{},{StartDate:e.StartDate?p()(e.StartDate).format("YYYY-MM-DD"):"",EndDate:e.EndDate?p()(e.EndDate).format("YYYY-MM-DD"):""}),pageIndex:F,pageSize:M}}).then((function(e){S(e.data.data),w(e.data.totalcount)})).finally((function(){var e;return null===(e=U.current)||void 0===e?void 0:e.instance.endCustomLoading()}))},Q=[{label:"Mode",name:"TransportModeId",className:"col-span-12 lg:col-span-6 mb-2",type:"select",inputprops:{options:null===(v=K.referData)||void 0===v?void 0:v.transportModes}},{label:"Transport Code",name:"Code",className:"col-span-12 lg:col-span-6 mb-2"},{label:"Port Of Departure",name:"DepartLocationId",className:"col-span-12 lg:col-span-6 mb-2",type:"select",inputprops:{options:null===(b=K.referData)||void 0===b?void 0:b.locations}},{label:"Port Of Arrive",name:"ArriveLocationId",className:"col-span-12 lg:col-span-6 mb-2",type:"select",inputprops:{options:null===(g=K.referData)||void 0===g?void 0:g.locations}},{label:"Start Date",name:"StartDate",className:"col-span-12 lg:col-span-6 mb-2",type:"date",inputprops:{showWeek:!0}},{label:"End Date",name:"EndDate",className:"col-span-12 lg:col-span-6 mb-2",type:"date",inputprops:{showWeek:!0}}],X=[{label:"Travel Date",name:"EventDate",alignment:"left",groupIndex:0,cellRender:function(e){return(0,x.jsx)("div",{children:p()(e.value).format("YYYY-MM-DD")})}},{label:"Code",name:"Code",alignment:"left"},{label:"Description",name:"Description",alignment:"left"},{label:"Type",name:"Special",alignment:"center",cellRender:function(e,t){return(0,x.jsx)(f.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})}},{label:"Mode",name:"TransportMode",alignment:"left",width:80},{label:"Direction",name:"Direction",alignment:"center",width:80,cellRender:function(e){return e.value&&(0,x.jsx)(r.Z,{color:"IN"===e.value?"green":"OUT"===e.value?"blue":"magenta",className:"text-center text-[10px] font-semibold",children:e.value})}},{label:"Seats #",name:"Seats",width:60,alignment:"center"},{label:"Available Seats",name:"availableseats",alignment:"center",width:140,cellRender:function(e){var t=e.data.Seats-e.data.Confirmed;return e.data.Confirmed,(0,x.jsx)("div",{className:"".concat(t<=0?"text-red-500 font-bold":"text-green-600 font-bold"),children:t})}},{label:"EventDateETD",name:"EventDateETD",alignment:"left",width:130,cellRender:function(e){return(0,x.jsx)("div",{children:p()(e.value).format("HH:mm")})}},{label:"EventDateETA",name:"EventDateETA",alignment:"left",width:130,cellRender:function(e){return(0,x.jsx)("div",{children:p()(e.value).format("HH:mm")})}},{label:"Bus Stop",name:"BusstopStatus",alignment:"left",cellRender:function(e){return(0,x.jsx)(f.Jg,{value:!!e.value,disabled:!0,iconSize:18})}},{label:"",name:"buttons",alignment:"left",width:100,cellRender:function(e){return(0,x.jsx)("button",{type:"button",className:"edit-button",onClick:function(t){return n=e.data,A(!0),void H(n);var n},children:"Bus Stop"})}}];return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"rounded-ot bg-white px-3 py-2 mb-3 shadow-md",children:[(0,x.jsx)("div",{className:"text-lg font-bold mb-2",children:"Bus Stop Schedule"}),(0,x.jsx)(o.Form,{form:q,fields:Q,className:"grid grid-cols-12 gap-x-8 max-w-[800px]",onFinish:$,size:"small",initValues:{TransportModeId:null,DepartLocationId:_.DepartLocationId,ArriveLocationId:_.ArriveLocationId,Code:"",StartDate:p()(),EndDate:p()().add(1,"days")},children:(0,x.jsx)("div",{className:"flex gap-4 items-baseline col-span-12 justify-end",children:(0,x.jsx)(o.Button,{htmlType:"submit",icon:(0,x.jsx)(c.Z,{}),children:"Search"})})})]}),(0,x.jsx)(o.CustomTable,{ref:U,data:Z,keyExpr:"Id",columns:X,onChangePageSize:function(e){return R(e)},onChangePageIndex:function(e){return I(e)},pageSize:M,pageIndex:F,totalCount:N,isGroupedCount:!0,isGrouping:!0,showColumnLines:!1,wordWrapEnabled:!0,pagerPosition:"top",tableClass:"max-h-[calc(100vh-335px)] rounded-none border-none"})]}),(0,x.jsx)(h.Z,{open:P,onCancel:function(){return A(!1)},title:"Set Bus Stop (".concat(p()(null===O||void 0===O?void 0:O.EventDate).format("YYYY-MM-DD"),")"),width:800,rowData:O,onReset:function(){$(q.getFieldsValue()),A(!1),H(null)}})]})}},78373:function(e,t,n){var a=n(1413),l=n(29439),o=n(36459),s=n(47515),i=n(82138),r=n(74294),c=n(23983),d=n(87785),u=n(14576),p=n(21975),m=n(56573),f=n(2880),h=n(47313),x=n(46417);t.Z=function(e){var t=Object.assign({},((0,o.Z)(e),e)),n=(0,h.useState)([]),v=(0,l.Z)(n,2),b=v[0],g=v[1],j=(0,h.useState)(""),D=(0,l.Z)(j,2),Z=D[0],S=D[1],C=(0,h.useState)(null),y=(0,l.Z)(C,2),N=y[0],w=y[1],E=(0,h.useState)(!1),k=(0,l.Z)(E,2),F=k[0],I=k[1],B=(0,h.useRef)(null);(0,h.useEffect)((function(){T()}),[]);var T=(0,h.useCallback)((function(){(0,m.Z)({method:"get",url:"tas/busstop?Active=1"}).then((function(e){g(e.data)}))}),[]),M=(0,h.useCallback)((function(e){S(e.target.value)}),[]),R=function(e){e.preventDefault(),I(!0),(0,m.Z)({method:"post",url:"tas/busstop",data:{description:Z,active:1}}).then((function(e){S(""),T()})).catch((function(){})).then((function(){I(!1)}))},Y=(0,h.useCallback)((function(e,t){e.preventDefault(),e.stopPropagation(),w(t)}),[]),L=(0,h.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),I(!0),(0,m.Z)({method:"delete",url:"tas/busstop",data:{id:null===N||void 0===N?void 0:N.Id}}).then((function(e){T()})).catch((function(e){})).then((function(){I(!1)}))}),[N]),P=(0,h.useCallback)((function(e){e.stopPropagation(),e.preventDefault()}),[]);return(0,x.jsx)(r.Z,(0,a.Z)((0,a.Z)({},t),{},{className:"w-full",options:b.map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{value:e.Description,label:e.Description})})),style:{width:250},popupMatchSelectWidth:!1,optionRender:function(e){return(0,x.jsxs)("div",{className:"flex justify-between items-center",children:[(0,x.jsx)("span",{children:e.data.label}),(0,x.jsx)(c.Z,{title:"Are you sure to remove ?",onConfirm:L,cancelButtonProps:{style:{backgroundColor:"white"}},okButtonProps:{loading:F},onPopupClick:P,children:(0,x.jsx)(f.Button,{type:"danger",className:"px-1",onClick:function(t){return Y(t,e.data)},children:(0,x.jsx)(s.Z,{})})})]})},dropdownRender:function(e){return(0,x.jsxs)(x.Fragment,{children:[e,(0,x.jsx)(d.Z,{style:{margin:"8px 0"}}),(0,x.jsxs)(u.Z,{style:{padding:"0 8px 4px"},children:[(0,x.jsx)(p.Z,{placeholder:"Please enter item",ref:B,value:Z,onChange:M,onKeyDown:function(e){return e.stopPropagation()}}),(0,x.jsx)(f.Button,{type:"text",icon:(0,x.jsx)(i.Z,{}),loading:F,onClick:R,children:"Add"})]})]})}}))}},38209:function(e,t,n){var a=n(93433),l=n(1413),o=n(29439),s=n(45987),i=n(2880),r=n(47313),c=n(78373),d=n(21975),u=n(31118),p=n(60020),m=n(82138),f=n(82508),h=n(92350),x=n(56573),v=n(73030),b=n(46417),g=["rowData","onReset"],j=["key","name"],D={labelCol:{xs:{span:24},sm:{span:10}},wrapperCol:{xs:{span:24},sm:{span:16}}};t.Z=function(e){var t,n=e.rowData,Z=e.onReset,S=(0,s.Z)(e,g),C=(0,r.useState)(!1),y=(0,o.Z)(C,2),N=y[0],w=y[1],E=(0,r.useState)(!0),k=(0,o.Z)(E,2),F=k[0],I=k[1],B=(0,r.useState)(),T=(0,o.Z)(B,2),M=T[0],R=T[1],Y=(0,r.useState)(!1),L=(0,o.Z)(Y,2),P=L[0],A=L[1],z=i.Form.useForm(),V=(0,o.Z)(z,1)[0];(0,r.useEffect)((function(){null!==n&&void 0!==n&&n.BusstopStatus?O(n):I(!1)}),[n]);var O=function(e){I(!0),(0,x.Z)({method:"get",url:"tas/transportschedule/busstop/".concat(e.Id)}).then((function(t){R((0,l.Z)((0,l.Z)({},e),{},{busStops:(0,a.Z)(t.data)})),V.setFieldValue("busstops",t.data)})).catch((function(e){})).then((function(){return I(!1)}))},H=[{type:"component",component:(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(i.Form.List,{name:"busstops",className:"col-span-12",children:function(e,t){var n=t.add,a=t.remove;return(0,b.jsxs)(b.Fragment,{children:[e.length>0?(0,b.jsx)("div",{className:"col-span-12 flex flex-col  gap-y-2 max-h-[400px] overflow-auto mb-3",children:e.map((function(e){e.key;var t=e.name,n=(0,s.Z)(e,j);return(0,b.jsxs)("div",{className:"flex gap-x-2 items-start",children:[(0,b.jsx)(i.Form.Item,(0,l.Z)((0,l.Z)({},n),{},{className:"mb-0",name:[t,"Description"],children:(0,b.jsx)(c.Z,{placeholder:"Station"})})),(0,b.jsx)(i.Form.Item,{name:[t,"ETD"],className:"mb-0 w-[130px]",rules:[{required:!0,message:"In ETD is required"},{pattern:new RegExp(/^(?:2[0-3]|[01][0-9])[0-5][0-9]$/),message:"Enter correct time"}],children:(0,b.jsx)(d.Z,{maxLength:4,placeholder:"ETD",className:"py-[6px]"})}),(0,b.jsx)("button",{type:"button",className:"bg-[#FFE2E5] text-[#F64E60] hover:bg-red-200 rounded-md px-3 py-1 disabled:bg-gray-100 transition-all",onClick:function(){return a(t)},children:(0,b.jsx)(p.Z,{})})]})}))}):null,(0,b.jsx)(i.Form.Item,{className:"col-span-12 mb-5",children:(0,b.jsx)(i.Button,{className:"w-full flex justify-center",onClick:function(){return n()},block:!0,icon:(0,b.jsx)(m.Z,{}),children:"Add new station"})})]})}})})}],W=function(e){w(!0),(0,x.Z)({method:"put",url:"tas/transportschedule/busstop",data:(0,l.Z)({id:M.Id},e)}).then((function(e){Z()})).catch((function(e){})).then((function(){return w(!1)}))};return(0,b.jsx)(i.Modal,(0,l.Z)((0,l.Z)({},S),{},{destroyOnClose:!1,children:F?(0,b.jsx)("div",{className:"h-[100px] flex justify-center items-center",children:(0,b.jsx)(f.Z,{style:{fontSize:26}})}):(0,b.jsx)(b.Fragment,{children:(null===M||void 0===M||null===(t=M.busStops)||void 0===t?void 0:t.length)>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:(0,v.m6)(P?"hidden":"block mt-4"),children:[(0,b.jsx)(u.Z,{mode:"left",items:null===M||void 0===M?void 0:M.busStops.map((function(e){return{children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("div",{children:e.ETD})," ",(0,b.jsx)("div",{children:e.Description})]})}}))}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(i.Button,{onClick:function(){return A(!0)},children:"Edit"})})]}),(0,b.jsx)("div",{className:(0,v.m6)(P?"block":"hidden"),children:(0,b.jsx)(i.Form,{fields:H,className:"gap-x-5",form:V,editData:M,onFinish:W,itemLayouts:D,children:(0,b.jsxs)("div",{className:"col-span-12 gap-3 flex justify-end mt-3",children:[(0,b.jsx)(i.Button,{type:"primary",onClick:function(){return V.submit()},loading:N,icon:(0,b.jsx)(h.Z,{}),children:"Save"}),(0,b.jsx)(i.Button,{onClick:function(){A(!1),V.setFieldValue("busstops",M.busStops)},disabled:N,children:"Cancel"})]})})})]}):(0,b.jsx)(i.Form,{fields:H,className:"gap-x-5",form:V,editData:M,onFinish:W,itemLayouts:D,children:(0,b.jsxs)("div",{className:"col-span-12 gap-3 flex justify-end mt-3",children:[(0,b.jsx)(i.Button,{type:"primary",onClick:function(){return V.submit()},loading:N,icon:(0,b.jsx)(h.Z,{}),children:"Save"}),(0,b.jsx)(i.Button,{onClick:function(){return(null===S||void 0===S?void 0:S.onCancel())||!1},disabled:N,children:"Cancel"})]})})})}))}}}]);