"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[7842],{87842:function(e,n,t){t.r(n);var l=t(1413),a=t(29439),o=t(47313),i=t(2880),s=t(14261),r=t(58821),d=t(18711),c=t(11829),u=t(6986),m=t(22231),p=t(56573),h=t(65040),f=t(12998),x=t(29074),v=t(58467),g=t(42614),b=t(42956),w=t(10658),y=t.n(w),j=t(76738),C=t(95585),R=t.n(C),k=t(6761),N=t(30468),F=t(81404),Z=t(46417);n.default=function(){var e,n,t=(0,v.TH)(),w=(0,o.useState)([]),C=(0,a.Z)(w,2),I=C[0],T=C[1],S=(0,o.useState)(!1),B=(0,a.Z)(S,2),D=B[0],E=B[1],A=(0,o.useState)(!1),L=(0,a.Z)(A,2),M=L[0],P=L[1],_=(0,o.useState)(null),U=(0,a.Z)(_,2),z=U[0],Y=U[1],G=(0,o.useState)(!1),H=(0,a.Z)(G,2),V=H[0],W=H[1],J=(0,o.useState)(null),K=(0,a.Z)(J,2),O=K[0],q=K[1],Q=(0,o.useState)(new b.Z({key:"Id",load:function(e){var n,t,a,o="";return(null===(n=e.sort)||void 0===n?void 0:n.length)>1&&(o="?sortby=".concat(e.sort[0].selector,"&sortdirection=").concat(e.sort[0].desc?"desc":"asc")),e.filter&&!R()(e.filter)?(null===(t=re.current)||void 0===t||t.instance.beginCustomLoading(),(0,p.Z)({method:"post",url:"tas/employee/search".concat(o),data:{model:(0,l.Z)({},e.filter),pageIndex:e.skip/e.take,pageSize:e.take}}).then((function(e){return{data:e.data.data,totalCount:e.data.totalcount}})).finally((function(){var e;return null===(e=re.current)||void 0===e?void 0:e.instance.endCustomLoading()}))):R()(e.filter)||"undefined"!==typeof e.filter?void 0:(null===(a=re.current)||void 0===a||a.instance.beginCustomLoading(),(0,p.Z)({method:"post",url:"tas/employee/search".concat(o),data:{model:{CampId:"",DepartmentId:"",Firstname:"",FlightGroupMasterId:"",Lastname:"",LocationId:"",NRN:"",roomNumber:"",RoomTypeId:"",costCodeId:"",employerId:"",futureBookingId:"",group:"",id:"",peopleTypeId:"",roomAssignment:"",rosterId:"",sapId:"",mobile:"",hasRoom:"",futureBooking:""},pageIndex:e.skip/e.take,pageSize:e.take}}).then((function(e){return{data:e.data.data,totalCount:e.data.totalcount}})).finally((function(){var e;return null===(e=re.current)||void 0===e?void 0:e.instance.endCustomLoading()})))}})),X=(0,a.Z)(Q,1)[0],$=(0,o.useContext)(g.V),ee=$.state,ne=$.action,te=h.Z.useForm(),le=(0,a.Z)(te,1)[0],ae=f.ZP.useNotification(),oe=(0,a.Z)(ae,2),ie=oe[0],se=oe[1],re=(0,o.useRef)(null);(0,o.useEffect)((function(){ne.changeMenuKey("/tas/bulkprofile"),t.state&&le.setFieldValue(t.state.name,t.state.value)}),[]);var de=[{label:"Person #",name:"Id",dataType:"string",width:"70px"},{label:"",name:"Active",width:"21px",alignment:"center",cellRender:function(e){return(0,Z.jsx)(d.DcD,{color:1===e.value?"lime":"lightgray"})}},{label:"Firstname",name:"Firstname",dataType:"string"},{label:"Lastname",name:"Lastname",dataType:"string"},{label:"Department",name:"DepartmentName",dataType:"string",width:"220px"},{label:"Employer",name:"EmployerName",dataType:"string"},{label:"Roster",name:"RosterName",dataType:"string",width:"70px"},{label:"Resource Type",name:"PeopleTypeName",dataType:"string"},{label:"Room",name:"RoomNumber",dataType:"string",cellRender:function(e){return(0,Z.jsx)("div",{children:e.value})}},{label:"Gender",name:"Gender",alignment:"center",width:"70px",cellRender:function(e){return(0,Z.jsx)("span",{children:1===e.data.Gender?"M":"F"})},groupCellRender:function(e){return(0,Z.jsxs)("span",{children:[1===e.value?"M":"F"," ",e.groupContinuesMessage?"- ".concat(e.groupContinuesMessage):""]})}},{label:"",name:"HasFutureTransport",width:"50px",cellRender:function(e){return(0,Z.jsx)(s.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})},headerCellRender:function(e,n){return(0,Z.jsx)(r.dm9,{})}},{label:"",name:"HasFutureRoomBooking",width:"50px",cellRender:function(e,n){return(0,Z.jsx)(s.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})},headerCellRender:function(e,n){return(0,Z.jsx)("i",{className:"dx-icon-home"})}}],ce=(0,o.useCallback)((function(e){var n;null===(n=re.current)||void 0===n||n.instance.filter(e)}),[]),ue=(0,o.useCallback)((function(e){T(e.selectedRowKeys)}),[]),me=function(e){E(!0),(0,p.Z)({method:"post",url:"tas/employee/bulkrequest",responseType:"blob",data:{empIds:e}}).then((function(e){var n=window.URL.createObjectURL(new Blob([e.data])),t="TAS_Employee_Bulk_Download_".concat(y()().format("YYYY-MM-DD hh:mm:ss"),".xlsx"),l=document.createElement("a");l.href=n,l.setAttribute("download",t),document.body.appendChild(l),l.click()})).catch((function(e){})).then((function(){return E(!1)}))},pe=[{label:"Row Index",name:"ExcelRowIndex",alignment:"left",width:"80px"},{label:"Person #",name:"PersonId"},{label:"Fullname",name:"Fullname"},{label:"SAP #",name:"SAPID"},{label:"Error",name:"Error",alignment:"left",cellRender:function(e){var n=e.value;return(0,Z.jsx)("div",{children:(0,Z.jsx)("ul",{className:"pl-3 list-outside list-disc",children:null===n||void 0===n?void 0:n.map((function(e){return(0,Z.jsx)("li",{children:e})}))})})}}];return(0,Z.jsxs)("div",{children:[(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(i.SearchPeopleForm,{containerClass:"bg-white rounded-ot px-3 py-2 mb-3",onSearch:ce}),(0,Z.jsx)(i.Table,{ref:re,data:X,columns:de,allowColumnReordering:!1,remoteOperations:!0,showRowLines:!0,selection:{mode:"multiple",recursive:!1,showCheckBoxesMode:"always",allowSelectAll:!0,selectAllMode:"page"},tableClass:"max-h-[calc(100vh-345px)]",onSelectionChanged:ue,title:null!==(e=ee.userInfo)&&void 0!==e&&e.ReadonlyAccess?"":(0,Z.jsxs)("div",{className:"flex justify-between py-2 gap-3 border-b",children:[(0,Z.jsxs)("div",{className:"flex items-center gap-3",children:[(0,Z.jsxs)("div",{className:"ml-2",children:[(0,Z.jsx)("span",{className:"font-bold",children:I.length})," people selected"]}),I.length>0?(0,Z.jsx)(i.Button,{className:"text-xs",onClick:function(){var e;null===(e=re.current)||void 0===e||e.instance.clearSelection()},icon:(0,Z.jsx)(c.Z,{}),children:"Clear All"}):null]}),(0,Z.jsxs)("div",{className:"flex gap-3",children:[(0,Z.jsx)(i.Button,{loading:0===I.length&&D,icon:(0,Z.jsx)(u.Z,{}),onClick:function(){return me([])},children:"Download All"}),(0,Z.jsx)(i.Button,{loading:I.length>0&&D,disabled:!I.length||D,icon:(0,Z.jsx)(u.Z,{}),onClick:function(){return me(I)},children:"Download"}),(0,Z.jsx)(i.FileUploader,{icon:(0,Z.jsx)(m.Z,{}),onChange:function(e){if((0,j.Z)(e)){P(!0),q(e);var n=new FormData;n.append("BulkEmployeeFile",e),e&&(0,p.Z)({method:"post",url:"tas/employee/bulkuploadpreview",headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},data:n}).then((function(e){Y(e.data),W(!0)})).catch((function(e){})).then((function(){return P(!1)}))}else ie.error({message:"Error",placement:"top",duration:5,description:(0,Z.jsx)("div",{className:"flex items-center justify-center",children:"You can only upload an excel file !"})})},accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",loading:M,children:"Upload"})]})]})}),(0,Z.jsxs)(i.Modal,{title:"Uploaded",open:V,onCancel:function(){return W(!1)},width:800,children:[(0,Z.jsxs)("div",{children:[(0,Z.jsxs)("div",{className:"grid grid-cols-12 gap-2 mb-5",children:[(0,Z.jsxs)("div",{className:"col-span-6 text-green-500",children:["Added Row: ",(0,Z.jsx)(x.Z,{className:"ml-1",color:"green",children:null===z||void 0===z?void 0:z.AddRow})]}),(0,Z.jsxs)("div",{className:"col-span-6",children:["None Row: ",(0,Z.jsx)(x.Z,{className:"ml-1",children:null===z||void 0===z?void 0:z.NoneRow})]}),(0,Z.jsxs)("div",{className:"col-span-6 text-blue-400",children:["Updated Row: ",(0,Z.jsx)(x.Z,{className:"ml-1",color:"blue",children:null===z||void 0===z?void 0:z.UpdateRow})]})]}),(null===z||void 0===z||null===(n=z.FailedRows)||void 0===n?void 0:n.length)>0&&(0,Z.jsx)(i.Table,{export:{enabled:!0},onExporting:function(e){var n=new F.Workbook,t=n.addWorksheet("Bulk_Profile_Changes_Failed_Rows");t.columns=[{width:5},{width:30},{width:25},{width:15},{width:25},{width:40}],(0,N.d)({component:e.component,worksheet:t,keepColumnWidths:!1,topLeftCell:{row:2,column:2},customizeCell:function(e){var n=e.gridCell,t=e.excelCell;n.rowType,"group"===n.rowType&&(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"BEDFE6"}}),"totalFooter"===n.rowType&&t.value&&(t.font.italic=!0)}}).then((function(){n.xlsx.writeBuffer().then((function(e){(0,k.p)(new Blob([e],{type:"application/octet-stream"}),"Companies.xlsx")}))}))},columns:pe,data:null===z||void 0===z?void 0:z.FailedRows,containerClass:"shadow-none border mb-5",tableClass:"max-h-[500px]",toolbar:[{location:"before",render:function(e){var n;return(0,Z.jsxs)("div",{className:"text-md",children:["Failed Rows: ",(0,Z.jsx)("span",{className:"font-bold text-red-500",children:null===z||void 0===z||null===(n=z.FailedRows)||void 0===n?void 0:n.length})]})}}]})]}),(0,Z.jsxs)("div",{className:"flex justify-end gap-5 items-center",children:[(0,Z.jsx)("div",{children:"If you press the Process button, it will skip failed rows"}),(0,Z.jsx)(i.Button,{type:"primary",loading:M,onClick:function(){return function(){P(!0);var e=new FormData;e.append("BulkEmployeeFile",O),O&&(0,p.Z)({method:"post",url:"tas/employee/bulkupload",headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},data:e}).then((function(e){W(!1),q(null),e.data.length>0&&le.setFieldValue("Id",e.data.map((function(e){return"".concat(e)})).join(" ").slice(0,5e3)),le.submit()})).catch((function(e){})).then((function(){return P(!1)}))}()},children:"Process"}),(0,Z.jsx)(i.Button,{onClick:function(){W(!1),q(null)},disabled:M,children:"Cancel"})]})]})]}),se]})}},76738:function(e,n){var t=["text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"];n.Z=function(e){return!!t.includes(e.type)}}}]);