"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[3604],{13604:function(e,t,n){n.r(t);var o=n(1413),l=n(29439),a=n(2880),i=n(47313),s=n(65040),r=n(29074),c=n(93031),d=n(74294),u=n(21975),m=n(56573),f=n(40765),h=n(10658),p=n.n(h),x=n(42614),I=n(165),g=n(46417);t.default=function(){var e,t,n,h=(0,i.useState)(null),v=(0,l.Z)(h,2),b=v[0],j=v[1],F=(0,i.useState)(!1),D=(0,l.Z)(F,2),S=D[0],L=D[1],y=(0,i.useState)(!1),C=(0,l.Z)(y,2),Z=C[0],w=C[1],N=(0,i.useState)(!1),T=(0,l.Z)(N,2),V=T[0],Y=T[1],k=(0,i.useState)([]),M=(0,l.Z)(k,2),R=M[0],q=M[1],A=(0,i.useState)(null),O=(0,l.Z)(A,2),U=O[0],E=O[1],P=(0,i.useState)(null),B=(0,l.Z)(P,2),W=B[0],z=B[1],K=(0,i.useState)([]),H=(0,l.Z)(K,2),_=H[0],G=H[1],J=(0,i.useState)([]),Q=(0,l.Z)(J,2),X=Q[0],$=Q[1],ee=(0,i.useState)(!1),te=(0,l.Z)(ee,2),ne=te[0],oe=te[1],le=(0,i.useState)(null),ae=(0,l.Z)(le,2),ie=ae[0],se=ae[1],re=(0,i.useState)({toLocation:null,fromLocation:null}),ce=(0,l.Z)(re,2),de=ce[0],ue=ce[1],me=(0,i.useState)(!1),fe=(0,l.Z)(me,2),he=fe[0],pe=fe[1],xe=(0,i.useState)([]),Ie=(0,l.Z)(xe,2),ge=Ie[0],ve=Ie[1],be=s.Z.useForm(),je=(0,l.Z)(be,1)[0],Fe=s.Z.useWatch("fromLocationId",je),De=s.Z.useWatch("toLocationId",je),Se=s.Z.useWatch("fromDate",je),Le=s.Z.useForm(),ye=(0,l.Z)(Le,1)[0],Ce=(0,i.useContext)(x.V),Ze=Ce.action,we=Ce.state;(0,i.useEffect)((function(){var e;(null===b||void 0===b||null===(e=b.Peoples)||void 0===e?void 0:e.length)>0&&($([]),j([]))}),[Fe,De,Se]),(0,i.useEffect)((function(){Ze.changeMenuKey("/tas/reschedule"),Ne()}),[]),(0,i.useEffect)((function(){if(U&&W&&de.fromLocation&&de.toLocation){var e=p()(U).format("YYYY-MM-DD");(0,m.Z)({method:"get",url:"tas/ActiveTransport/getdatetransport?eventDate=".concat(e,"&Direction=").concat(W,"&fromLocationId=").concat(de.fromLocation,"&toLocationId=").concat(de.toLocation)}).then((function(e){var t=[];e.data.map((function(e){t.push({value:e.ScheduleId,label:"".concat(e.Description," ").concat(e.Seat,"/").concat(e.BookedCount)})})),je.setFieldValue(["lastTransport","flightId"],null),G(t)}))}}),[U,W,de]);var Ne=function(){(0,m.Z)({method:"get",url:"tas/location?Active=1"}).then((function(e){var t=[];e.data.map((function(e){t.push((0,o.Z)({value:e.Id,label:"".concat(e.Code," - ").concat(e.Description)},e))})),q(t)})).catch((function(e){}))},Te=[{label:"Person #",name:"EmployeeId",width:"80px",alignment:"left"},{label:"Person",name:"FullName"},{label:"Department",name:"Department"},{label:"Transport Code",name:"TransportCode"},{label:"Position",name:"Position",alignment:"left"},{label:"Cost Code",name:"CostCodeDescr",alignment:"left"},{label:"Employer",name:"EmployerName",alignment:"left"},{label:"Shift",name:"ShiftCode",alignment:"left",cellRender:function(e){return(0,g.jsx)("div",{className:"text-[11px] font-normal w-[50px] text-center py-1 rounded",style:{background:e.data.ShiftCodeColor,color:(0,I.Z)(e.data.ShiftCodeColor)>60?"black":"white"},children:e.value})}},{label:"Transport Status",name:"Status",alignment:"left",cellRender:function(e){return(0,g.jsx)(r.Z,{color:"Confirmed"===e.value?"green":"orange",children:e.value})}},{label:"Created Date",name:"CreatedDate",alignment:"left",cellRender:function(e){return(0,g.jsx)("span",{children:p()(e.value).format("YYYY-MM-DD HH:mm:ss")})}}],Ve=function(e){w(!0),(0,m.Z)({method:"post",url:"tas/transport/searchreschedulepeople",data:{fromDate:e.fromDate?p()(e.fromDate).format("YYYY-MM-DD"):"",toDate:e.toDate?p()(e.toDate).format("YYYY-MM-DD"):"",fromLocationId:e.fromLocationId,toLocationId:e.toLocationId,direction:e.direction,scheduleId:e.scheduleId}}).then((function(e){j(e.data)})).catch((function(e){})).then((function(){return w(!1)}))},Ye=[{type:"component",component:(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(a.Form.Item,{label:"Reschedule From This Date",name:"fromDate",className:"col-span-6 mb-2",rules:[{required:!0,message:"From Date is required"}],children:(0,g.jsx)(c.Z,{onChange:function(e){E(e),je.setFieldValue("scheduleId",null)},className:"w-full",showWeek:!0})})})},{type:"component",component:(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(a.Form.Item,{label:"Reschedule To This Date",name:"toDate",className:"col-span-6 mb-2",rules:[{required:!0,message:"To Date is required"}],children:(0,g.jsx)(c.Z,{className:"w-full",showWeek:!0})})})},{type:"component",component:(0,g.jsx)(a.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.toLocationId!==t.toLocationId},children:function(e){var t=e.getFieldValue,n=e.setFieldValue;return(0,g.jsx)(a.Form.Item,{label:"Departure Location",name:"fromLocationId",className:"col-span-6 mb-3",rules:[{required:!0,message:"Departure Location is required"}],children:(0,g.jsx)(d.Z,{onChange:function(e){n("scheduleId",null),ue((function(t){return(0,o.Z)((0,o.Z)({},t),{},{fromLocation:e})}))},options:R.filter((function(e){return e.Id!==t("toLocationId")})),allowClear:!0,showSearch:!0,filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())}})})}})},{type:"component",component:(0,g.jsx)(a.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.fromLocationId!==t.fromLocationId},children:function(e){var t=e.getFieldValue,n=e.setFieldValue;return(0,g.jsx)(a.Form.Item,{label:"Arrive Location",name:"toLocationId",className:"col-span-6 mb-3",rules:[{required:!0,message:"Arrive Location is required"}],children:(0,g.jsx)(d.Z,{onChange:function(e){n("scheduleId",null),ue((function(t){return(0,o.Z)((0,o.Z)({},t),{},{toLocation:e})}))},options:R.filter((function(e){return e.Id!==t("fromLocationId")})),allowClear:!0,showSearch:!0,filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())}})})}})},{type:"component",component:(0,g.jsx)(a.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.fromLocationId!==t.fromLocationId||e.toLocationId!==t.toLocationId},children:function(e){var t,n,o=e.getFieldValue,l=e.setFieldValue,i=null===R||void 0===R||null===(t=R.find((function(e){return e.Id===o("fromLocationId")})))||void 0===t?void 0:t.onSite;return 1===(null===R||void 0===R||null===(n=R.find((function(e){return e.Id===o("toLocationId")})))||void 0===n?void 0:n.onSite)?(l("direction","IN"),z("IN")):1===i?(l("direction","OUT"),z("OUT")):(l("direction",""),z(null)),(0,g.jsx)(a.Form.Item,{label:"Direction",name:"direction",className:"col-span-6 mb-3",children:(0,g.jsx)(d.Z,{disabled:!0,options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],onChange:function(e){return z(e)}})})}})},{type:"component",component:(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(a.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.fromLocationId!==t.fromLocationId||e.toLocationId!==t.toLocationId},children:function(e){e.getFieldValue,e.setFieldValue,e.getFieldsValue;return U&&W&&(0,g.jsx)(a.Form.Item,{label:"Schedule",name:"scheduleId",className:"mb-3 col-span-6",rules:[{required:!0,message:"Schedule is required"}],children:(0,g.jsx)(d.Z,{options:_,className:"w-full",popupMatchSelectWidth:!1,allowClear:!0,showSearch:!0,filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())}})})}})})}],ke=function(){var e=Object.keys(null===je||void 0===je?void 0:je.getFieldsValue()),t=0;return e.map((function(e){null!==je&&void 0!==je&&je.getFieldValue(e)&&t++})),t!==e.length},Me=[{type:"component",component:(0,g.jsx)(a.Form.Item,{label:"Date",className:"col-span-12 mb-3",children:(0,g.jsx)(u.Z,{disabled:!0,value:je.getFieldValue("toDate")?p()(je.getFieldValue("toDate")).format("YYYY-MM-DD"):null})})},{type:"component",component:(0,g.jsx)(a.Form.Item,{label:"To Transport",className:"col-span-12 mb-3",children:(0,g.jsxs)("div",{className:"grid grid-cols-12 gap-2",children:[(0,g.jsx)(a.Form.Item,{noStyle:!0,name:"scheduleId",rules:[{required:!0,message:"To Transport is required"}]}),(0,g.jsx)(a.Form.Item,{name:"scheduleDescription",className:"col-span-10 mb-0",children:(0,g.jsx)(u.Z,{readOnly:!0})}),(0,g.jsx)(a.Form.Item,{className:"col-span-2 mb-0",children:(0,g.jsx)(a.Button,{className:"text-xs py-[5px]",type:"primary",onClick:function(){var e=je.getFieldsValue(),t={StartDate:je.getFieldValue("toDate")?je.getFieldValue("toDate"):null,EndDate:je.getFieldValue("toDate")?je.getFieldValue("toDate"):null,DepartLocationId:e.fromLocationId,ArriveLocationId:e.toLocationId};se((0,o.Z)((0,o.Z)({},t),{},{transportType:"first"})),oe(!0)},children:"..."})})]})})},{label:"Shift",name:"shiftId",className:"col-span-12 mb-3",type:"select",rules:[{required:!0,message:"Shift is required"}],inputprops:{options:null===b||void 0===b?void 0:b.ShifData,fieldNames:{label:"Description",value:"Id"}}}];return(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"rounded-ot bg-white px-3 py-2 mb-3 shadow-md",children:[(0,g.jsx)("div",{className:"text-lg font-bold mb-2",children:"Reschedule people to different transport"}),(0,g.jsx)(a.Form,{form:je,fields:Ye,className:"grid grid-cols-12 gap-x-8",size:"small",onFinish:Ve,children:(0,g.jsx)(a.Form.Item,{noStyle:!0,shouldUpdate:!0,children:function(){return(0,g.jsx)(a.Form.Item,{className:"col-span-12 flex gap-4 justify-end mb-0",children:(0,g.jsx)(a.Button,{onClick:function(){return je.submit()},className:"flex items-center",htmlType:"button",loading:Z,icon:(0,g.jsx)(f.Z,{}),disabled:ke(),children:"Search"})})}})})]}),(0,g.jsx)(a.Table,{className:"overflow-hidden ".concat(!(null!==(e=we.userInfo)&&void 0!==e&&e.ReadonlyAccess)&&"border-t"),data:null===b||void 0===b?void 0:b.Peoples,columns:Te,allowColumnReordering:!1,loading:S,keyExpr:"Id",selection:!(null!==(t=we.userInfo)&&void 0!==t&&t.ReadonlyAccess)&&{mode:"multiple",recursive:!1,showCheckBoxesMode:"always",allowSelectAll:!0,selectAllMode:"page"},onSelectionChanged:function(e){if(e.selectedRowKeys.length>200){var t=e.selectedRowKeys.slice(200);e.component.deselectRows(t)}else $(e.selectedRowKeys)},isFilterRow:!0,pager:{pageSize:[300,500,700,1e3]},defaultPageSize:300,style:{maxHeight:"calc(100vh - 345px)"},title:null!==(n=we.userInfo)&&void 0!==n&&n.ReadonlyAccess?"":(0,g.jsxs)("div",{className:"flex justify-between py-2 gap-3",children:[(0,g.jsxs)("div",{className:"ml-2",children:[(0,g.jsx)("span",{className:"font-bold",children:X.length})," people selected ",200===X.length&&(0,g.jsx)("span",{className:"text-red-400",children:"(full)"})]}),(0,g.jsx)(a.Button,{disabled:0===X.length,onClick:function(){return Y(!0)},children:"Reschedule"})]})}),(0,g.jsx)(a.Modal,{title:"Accommadation warning (".concat(ge.length,")"),open:he,onCancel:function(){return pe(!1)},width:700,children:(0,g.jsx)(a.Table,{data:ge,columns:[{label:"Person #",name:"Id",width:"80px",alignment:"left"},{label:"Fullname",name:"Fullname"}],containerClass:"shadow-none"})}),(0,g.jsxs)(a.Modal,{open:V,onCancel:function(){return Y(!1)},title:"Reschedule",zIndex:999,children:[(0,g.jsx)(a.Form,{form:ye,fields:Me,onFinish:function(e){L(!0),(0,m.Z)({method:"post",url:"tas/transport/reschedule",data:(0,o.Z)((0,o.Z)({},e),{},{transportIds:X})}).then((function(e){e.data.length>0&&(ve(e.data),pe(!0)),Y(!1),Ve(je.getFieldsValue())})).catch((function(e){})).then((function(){return L(!1)}))},className:"grid grid-cols-12"}),(0,g.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,g.jsx)(a.Button,{htmlType:"button",type:"primary",onClick:function(){return ye.submit()},loading:S,children:"Save"}),(0,g.jsx)(a.Button,{htmlType:"button",disabled:S,onClick:function(){return Y(!1)},children:"Cancel"})]})]}),(0,g.jsx)(a.Modal,{title:"Select Transport",open:ne,width:900,onCancel:function(){return oe(!1)},destroyOnClose:!1,zIndex:1e3,children:(0,g.jsx)(a.TransportSearch,{initialSearchValues:ie,handleSelect:function(e){ye.setFieldValue("scheduleDescription","".concat(e.Code," ").concat(e.Description)),ye.setFieldValue("scheduleId",e.Id),oe(!1)}})})]})}}}]);