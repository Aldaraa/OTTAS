"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[4800],{54800:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var a=n(93433),l=n(1413),s=n(29439),c=n(2880),r=n(47313),i=n(65040),o=n(29074),d=n(56573),u=n(23495),m=n(11829),h=n(92350),f=n(58467),x=n(2135),p=n(10658),v=n.n(p),j=n(42614),b=n(45987),g=n(21975),N=n(46417),y=["key","name"];var Z=function(e){var t=e.data,n=void 0===t?[]:t,a=e.handleChangeData,o=e.changeIsEditing,m=e.className,h=e.refreshData,p=(0,r.useState)(null),j=(0,s.Z)(p,2),Z=j[0],I=j[1],w=(0,r.useState)(!1),D=(0,s.Z)(w,2),S=D[0],C=D[1],k=(0,r.useState)(!1),E=(0,s.Z)(k,2),F=E[0],R=E[1],Y=(0,r.useState)(!1),M=(0,s.Z)(Y,2),O=M[0],V=M[1],B=(0,r.useState)([]),L=(0,s.Z)(B,2),A=L[0],T=L[1],z=i.Z.useForm(),q=(0,s.Z)(z,1)[0],G=(0,f.UO)().eventId,P=(0,f.s0)();(0,r.useEffect)((function(){q.setFieldsValue({rosters:n})}),[n]);var U=function(){a(q.getFieldValue("rosters")),o(!1)};return(0,N.jsxs)("div",{className:"rounded-ot bg-white p-5 mb-5 shadow-md ".concat(m),children:[(0,N.jsx)(c.Button,{className:"mb-3",onClick:U,icon:(0,N.jsx)(u.Z,{}),children:"Back"}),(0,N.jsxs)(i.Z,{form:q,size:"small",onFinish:function(e){C(!0);var t=[];null===e||void 0===e||e.rosters.map((function(e){t.push({oldEmployeeId:e.EmployeeId,newEmployeeId:e.NewEmployeeId})})),(0,d.Z)({method:"post",url:"tas/visitevent/replaceprofilemultiple",data:{employees:t,eventId:G}}).then((function(e){var t;e.data&&(null===(t=e.data)||void 0===t?void 0:t.length)>0?(T(e.data),V(!0)):h()})).catch((function(e){})).then((function(){return C(!1)}))},initialValues:{rosters:[],startDate:null,durationMonth:0,flightGroupMasterId:null},children:[(0,N.jsx)(i.Z.List,{name:"rosters",children:function(e,t){var n=t.remove;return(0,N.jsx)("div",{className:"border rounded-ot overflow-auto",children:(0,N.jsxs)("table",{className:"table-auto overflow-scroll w-full",children:[(0,N.jsx)("thead",{className:"text-[#959595]",children:(0,N.jsxs)("tr",{className:"text-left font-normal",children:[(0,N.jsx)("th",{className:"border-b px-1 sticky left-0 z-10 bg-white",children:"#"}),(0,N.jsx)("th",{className:"border-b px-1 sticky left-[38px] z-10 bg-white",children:"Fullname"}),(0,N.jsx)("th",{className:"border-b px-1",children:"Replacement"}),(0,N.jsx)("th",{className:"border-b px-1",children:"In Event Date"}),(0,N.jsx)("th",{className:"border-b px-1",children:"In"}),(0,N.jsx)("th",{className:"border-b px-1",children:"Out Event Date"}),(0,N.jsx)("th",{className:"border-b px-1",children:"Out"}),(0,N.jsx)("th",{className:"border-b px-1"})]})}),(0,N.jsx)("tbody",{children:e.map((function(e){e.key;var t=e.name,a=(0,b.Z)(e,y);return(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{className:"p-1 border-t sticky left-0 z-10 ".concat((t+1)%2===0?"bg-[#fafafa]":"bg-white"),children:(0,N.jsx)("div",{className:"w-[30px]",children:t+1})}),(0,N.jsx)("td",{className:"p-1 border-t sticky left-[38px] z-10 ".concat((t+1)%2===0?"bg-[#fafafa]":"bg-white"),children:(0,N.jsx)(x.Link,{to:"/tas/people/search/".concat(q.getFieldValue(["rosters",t,"Id"])),children:(0,N.jsxs)("span",{className:"text-blue-500 hover:underline",children:[q.getFieldValue(["rosters",t,"Firstname"])," ",q.getFieldValue(["rosters",t,"Lastname"])]})})}),(0,N.jsxs)("td",{className:"p-1 border-t flex items-start gap-2 ".concat((t+1)%2===0?"bg-[#fafafa]":"bg-white"),children:[(0,N.jsx)(i.Z.Item,(0,l.Z)((0,l.Z)({},a),{},{name:[t,"NewEmployeeId"],noStyle:!0})),(0,N.jsx)(i.Z.Item,(0,l.Z)((0,l.Z)({},a),{},{name:[t,"EmployeeName"],className:"mb-0 flex-1",rules:[{required:!0,message:"Field is required"}],children:(0,N.jsx)(g.Z,{readOnly:!0,placeholder:"Replace employee"})})),(0,N.jsx)(c.Button,{type:"primary",className:"py-1 text-xs",onClick:function(){return I(t),void R(!0)},children:"Select"})]}),(0,N.jsx)("td",{className:"p-1 border-t ".concat((t+1)%2===0?"bg-[#fafafa]":"bg-white"),children:(0,N.jsx)("div",{className:"w-[180px] text-[13px]",children:v()(q.getFieldValue(["rosters",t,"InEventDate"])).format("YYYY-MM-DD")})}),(0,N.jsx)("td",{className:"p-1 border-t ".concat((t+1)%2===0?"bg-[#fafafa]":"bg-white"),children:(0,N.jsx)("div",{className:"w-[150px] text-[13px]",children:q.getFieldValue(["rosters",t,"InDescr"])})}),(0,N.jsx)("td",{className:"p-1 border-t ".concat((t+1)%2===0?"bg-[#fafafa]":"bg-white"),children:(0,N.jsx)("div",{className:"w-[180px] text-[13px]",children:v()(q.getFieldValue(["rosters",t,"OutEventDate"])).format("YYYY-MM-DD")})}),(0,N.jsx)("td",{className:"p-1 border-t ".concat((t+1)%2===0?"bg-[#fafafa]":"bg-white"),children:(0,N.jsx)("div",{className:"w-[150px] text-[13px]",children:q.getFieldValue(["rosters",t,"OutDescr"])})}),(0,N.jsx)("td",{className:"p-1 border-t ".concat((t+1)%2===0?"bg-[#fafafa]":"bg-white"),children:(0,N.jsx)("button",{type:"button",className:"dlt-button text-xs",onClick:function(){return n(t)},children:"Remove"})})]})}))})]})})}}),(0,N.jsx)("div",{className:"col-span-12 flex gap-5 mt-8",children:(0,N.jsx)(i.Z.Item,{className:"m-0",children:(0,N.jsx)(c.Button,{type:"primary",onClick:function(){return q.submit()},loading:S,children:"Submit"})})})]}),(0,N.jsx)(c.Modal,{title:"Replace Employee",open:F,onCancel:function(){return R(!1)},width:1e3,children:(0,N.jsx)(c.PeopleSearch,{onSelect:function(e){q.setFieldValue(["rosters",Z,"EmployeeName"],"".concat(e.Firstname," ").concat(e.Lastname)),q.setFieldValue(["rosters",Z,"NewEmployeeId"],e.Id),R(!1)},onRowDblClick:function(e){return P("/tas/people/search/".concat(e.data.Id))}})}),(0,N.jsx)(c.Modal,{title:"Skipped Employees",open:O,onCancel:function(){h(),U(),V(!1)},children:(0,N.jsx)(c.Table,{containerClass:"shadow-none border overflow-hidden px-0",data:A,columns:[{label:"Fullname",name:"Firstname",alignment:"left",cellRender:function(e){return(0,N.jsxs)("div",{children:[e.value," ",e.data.Lastname]})}},{label:"",name:"Reason",alignment:"left",cellRender:function(e){return(0,N.jsx)("div",{className:"text-red-400",children:e.value})}}]})})]})},I=n(14261);var w=function(){var e,t=(0,r.useState)([]),n=(0,s.Z)(t,2),p=n[0],b=n[1],g=(0,r.useState)([]),y=(0,s.Z)(g,2),w=y[0],D=y[1],S=(0,r.useState)([]),C=(0,s.Z)(S,2),k=C[0],E=C[1],F=(0,r.useState)(!1),R=(0,s.Z)(F,2),Y=R[0],M=R[1],O=(0,r.useState)(!1),V=(0,s.Z)(O,2),B=V[0],L=V[1],A=(0,r.useState)(!1),T=(0,s.Z)(A,2),z=T[0],q=T[1],G=(0,r.useState)(!1),P=(0,s.Z)(G,2),U=P[0],K=P[1],_=(0,r.useState)(null),H=(0,s.Z)(_,2),J=H[0],Q=H[1],W=(0,r.useState)([]),X=(0,s.Z)(W,2),$=X[0],ee=X[1],te=(0,r.useState)([]),ne=(0,s.Z)(te,2),ae=ne[0],le=ne[1],se=(0,r.useState)([]),ce=(0,s.Z)(se,2),re=ce[0],ie=ce[1],oe=(0,r.useState)(!1),de=(0,s.Z)(oe,2),ue=de[0],me=de[1],he=(0,r.useState)(!1),fe=(0,s.Z)(he,2),xe=fe[0],pe=fe[1],ve=i.Z.useForm(),je=(0,s.Z)(ve,1)[0],be=(0,f.UO)().eventId,ge=(0,r.useContext)(j.V).state,Ne=(0,f.s0)();(0,r.useEffect)((function(){ye(),Ze()}),[]);var ye=function(){M(!0),(0,d.Z)({method:"get",url:"tas/visitevent/".concat(be)}).then((function(e){b(e.data),D(e.data.Employees)})).catch((function(e){})).then((function(){return M(!1)}))},Ze=function(){M(!0),(0,d.Z)({method:"get",url:"tas/cluster/activetransports/".concat(be)}).then((function(e){var t=[];e.data.map((function(e){t.push((0,l.Z)({value:e.Id,label:"".concat(e.Code," - ").concat(e.Description)},e))})),E(t)})).catch((function(e){})).then((function(){return M(!1)}))},Ie=[{label:"Employee",name:"Firstname",alignment:"left",cellRender:function(e){return e.data.Id?(0,N.jsx)(x.Link,{to:"/tas/people/search/".concat(e.data.EmployeeId),children:(0,N.jsxs)("span",{className:"text-blue-500",children:[e.value," ",e.data.Lastname]})}):(0,N.jsxs)("span",{children:[e.value," ",e.data.Lastname]})}},{label:"In Event Date",name:"InEventDate",alignment:"left",cellRender:function(e){return(0,N.jsx)("div",{children:v()(e.value).format("YYYY-MM-DD")})}},{label:"In",name:"InDescr",alignment:"left"},{label:"In Status",name:"InStatus",alignment:"left",cellRender:function(e){return(0,N.jsx)(o.Z,{color:"Confirmed"===e.value?"green":"orange",children:e.value})}},{label:"Out Event Date",name:"OutEventDate",cellRender:function(e){return(0,N.jsx)("div",{children:v()(e.value).format("YYYY-MM-DD")})}},{label:"Out",name:"OutDescr"},{label:"Out Status",name:"OutStatus",alignment:"left",cellRender:function(e){return(0,N.jsx)(o.Z,{color:"Confirmed"===e.value?"green":"orange",children:e.value})}},{label:"",name:"action",cellRender:function(e){return(0,N.jsx)("div",{children:2===e.data.Active?(0,N.jsx)("button",{className:"edit-button",onClick:function(){return Se(e.data)},children:"Replace Profile"}):(0,N.jsx)("button",{className:"edit-button",onClick:function(){return t=e.data,Q(t),void pe(!0);var t},children:"Undo Replacement"})})}}],we=[{label:"Transportation Type",name:"activeTransportId",className:"col-span-12 mb-2",type:"select",inputprops:{options:k}},{label:"Sequence Number",name:"seqNumber",className:"col-span-12 mb-2",type:"number",inputprops:{min:0}}],De=function(){je.resetFields(),L(!1)},Se=function(e){Q(e),K(!0)},Ce=function(){if(0===ae.length)le(re),je.setFieldValue("rosters",re),ie([]);else{var e=(0,a.Z)(ae);re.map((function(t){null!==e&&void 0!==e&&e.find((function(e){return e.Id===t.Id}))||e.length<50&&e.push(t)})),le(e),ie([])}};return(0,N.jsx)(N.Fragment,{children:ue?(0,N.jsx)(Z,{data:ae,handleChangeData:function(e){ee(e.map((function(e){return e.Id}))),le(e)},changeIsEditing:me,className:"".concat(ue?"block":"hidden"),refreshData:ye}):(0,N.jsxs)("div",{children:[(0,N.jsxs)("div",{className:"rounded-ot bg-white p-5 mb-5 shadow-md",children:[(0,N.jsx)("div",{className:"flex mb-4",children:(0,N.jsx)(c.Button,{onClick:function(){return Ne(-1)},icon:(0,N.jsx)(u.Z,{}),children:"Back"})}),(0,N.jsx)("div",{className:"text-lg font-bold mb-3",children:p.Name}),(0,N.jsxs)("div",{className:"w-1/3",children:[(0,N.jsxs)("div",{className:"flex",children:[(0,N.jsx)("div",{className:"w-[100px]",children:"Start Date:"})," ",(0,N.jsx)("div",{children:v()(p.StartDate).format("YYYY-MM-DD")})]}),(0,N.jsxs)("div",{className:"flex",children:[(0,N.jsx)("div",{className:"w-[100px]",children:"End Date:"})," ",(0,N.jsx)("div",{children:v()(p.EndDate).format("YYYY-MM-DD")})]})]})]}),(0,N.jsx)(c.Table,{data:w,columns:Ie,isGrouping:!1,allowColumnReordering:!1,loading:Y,keyExpr:"Id",pager:w>20,selection:{mode:"multiple",recursive:!1,showCheckBoxesMode:"always",selectAllMode:"page"},selectedRowKeys:$,onSelectionChanged:function(e){ee(e.selectedRowKeys),ie(e.selectedRowsData.map((function(e){return(0,l.Z)((0,l.Z)({},e),{},{Fullname:"".concat(e.Firstname," ").concat(e.Lastname)})})))},title:null!==(e=ge.userInfo)&&void 0!==e&&e.ReadonlyAccess?"":(0,N.jsxs)("div",{className:"flex justify-between items-center py-2 gap-3 border-b",children:[(0,N.jsxs)("div",{className:"ml-2",children:[(0,N.jsx)("span",{className:"font-bold",children:ae.length})," people selected ",50===ae.length&&(0,N.jsx)("span",{className:"text-red-400",children:"(full)"})]}),(0,N.jsxs)("div",{className:"flex items-center gap-3",children:[(0,N.jsx)(c.Button,{onClick:Ce,disabled:50===ae.length||0===$.length,children:"Add Selection"}),(0,N.jsx)(c.Button,{onClick:function(){50!==ae.length&&Ce(),me(!0)},disabled:0===ae.length&&0===$.length,children:"Add Selection & Replace"})]})]})}),(0,N.jsxs)(c.Modal,{open:B,title:"Add Record",closeIcon:(0,N.jsx)("div",{className:"flex items-center justify-center",children:(0,N.jsx)(m.Z,{})}),onCancel:De,width:600,destroyOnClose:!0,children:[(0,N.jsx)(c.Form,{form:je,fields:we,className:"grid grid-cols-12 gap-x-8 mt-5",onFinish:function(e){q(!0),(0,d.Z)({method:"post",url:"tas/clusterdetail",data:(0,l.Z)((0,l.Z)({},e),{},{eventId:be})}).then((function(e){ye(),L(!1)})).catch((function(e){})).then((function(){return q(!1)}))}}),(0,N.jsxs)("div",{className:"flex gap-4 justify-end",children:[(0,N.jsx)(c.Button,{onClick:function(){return je.submit()},type:"primary",loading:z,icon:(0,N.jsx)(h.Z,{}),children:"Save"}),(0,N.jsx)(c.Button,{onClick:De,disablde:z,children:"Cancel"})]})]}),(0,N.jsx)(c.Modal,{open:U,title:"Replace Employee (".concat(null===J||void 0===J?void 0:J.Firstname," ").concat(null===J||void 0===J?void 0:J.Lastname,")"),closeIcon:(0,N.jsx)("div",{className:"flex items-center justify-center",children:(0,N.jsx)(m.Z,{})}),onCancel:function(){return K(!1)},width:1e3,destroyOnClose:!0,children:(0,N.jsx)(c.PeopleSearch,{onSelect:function(e){return function(e){q(!0),(0,d.Z)({method:"post",url:"tas/visitevent/replaceprofile",data:{oldEmployeeId:J.EmployeeId,newEmployeeId:e.Id,eventId:be}}).then((function(e){K(!1),ye()})).finally((function(){q(!1)}))}(e)},onRowDblClick:function(e){return Ne("/tas/people/search/".concat(e.data.Id))}})}),(0,N.jsxs)(I.GI,{visible:xe,showTitle:!1,height:120,width:350,children:[(0,N.jsx)("div",{children:"Are you sure you want to undo replacement on this record?"}),(0,N.jsxs)("div",{className:"flex gap-5 mt-4 justify-center",children:[(0,N.jsx)(c.Button,{type:1===(null===J||void 0===J?void 0:J.Active)?"primary":"success",onClick:function(){(0,d.Z)({method:"post",url:"tas/visitevent/replaceprofileundo",data:{employeeId:J.EmployeeId,eventId:be}}).then((function(e){ye()})).catch((function(e){}))},loading:z,children:"Yes"}),(0,N.jsx)(c.Button,{onClick:function(){return pe(!1)},disabled:z,children:"No"})]})]})]})})}}}]);