"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[1512],{11512:function(e,t,n){n.r(t);var s=n(1413),a=n(29439),l=n(56573),i=n(2880),o=n(47313),c=n(65040),d=n(74294),r=n(93031),u=n(58467),f=n(10658),h=n.n(f),m=n(42614),p=n(165),x=n(46417),v=function(e){var t=e.date,n=e.isEdit,s=e.data,a=e.shiftStatus,l=null===s||void 0===s?void 0:s.find((function(e){return h()(e.EventDate).format("YYYY-MM-DD")===h()(t).format("YYYY-MM-DD")})),i=a.all.find((function(e){return e.Id===(null===l||void 0===l?void 0:l.ShiftId)}));return(0,x.jsxs)("div",{className:"h-[50px] w-full flex justify-between gap-2",children:[(0,x.jsx)("div",{className:"flex flex-col items-start",children:(0,x.jsx)("div",{className:"font-medium",children:h()(t).format("DD")})}),l&&(0,x.jsx)(c.Z.Item,{className:"m-0 p-0 flex-1 self-center",name:[l.index,"ShiftId"],children:(0,x.jsx)(d.Z,{disabled:!n,bordered:!1,style:{background:null===i||void 0===i?void 0:i.ColorCode},className:"w-full rounded-md",popupMatchSelectWidth:!1,optionlabelProp:"label",size:"small",children:i?1===i.OnSite?a.onsite.map((function(e,t){return(0,x.jsx)(d.Z.Option,{value:e.value,label:e.label,children:e.label},t)})):a.offsite.map((function(e,t){return(0,x.jsx)(d.Z.Option,{value:e.value,label:e.label,children:e.label},t)})):a.all.map((function(e,t){return(0,x.jsx)(d.Z.Option,{value:e.value,label:e.label,children:e.label},t)}))})})]})};t.default=function(){var e,t=(0,u.f_)(),n=(0,o.useState)([]),d=(0,a.Z)(n,2),f=d[0],j=d[1],g=(0,o.useState)(h()()),b=(0,a.Z)(g,2),C=b[0],Z=b[1],D=(0,o.useState)({all:[],bulk:[],offsite:[],onsite:[]}),N=(0,a.Z)(D,2),S=N[0],y=N[1],Y=(0,o.useState)(!1),k=(0,a.Z)(Y,2),I=k[0],w=k[1],M=(0,o.useState)(!1),F=(0,a.Z)(M,2),O=F[0],B=F[1],E=(0,o.useState)(!1),q=(0,a.Z)(E,2),R=q[0],A=q[1],P=c.Z.useForm(),V=(0,a.Z)(P,1)[0],_=c.Z.useForm(),z=(0,a.Z)(_,1)[0],L=(0,u.UO)().empId,U=(0,o.useContext)(m.V),W=U.state,G=U.action;(0,o.useEffect)((function(){J()}),[]),(0,o.useEffect)((function(){H()}),[C]);var H=function(){(0,l.Z)({method:"get",url:"tas/employeestatus/visualstatusdates/".concat(L,"/").concat(h()(C).startOf("month").format("YYYY-MM-DD"))}).then((function(e){var t=[];e.data.map((function(e,n){t.push((0,s.Z)({index:n},e))})),V.setFieldsValue({shift:t}),j(t)})).catch((function(e){}))},J=function(){(0,l.Z)({method:"get",url:"tas/shift?Active=1"}).then((function(e){var t=[],n=[],a=[],l=[];e.data.map((function(e){t.push((0,s.Z)({value:e.Id,label:"".concat(e.Code)},e)),l.push((0,s.Z)({value:e.Id,label:"".concat(e.Code,"-").concat(e.Description)},e)),1===e.OnSite?n.push((0,s.Z)({value:e.Id,label:e.Code},e)):a.push((0,s.Z)({value:e.Id,label:e.Code},e))})),y({all:t,bulk:l,offsite:a,onsite:n})})).catch((function(e){}))},K=[{type:"component",component:(0,x.jsx)(c.Z.Item,{name:"rangeDate",label:"Date",className:"col-span-12 mb-4",rules:[{required:!0,message:"Date is required"}],children:(0,x.jsx)(r.Z.RangePicker,{className:"w-full"})})},{label:"Shift",name:"ShiftId",className:"col-span-12 mb-4",rules:[{required:!0,message:"Shift is required"}],type:"select",inputprops:{options:S.bulk}}],Q=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s=0,a=[];s<e.length;)a.push((0,x.jsxs)("div",{className:"flex flex-col gap-1",children:[0===s?(0,x.jsx)("div",{className:"text-gray-500 font-bold mb-2",children:t}):(0,x.jsx)("div",{className:"mb-2",children:"\xa0"}),e.slice(s,s+n).map((function(e,t){return(0,x.jsxs)("div",{className:"flex items-start gap-2",children:[(0,x.jsx)("div",{className:"w-[50px] text-center py-[2px] rounded-md",style:{backgroundColor:e.ColorCode},children:(0,x.jsx)("div",{className:"text-xs",style:{color:(0,p.Z)(e.ColorCode)>60?"black":"white"},children:e.Code})}),(0,x.jsxs)("div",{className:"leading-none",children:[e.Description," "]})]},t)}))]},s)),s+=n;return a};return(0,x.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,x.jsx)("div",{className:"bg-white px-5 py-3 rounded-ot shadow-card",children:(0,x.jsx)(i.ProfileCalendar,{profile:t})}),(0,x.jsxs)("div",{className:"bg-white rounded-ot p-4 col-span-12 shadow-md",children:[(0,x.jsx)("div",{className:"text-lg font-bold mb-3",children:"Shift Visual"}),(0,x.jsxs)("div",{className:"grid grid-cols-12 gap-5",children:[(0,x.jsx)("div",{className:"col-span-12 2xl:col-span-6",children:(0,x.jsxs)(c.Z,{form:V,component:!1,onFinish:function(e){var t=[];e.shift.map((function(e){e.ShiftId&&t.push(e)})),(0,l.Z)({method:"post",url:"tas/employeestatus/visualstatusdatechange",data:{employeeId:L,statusDates:[].concat(t)}}).then((function(e){H(),G.changedFlight(W.ChangedFlight+1),w(!1)})).catch((function(e){}))},children:[(0,x.jsx)(c.Z.List,{name:"shift",children:function(e){var t;return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(i.ShiftCalendar,{containerClass:"shadow-none",picker:"date",onChange:function(e){return Z(h()(e).format("YYYY-MM-DD"))},data:f,cellRender:function(e){return(0,x.jsx)(v,{date:e,isEdit:I,data:f,shiftStatus:S})},currentDate:C,extraComponent:null!==(t=W.userInfo)&&void 0!==t&&t.ReadonlyAccess?null:(0,x.jsx)("div",{className:"flex justify-end flex-1",children:(0,x.jsx)(i.Button,{onClick:function(){return B(!0)},children:"Bulk Change"})})})})}}),(0,x.jsx)(c.Z.Item,{className:"mt-2 flex justify-end",children:null!==(e=W.userInfo)&&void 0!==e&&e.ReadonlyAccess?null:I?(0,x.jsxs)("div",{className:"flex gap-4",children:[(0,x.jsx)(i.Button,{type:"success",onClick:function(){return V.submit()},children:"Save"}),(0,x.jsx)(i.Button,{onClick:function(){return w(!1)},children:"Cancel"})]}):(0,x.jsx)(i.Button,{type:"primary",onClick:function(){return w(!0)},children:"Edit"})})]})}),(0,x.jsxs)("div",{className:"col-span-12 2xl:col-span-6 flex justify-around flex-wrap",children:[Q(S.onsite.sort((function(e,t){return e.Code>t.Code?1:e.Code<t.Code?-1:0})),"On Site Shifts",16),Q(S.offsite.sort((function(e,t){return e.Code>t.Code?1:e.Code<t.Code?-1:0})),"Off Site Shifts",16)]})]}),(0,x.jsxs)(i.Modal,{title:"Bulk Change",open:O,onCancel:function(){B(!1),z.resetFields()},destroyOnClose:!0,children:[(0,x.jsx)(i.Form,{fields:K,form:z,onFinish:function(e){A(!0),(0,l.Z)({method:"post",url:"tas/employeestatus/visualstatusbulkchange",data:{employeeId:L,startDate:h()(e.rangeDate[0]).format("YYYY-MM-DD"),endDate:h()(e.rangeDate[1]).format("YYYY-MM-DD"),shiftId:e.ShiftId}}).then((function(e){B(!1),H(),G.changedFlight(W.ChangedFlight+1)})).catch((function(e){})).then((function(){return A(!1)}))}}),(0,x.jsx)("div",{className:"flex justify-end",children:(0,x.jsx)(i.Button,{type:"success",onClick:function(){return z.submit()},loading:R,children:"Save"})})]})]})]})}}}]);