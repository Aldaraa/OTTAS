"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[2837],{98902:function(e,t,n){var a=n(29439),r=n(47313),l=n(52341),s=n(2880),o=n(46417);t.Z=function(e){var t=e.data,n=e.onCancel,i=e.onSave,d=e.values,c=(0,r.useState)([]),u=(0,a.Z)(c,2),m=u[0],p=u[1],f=(0,r.useState)(d),h=(0,a.Z)(f,2),x=h[0],v=h[1];(0,r.useEffect)((function(){t&&p(t)}),[t]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.Z,{dataSource:m,titles:["Columns","Selected Columns"],targetKeys:x,onChange:function(e,t,n){v(e)},showSearch:!0,filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.title)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())},render:function(e){return e.title},oneWay:!0,listStyle:{width:400,height:400},style:{marginBottom:16}}),(0,o.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,o.jsx)(s.Button,{type:"primary",onClick:function(){i&&i(x)},children:"OK"}),(0,o.jsx)(s.Button,{onClick:function(){n&&n()},children:"Cancel"})]})]})}},52837:function(e,t,n){n.r(t),n.d(t,{default:function(){return v}});var a=n(1413),r=n(29439),l=n(2880),s=n(14261),o=n(47313),i=n(42614),d=n(22891),c=n(21975),u=n(70380),m=n(74294),p=n(98902),f=n(46417);var h=function(e){var t,n=e.templates,s=e.form,i=e.onChangeParameters,c=(0,o.useState)(!1),u=(0,r.Z)(c,2),h=(u[0],u[1]),x=(0,o.useState)(!1),v=(0,r.Z)(x,2),b=v[0],j=v[1],C=(0,o.useState)(null),N=(0,r.Z)(C,2),g=N[0],y=N[1],I=l.Form.useWatch([],s);(0,o.useEffect)((function(){null!==I&&void 0!==I&&I.reportTemplateId&&S(null===I||void 0===I?void 0:I.reportTemplateId)}),[I]);var S=function(e){h(!0),(0,d.k)({method:"get",url:"tasreport/reporttemplate/".concat(e)}).then((function(e){var t=[],n={};e.data.Columns.map((function(e,n){t.push((0,a.Z)((0,a.Z)({},e),{},{key:"".concat(e.Id),title:e.Caption,label:e.Caption,value:"".concat(e.Id)}))})),e.data.Parameters.map((function(e,t){n["".concat(e.FielName)]=e})),i&&i(n),y((0,a.Z)((0,a.Z)({},e.data),{},{Columns:t}))})).catch((function(e){})).then((function(){return h(!1)}))};return(0,f.jsxs)("div",{className:"col-span-12 flex flex-col gap-6",children:[(0,f.jsxs)("div",{className:"border rounded-ot py-4 px-6 pb-2",children:[(0,f.jsx)("div",{className:"text-xl mb-3",children:"Report"}),(0,f.jsx)(l.Form.Item,{className:"col-span-6 mb-2",name:"reportTemplateId",label:"Report Template",rules:[{required:!0,message:"Report Template is required"}],children:(0,f.jsx)(m.Z,{options:n,placeholder:"Select template",filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())},showSearch:!0,disabled:!0})})]}),(0,f.jsxs)("div",{className:"border rounded-ot px-4 py-4",children:[(0,f.jsx)("div",{className:"text-xl mb-3",children:"Actions"}),(0,f.jsxs)("table",{className:"w-full table table-fixed border-collapse border rounded-t-md border-slate-300 text-xs",children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{className:"text-left text-gray-400",children:[(0,f.jsx)("th",{className:"border border-slate-300 px-2 font-medium w-[140px]",children:"Name"}),(0,f.jsx)("th",{className:"border border-slate-300 px-2 font-medium w-auto",children:"Description"}),(0,f.jsx)("th",{className:"border border-slate-300 px-2 font-medium w-auto",children:"Value"})]})}),(0,f.jsxs)("tbody",{children:[(null===g||void 0===g||null===(t=g.Columns)||void 0===t?void 0:t.length)>0?(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{className:"border border-slate-300 px-2",children:"Columns"}),(0,f.jsx)("td",{className:"border border-slate-300 px-2",children:"Include these additional fields in the report"}),(0,f.jsxs)("td",{className:"border border-slate-300 px-2 flex gap-2",children:[(0,f.jsx)(l.Form.Item,{name:"columnIds",className:"my-1 flex-1",children:(0,f.jsx)(m.Z,{options:null===g||void 0===g?void 0:g.Columns,mode:"multiple",disabled:!0})}),(0,f.jsx)(l.Form.Item,{className:"my-1",children:(0,f.jsx)(l.Button,{onClick:function(){return j(!0)},children:"..."})})]})]}):null,(0,f.jsx)(l.Form.Item,{noStyle:!0,name:"parameters",children:null===g||void 0===g?void 0:g.Parameters.map((function(e){return"TAS_DYNAMIC_DATE"===e.Component?(0,f.jsxs)("tr",{className:"bg-[#e4f2fd]",children:[(0,f.jsx)("td",{className:"border border-slate-300 px-2",children:e.Caption}),(0,f.jsx)("td",{className:"border border-slate-300 px-2",children:e.Descr?e.Descr:e.Component}),(0,f.jsx)("td",{className:"border border-slate-300 px-2",children:(0,l.ReportFields)(e,"parameters",s,g)})]}):(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{className:"border border-slate-300 px-2",children:e.Caption}),(0,f.jsxs)("td",{className:"border border-slate-300 px-2",children:[e.Descr," ",e.Component]}),(0,f.jsx)("td",{className:"border border-slate-300 px-2",children:(0,l.ReportFields)(e,"parameters",s,g)})]})}))})]})]})]}),(0,f.jsx)(l.Modal,{width:700,title:"Column Selection",open:b,onCancel:function(){return j(!1)},children:(0,f.jsx)(p.Z,{data:null===g||void 0===g?void 0:g.Columns,onCancel:function(){return j(!1)},onSave:function(e){s.setFieldValue("columnIds",e),j(!1)},values:s.getFieldValue("columnIds")})})]})},x=n(6761);var v=function(){var e=(0,o.useState)([]),t=(0,r.Z)(e,2),n=t[0],m=t[1],p=(0,o.useState)(!1),v=(0,r.Z)(p,2),b=v[0],j=(v[1],(0,o.useState)(!1)),C=(0,r.Z)(j,2),N=C[0],g=C[1],y=(0,o.useState)(null),I=(0,r.Z)(y,2),S=I[0],F=I[1],Z=(0,o.useState)(!1),D=(0,r.Z)(Z,2),k=(D[0],D[1]),w=(0,o.useState)(!1),T=(0,r.Z)(w,2),R=T[0],V=T[1],A=(0,o.useState)(null),E=(0,r.Z)(A,2),B=E[0],L=E[1],O=(0,o.useState)(!1),P=(0,r.Z)(O,2),M=P[0],_=P[1],J=(0,o.useState)([]),K=(0,r.Z)(J,2),q=(K[0],K[1]),W=(0,o.useRef)(null),z=(0,o.useContext)(i.V),Y=z.action,G=z.state,H=l.Form.useForm(),Q=(0,r.Z)(H,1)[0];(0,o.useEffect)((function(){Y.changeMenuKey("/report/template"),U(),X()}),[]);var U=function(){var e;null===(e=W.current.instance)||void 0===e||e.beginCustomLoading(),(0,d.k)({method:"get",url:"tasreport/ReportTemplate"}).then((function(e){var t;m(null===(t=e.data)||void 0===t?void 0:t.map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{value:e.Id,label:e.Description})})))})).catch((function(e){})).then((function(){var e;return null===(e=W.current)||void 0===e?void 0:e.instance.endCustomLoading()}))},X=function(){G.referData.dateTypes||d.k.get("tasreport/reporttemplate/datetypes").then((function(e){var t,n=null===(t=e.data.DateVariables)||void 0===t?void 0:t.map((function(e){return{value:e,label:e}}));Y.setReferDataItem({dateTypes:n})})).catch((function(e){}))},$=[{label:"Code",name:"Code"},{label:"Description",name:"Description"},{label:"Schedules",name:"ScheduleCount",alignment:"left"},{label:"Active",name:"Active",width:"80px",alignment:"center",cellRender:function(e){return(0,f.jsx)(s.Jg,{disabled:!0,iconSize:18,value:1===e.data.Active||0})}},{label:"",name:"action",width:"120px",alignment:"center",cellRender:function(e){var t;return(0,f.jsxs)("div",{className:"flex gap-2 items-center justify-end",children:[(0,f.jsx)("button",{className:"edit-button",onClick:function(t){return n=e.data,Q.setFieldValue("reportTemplateId",n.Id),q(n),void _(!0);var n},children:"Run"}),"SystemAdmin"===(null===(t=G.userInfo)||void 0===t?void 0:t.Role)?(0,f.jsx)("button",{className:"edit-button",onClick:function(t){return n=e.data,void(0,d.k)({method:"get",url:"tasreport/ReportTemplate/".concat(n.Id)}).then((function(e){e.data.Parameters.map((function(e){Q.setFieldValue([e.FielName,"Id"],e.Id),Q.setFieldValue([e.FielName,"Descr"],e.Descr)})),F(e.data),g(!0)})).catch((function(e){}));var n},children:"Edit"}):null]})}}];return(0,f.jsxs)("div",{children:[(0,f.jsx)(l.Table,{ref:W,data:n||[],columns:$,allowColumnReordering:!1,loading:b,keyExpr:"Id",tableClass:"border-t",rowAlternationEnabled:!0,pager:!1,title:(0,f.jsx)("div",{className:"flex justify-between py-2 px-1",children:(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[(0,f.jsx)("span",{className:"font-bold",children:null===n||void 0===n?void 0:n.length}),(0,f.jsx)("span",{className:" text-gray-400",children:"results"})]})})}),(0,f.jsx)(l.Modal,{open:N,title:"Edit Descriptions of ".concat(null===S||void 0===S?void 0:S.Description),onCancel:function(){return g(!1)},noLayoutConfig:!0,children:(0,f.jsxs)(l.Form,{form:Q,onFinish:function(e){k(!0);var t=Object.keys(e),n=[];t.map((function(t){n.push(e[t])})),(0,d.k)({method:"put",url:"tasreport/ReportTemplate/parameter",data:{data:n}}).then((function(e){g(!1),F(null)})).catch((function(e){})).finally((function(){return k(!1)}))},layout:"vertical",className:"grid grid-cols-12 gap-x-8",children:[null===S||void 0===S?void 0:S.Parameters.map((function(e){return(0,f.jsxs)("div",{className:"col-span-12",children:[(0,f.jsx)(l.Form.Item,{noStyle:!0,name:[e.FielName,"Id"],className:"col-span-12"}),(0,f.jsx)(l.Form.Item,{name:[e.FielName,"Descr"],label:e.FielName,className:"col-span-12 mb-2",children:(0,f.jsx)(c.Z.TextArea,{})})]})})),(0,f.jsxs)("div",{className:"col-span-12 flex justify-end gap-4",children:[(0,f.jsx)(l.Button,{type:"primary",onClick:function(){return Q.submit()},children:"Save"}),(0,f.jsx)(l.Button,{onClick:function(){return g(!1)},children:"Cancel"})]})]})}),(0,f.jsx)(l.Modal,{footer:(0,f.jsx)("div",{className:"col-span-12 flex justify-end items-center gap-2",children:(0,f.jsx)(l.Button,{type:"primary",onClick:function(){return Q.submit()},loading:R,icon:(0,f.jsx)(u.Z,{}),children:"Run"})}),open:M,width:1100,onCancel:function(){return _(!1)},title:"Run Job",children:(0,f.jsx)(l.Form,{labelAlign:"left",form:Q,onFinish:function(){V(!0);var e=Q.getFieldsValue(),t=[];e.parameters&&Object.keys(e.parameters).map((function(n){e.parameters[n]&&("StartDate"===n||"EndDate"===n||"CurrentDate"===n?t.push({parameterId:B[n].Id,parameterValue:e.parameters[n].FieldValue,Days:e.parameters[n].Days}):t.push({parameterId:B[n].Id,parameterValue:"string"!==typeof e.parameters[n]?JSON.stringify(e.parameters[n]):e.parameters[n]}))})),(0,d.k)({method:"post",url:"reportjob/buildreport",responseType:"blob",data:{reportTemplateId:e.reportTemplateId,columnIds:e.columnIds,parameters:t}}).then((function(e){var t=e.headers["content-disposition"].split("; ")[1].replace("filename=","");(0,x.p)(e.data,t),_(!1)})).catch((function(e){})).then((function(){return V(!1)}))},className:"gap-x-4",labelCol:{sm:{span:6}},initValues:{scheduleType:"Daily"},children:(0,f.jsx)(h,{onChangeParameters:function(e){return L(e)},templates:n,form:Q})})})]})}}}]);