"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[2492],{32492:function(e,t,n){n.r(t);var a=n(45987),l=n(1413),s=n(29439),o=n(47313),d=n(2880),r=n(14261),i=n(58821),c=n(18711),u=n(56573),m=n(12998),p=n(65040),h=n(93031),x=n(58467),f=n(42614),v=n(42956),b=n(10658),g=n.n(b),j=n(95585),y=n.n(j),N=n(46417),Z=["key","name"];t.default=function(){var e,t=(0,x.TH)(),n=(0,o.useState)([]),b=(0,s.Z)(n,2),j=(b[0],b[1]),I=(0,o.useState)(!1),w=(0,s.Z)(I,2),R=w[0],C=w[1],F=(0,o.useState)([]),k=(0,s.Z)(F,2),D=k[0],S=k[1],T=(0,o.useState)([]),A=(0,s.Z)(T,2),L=A[0],M=A[1],Y=(0,o.useState)([]),V=(0,s.Z)(Y,2),B=V[0],E=V[1],_=(0,o.useState)(!1),z=(0,s.Z)(_,2),H=z[0],O=z[1],P=(0,o.useState)(new v.Z({key:"Id",load:function(e){var t,n,a,s="";return(null===(t=e.sort)||void 0===t?void 0:t.length)>1&&(s="?sortby=".concat(e.sort[0].selector,"&sortdirection=").concat(e.sort[0].desc?"desc":"asc")),e.filter&&!y()(e.filter)?(null===(n=te.current)||void 0===n||n.instance.beginCustomLoading(),(0,u.Z)({method:"post",url:"tas/employee/search".concat(s),data:{model:(0,l.Z)((0,l.Z)({},e.filter),{},{Active:1}),pageIndex:e.skip/e.take,pageSize:e.take}}).then((function(e){return j(e.data.data),{data:e.data.data,totalCount:e.data.totalcount}})).finally((function(){var e;return null===(e=te.current)||void 0===e?void 0:e.instance.endCustomLoading()}))):y()(e.filter)||"undefined"!==typeof e.filter?void 0:(null===(a=te.current)||void 0===a||a.instance.beginCustomLoading(),(0,u.Z)({method:"post",url:"tas/employee/search".concat(s),data:{model:{CampId:"",DepartmentId:"",Firstname:"",FlightGroupMasterId:"",Lastname:"",LocationId:"",NRN:"",roomNumber:"",RoomTypeId:"",costCodeId:"",employerId:"",futureBookingId:"",group:"",id:"",peopleTypeId:"",roomAssignment:"",rosterId:"",sapId:"",mobile:"",hasRoom:"",futureBooking:"",Active:1},pageIndex:e.skip/e.take,pageSize:e.take}}).then((function(e){return j(e.data.data),{data:e.data.data,totalCount:e.data.totalcount}})).finally((function(){var e;return null===(e=te.current)||void 0===e?void 0:e.instance.endCustomLoading()})))}})),U=(0,s.Z)(P,1)[0],G=(0,o.useContext)(f.V).state,q=m.ZP.useNotification(),J=(0,s.Z)(q,2),K=J[0],Q=J[1],W=p.Z.useForm(),X=(0,s.Z)(W,1)[0],$=p.Z.useForm(),ee=(0,s.Z)($,1)[0],te=(0,o.useRef)(null);(0,o.useEffect)((function(){t.state&&X.setFieldValue(t.state.name,t.state.value)}),[]),(0,o.useEffect)((function(){var e=[],t=ee.getFieldsValue().employeeIds;null===L||void 0===L||L.map((function(n){if(t){var a=null===t||void 0===t?void 0:t.find((function(e){return e.Id===n.Id}));a?e.push(a):e.push(n)}else e.push(n)})),ee.setFieldsValue({employeeIds:e})}),[L]);var ne=[{label:"Person #",name:"Id",dataType:"string",width:"70px"},{label:"",name:"Active",width:"21px",alignment:"center",showInColumnChooser:!1,allowSorting:!1,cellRender:function(e){return(0,N.jsx)(c.DcD,{color:1===e.value?"lime":"lightgray"})}},{label:"Firstname",name:"Firstname",dataType:"string"},{label:"Lastname",name:"Lastname",dataType:"string"},{label:"Department",name:"DepartmentName",dataType:"string",width:"220px"},{label:"Employer",name:"EmployerName",dataType:"string"},{label:"Roster",name:"RosterName",dataType:"string",width:"70px",enableFilter:!0},{label:"Resource Type",name:"PeopleTypeName",dataType:"string"},{label:"Room",name:"RoomNumber",cellRender:function(e){return(0,N.jsx)("span",{children:e.value})}},{label:"Gender",name:"Gender",alignment:"center",width:"70px",cellRender:function(e){return(0,N.jsx)("span",{children:1===e.data.Gender?"M":"F"})},groupCellRender:function(e){return(0,N.jsxs)("span",{children:[1===e.value?"M":"F"," ",e.groupContinuesMessage?"- ".concat(e.groupContinuesMessage):""]})}},{label:"",name:"HasFutureTransport",width:"50px",cellRender:function(e){return(0,N.jsx)(r.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})},headerCellRender:function(e,t){return(0,N.jsx)(i.dm9,{})}},{label:"",name:"HasFutureRoomBooking",width:"50px",cellRender:function(e,t){return(0,N.jsx)(r.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})},headerCellRender:function(e,t){return(0,N.jsx)("i",{className:"dx-icon-home"})}}],ae=function(){M(B)},le=function(){var e;O(!1),S(null===(e=ee.getFieldValue("employeeIds"))||void 0===e?void 0:e.map((function(e){return e.Id}))),M(ee.getFieldValue("employeeIds"))};return(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{className:"rounded-ot bg-white px-3 py-2 mb-3",children:(0,N.jsx)(d.SearchPeopleForm,{containerClass:"bg-white rounded-ot py-2 mb-3",onSearch:function(e){var t;null===(t=te.current)||void 0===t||t.instance.filter(e)},hideFields:["Active"]})}),(0,N.jsx)(d.Table,{ref:te,data:U,columns:ne,allowColumnReordering:!1,remoteOperations:!0,id:"room",showRowLines:!0,selection:{mode:"multiple",recursive:!1,showCheckBoxesMode:"always",allowSelectAll:!0,selectAllMode:"page"},rowAlternationEnabled:!1,selectedRowKeys:D,onSelectionChanged:function(e){S(e.selectedRowKeys),E(e.selectedRowsData.map((function(e){return(0,l.Z)((0,l.Z)({},e),{},{Fullname:"".concat(e.Firstname," ").concat(e.Lastname)})})))},tableClass:"max-h-[calc(100vh-305px)]",title:null!==(e=G.userInfo)&&void 0!==e&&e.ReadonlyAccess?"":(0,N.jsxs)("div",{className:"flex justify-between items-center py-2 gap-3 border-b",children:[(0,N.jsxs)("div",{className:"ml-2",children:[(0,N.jsx)("span",{className:"font-bold",children:null===L||void 0===L?void 0:L.length})," people selected ",50===(null===L||void 0===L?void 0:L.length)&&(0,N.jsx)("span",{className:"text-red-400",children:"(full)"})]}),(0,N.jsxs)("div",{className:"flex items-center gap-3",children:[(0,N.jsx)(d.Button,{onClick:ae,disabled:50===(null===L||void 0===L?void 0:L.length)||0===(null===D||void 0===D?void 0:D.length),children:"Add Selection"}),(0,N.jsx)(d.Button,{onClick:function(){50!==(null===L||void 0===L?void 0:L.length)&&ae(),O(!0)},disabled:0===(null===L||void 0===L?void 0:L.length)&&0===(null===D||void 0===D?void 0:D.length),children:"Add Selection & Return"})]})]})}),(0,N.jsxs)(d.Modal,{open:H,onCancel:le,title:(0,N.jsxs)("div",{children:["Room Audit ",(0,N.jsxs)("span",{className:"text-gray-400 font-normal",children:["(",null===L||void 0===L?void 0:L.length," people selected)"]})]}),width:1e3,forceRender:!0,children:[(0,N.jsxs)(p.Z,{form:ee,size:"small",onFinish:function(e){C(!0),(0,u.Z)({method:"post",url:"tas/audit/roomaudit",responseType:"blob",data:(0,l.Z)((0,l.Z)({},e),{},{startDate:g()(e.startDate).format("YYYY-MM-DD"),endDate:g()(e.endDate).format("YYYY-MM-DD"),employeeIds:e.employeeIds.map((function(e){return e.Id}))})}).then((function(e){if(200===e.status){var t=window.URL.createObjectURL(e.data),n=document.createElement("a");n.href=t,n.download="TAS_ROOM_AUDIT_".concat(g()().format("YYYY-MM-dd_HH-mm-ss"),".xlsx"),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(t),O(!1),M([]),S([])}else K.error({message:"Audit data not found",duration:5})})).catch((function(e){})).then((function(){return C(!1)}))},children:[(0,N.jsx)(p.Z.List,{name:"employeeIds",children:function(e,t){var n=t.remove;return(0,N.jsx)("div",{className:"border rounded-ot",children:(0,N.jsxs)("table",{className:"table-auto overflow-hidden w-full",children:[(0,N.jsx)("thead",{className:"text-[#959595]",children:(0,N.jsxs)("tr",{className:"text-left",children:[(0,N.jsx)("th",{className:"border-b px-1 font-normal w-[30px]",children:"#"}),(0,N.jsx)("th",{className:"border-b px-1 font-normal",children:"#Person"}),(0,N.jsx)("th",{className:"border-b px-1 font-normal",children:"Fullname"}),(0,N.jsx)("th",{className:"border-b px-1 font-normal",children:"Department"}),(0,N.jsx)("th",{className:"border-b px-1 font-normal"})]})}),(0,N.jsx)("tbody",{children:e.map((function(e){e.key;var t=e.name,s=(0,a.Z)(e,Z);return(0,N.jsxs)("tr",{className:"".concat((t+1)%2===0?"bg-[#fafafa]":"white"),children:[(0,N.jsx)("td",{className:"py-1 border-t px-1",children:(0,N.jsx)(p.Z.Item,(0,l.Z)((0,l.Z)({},s),{},{name:[t,"Id"],className:"mb-0",children:(0,N.jsx)("div",{className:"text-[13px] w-[30px]",children:t+1})}))}),(0,N.jsx)("td",{className:"py-1 border-t px-1",children:(0,N.jsx)(p.Z.Item,(0,l.Z)((0,l.Z)({},s),{},{name:[t,"Id"],className:"mb-0",children:(0,N.jsx)("div",{className:"text-[13px]",children:ee.getFieldValue(["employeeIds",t,"Id"])})}))}),(0,N.jsx)("td",{className:"py-1 border-t px-1",children:(0,N.jsx)(p.Z.Item,(0,l.Z)((0,l.Z)({},s),{},{className:"mb-0",children:(0,N.jsx)("div",{className:"text-[13px]",children:ee.getFieldValue(["employeeIds",t,"Fullname"])})}))}),(0,N.jsx)("td",{className:"py-1 border-t px-1",children:(0,N.jsx)(p.Z.Item,(0,l.Z)((0,l.Z)({},s),{},{className:"mb-0",children:(0,N.jsx)("div",{children:ee.getFieldValue(["employeeIds",t,"DepartmentName"])})}))}),(0,N.jsx)("td",{className:"py-1 border-t px-1",children:(0,N.jsx)("button",{type:"button",className:"dlt-button text-xs",onClick:function(){return n(t)},children:"Remove"})})]})}))})]})})}}),(0,N.jsxs)("div",{className:"flex gap-4 mt-4",children:[(0,N.jsx)(p.Z.Item,{label:"StartDate",className:"mb-0",name:"startDate",rules:[{required:!0}],children:(0,N.jsx)(h.Z,{})},"form-startdate"),(0,N.jsx)(p.Z.Item,{label:"endDate",className:"mb-0",name:"endDate",rules:[{required:!0}],children:(0,N.jsx)(h.Z,{})},"form-enddate")]})]}),(null===L||void 0===L?void 0:L.length)>0&&(0,N.jsxs)("div",{className:"flex items-center justify-end gap-5 mt-4",children:[(0,N.jsx)(d.Button,{type:"primary",onClick:function(){return ee.submit()},loading:R,children:"Download"}),(0,N.jsx)(d.Button,{onClick:le,disabled:R,children:"Cancel"})]})]}),Q]})}}}]);