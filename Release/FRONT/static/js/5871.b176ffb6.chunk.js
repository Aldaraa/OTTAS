"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[5871],{55871:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});var n=a(1413),l=a(29439),r=a(93433),s=a(47313),o=a(2880),u=a(56573),i=a(65040),d=a(58467),c=a(2135),p=a(42614),m=a(10658),f=a.n(m),v=a(76629),g=a(56385),h=a.n(g),D=a(55080),b=a(40765),y=a(31283),x=a(46417);function S(e,t){var a=!1;return e.length===t.length&&e.forEach((function(e){a=t.includes(e)})),a}var E=["StartDate","EndDate","Id","DocumentType","requestDocumentSearchCurrentStep"],Z=["StartDate","EndDate","Id","DocumentType","requestDocumentSearchCurrentStep","ApprovelType","LastModifiedDate","AssignedEmployeeId","EmployerId","RequestedEmployeeId","Keyword"],N=[{label:"Start Date",value:"StartDate"},{label:"End Date",value:"EndDate"},{label:"Request #",value:"Id"},{label:"Document Type",value:"DocumentType"},{label:"Current Step",value:"requestDocumentSearchCurrentStep"},{label:"Approvel Type",value:"ApprovelType"},{label:"Last Modified",value:"LastModifiedDate"},{label:"Assigned To",value:"AssignedEmployeeId"},{label:"Employer",value:"EmployerId"},{label:"Requested By",value:"RequestedEmployeeId"},{label:"Keyword",value:"Keyword"}];var w=function(e){var t,a,i,d,c,m,g,h,w,I=e.onFinish,T=e.form,C=v.Z.get("tr"),j=v.Z.get("tFields")?v.Z.get("tFields"):[],q=function(e){var t=!0;return e&&(t=!(f()(e)-f()().subtract(1,"hour")>0)),t}(null===C||void 0===C?void 0:C.date)?null:C.sf,k=(0,s.useState)([]),A=(0,l.Z)(k,2),M=A[0],Y=A[1],R=(0,s.useState)([]),F=(0,l.Z)(R,2),L=F[0],V=F[1],z=(0,s.useState)(j.length>0?j:E),H=(0,l.Z)(z,2),K=H[0],O=H[1],P=(0,s.useState)(!0),B=(0,l.Z)(P,2),U=B[0],G=B[1],W=(0,s.useState)(!1),_=(0,l.Z)(W,2),J=_[0],Q=_[1],X=(0,s.useState)(!1),$=(0,l.Z)(X,2),ee=$[0],te=$[1],ae=(0,s.useContext)(p.V).state,ne=(0,s.useContext)(p.V);(0,s.useEffect)((function(){le(),re()}),[]);var le=function(){(0,u.Z)({method:"get",url:"tas/requestgroupemployee"}).then((function(e){var t,a=[];null===(t=e.data)||void 0===t||t.map((function(e){a.push({value:e.EmployeeId,label:e.FullName})})),Y(a)})).catch((function(e){}))},re=function(){(0,u.Z)({method:"get",url:"tas/requestgroup"}).then((function(e){var t,a=[];null===(t=e.data)||void 0===t||t.map((function(e){a.push({value:e.Id,label:e.Description})})),V(a)})).catch((function(e){}))},se=[{label:"Start Date",name:"StartDate",className:"col-span-6 xl:col-span-4 mb-2",type:"date",inputprops:{className:"w-full"}},{label:"End Date",name:"EndDate",className:"col-span-6 xl:col-span-4 mb-2",type:"date",inputprops:{className:"w-full"}},{label:"Request #",name:"Id",className:"col-span-6 xl:col-span-4 mb-2",type:"number",inputprops:{className:"w-full"}},{label:"Document Type",name:"DocumentType",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",allowClear:!1,options:null!==(t=ae.referData)&&void 0!==t&&null!==(a=t.master)&&void 0!==a&&a.documentTypes?[{value:null,label:"All"}].concat((0,r.Z)(null===(i=ae.referData)||void 0===i||null===(d=i.master)||void 0===d?void 0:d.documentTypes)):[]}},{label:"Current Step",name:"requestDocumentSearchCurrentStep",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",allowClear:!1,options:null!==(c=ae.referData)&&void 0!==c&&null!==(m=c.master)&&void 0!==m&&m.searchCurrentSteps?[{value:null,label:"All"}].concat((0,r.Z)(null===(g=ae.referData)||void 0===g||null===(h=g.master)||void 0===h?void 0:h.searchCurrentSteps)):[]}},{label:"Approvel Type",name:"ApprovelType",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",options:L.filter((function(e){return"OT badging"!==e.label&&"Data team"!==e.label}))}},{label:"Last Modified",name:"LastModifiedDate",className:"col-span-6 xl:col-span-4 mb-2",type:"date",inputprops:{className:"w-full"}},{label:"Assigned To",name:"AssignedEmployeeId",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",options:M}},{label:"Employer",name:"EmployerId",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"w-full",options:null===(w=ne.state.referData)||void 0===w?void 0:w.employers}},{label:"Requested By",name:"RequestedEmployeeId",className:"col-span-6 xl:col-span-4 mb-2",type:"select",inputprops:{className:"max-w-[300px]",options:M}},{label:"Keyword",name:"Keyword",className:"col-span-6 xl:col-span-4 mb-2"}],oe=(0,s.useMemo)((function(){return se.filter((function(e){return K.includes(e.name)}))}),[K,M,L]);return(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"rounded-t-ot bg-white px-3 py-2 shadow-md border-b",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,x.jsx)("div",{className:"text-lg font-bold mb-3",children:"Search Task"}),(0,x.jsx)(o.Button,{htmlType:"button",onClick:function(){return te(!0)},className:"px-2",icon:(0,x.jsx)(D.Z,{style:{fontSize:"16px"}}),children:"Filter"})]}),(0,x.jsx)(o.Form,{form:T,fields:oe,className:"grid grid-cols-12 gap-x-8",onFinish:I,size:"small",initValues:q?(0,n.Z)((0,n.Z)({},q.model),{},{StartDate:q.model.StartDate?f()(q.model.StartDate):null,EndDate:null}):{StartDate:f()().subtract(14,"day"),EndDate:null,Id:"",DocumentType:null,requestDocumentSearchCurrentStep:"Pending",ApprovelType:null,LastModifiedDate:null,AssignedEmployeeId:null,EmployerId:null,RequestedEmployeeId:null,Keyword:""},children:(0,x.jsx)("div",{className:"col-span-12 flex gap-4 justify-end",children:(0,x.jsx)(o.Button,{htmlType:"submit",icon:(0,x.jsx)(b.Z,{}),children:"Search"})})})]}),(0,x.jsxs)(o.Modal,{open:ee,onCancel:function(){return te(!1)},title:"Filter fields",children:[(0,x.jsxs)("div",{className:"pb-2 mb-2 border-b",children:[(0,x.jsx)(y.Z,{indeterminate:U,checked:J,onChange:function(e){var t=e.target.checked?Z:[];v.Z.set("tFields",t),O(t),G(!1),Q(e.target.checked)},children:"Select All"},"selectAll"),(0,x.jsx)(y.Z,{checked:S(E,K),onChange:function(e){var t=e.target.checked?E:[];v.Z.set("tFields",t),O(t),G(t.length<Z.length)},children:"Default"},"default")]}),(0,x.jsx)(y.Z.Group,{style:{width:"100%"},value:K,onChange:function(e){v.Z.set("tFields",e);var t=N.map((function(e){return e.value}));O(e),G(!!e.length&&e.length<t.length),Q(e.length===t.length)},children:(0,x.jsx)("div",{className:"grid grid-cols-12 gap-x-5",children:N.map((function(e,t){return(0,x.jsx)("div",{className:"col-span-6",children:(0,x.jsx)(y.Z,{value:e.value,children:e.label},"filter-check-item-".concat(t))})}))})})]})]})},I=a(73030),T=function(e){var t=!0;return e&&(t=!(f()(e)-f()().subtract(1,"hour")>0)),t},C=function(e){if("Non Site Travel"===e.data.DocumentType)return"/request/task/nonsitetravel/".concat(e.data.Id);if("Profile Changes"===e.data.DocumentType)return"/request/task/profilechanges/".concat(e.data.Id);if("De Mobilisation"===e.data.DocumentType)return"/request/task/de-mobilisation/".concat(e.data.Id);if("ExternalTravel"===e.data.DocumentType){if("ADD"===e.data.DocumentTag)return"/request/task/externaltravel/addtravel/".concat(e.data.Id);if("RESCHEDULE"===e.data.DocumentTag)return"/request/task/externaltravel/reschedule/".concat(e.data.Id);if("REMOVE"===e.data.DocumentTag)return"/request/task/externaltravel/remove/".concat(e.data.Id)}else if("Site Travel"===e.data.DocumentType){if("ADD"===e.data.DocumentTag)return"/request/task/sitetravel/addtravel/".concat(e.data.Id);if("RESCHEDULE"===e.data.DocumentTag)return"/request/task/sitetravel/reschedule/".concat(e.data.Id);if("REMOVE"===e.data.DocumentTag)return"/request/task/sitetravel/remove/".concat(e.data.Id)}},j=function(e,t,a){var n=(0,r.Z)(e);t&&h()(t).map((function(e){n[e].groupIndex=t[e]}));a&&h()(a).map((function(e){n[e].defaultSortOrder=a[e]}));return n},q=function(e){var t="";return e<0?t="bg-orange-500 text-white":0===e||1===e?t="bg-red-500 text-white":2!==e&&3!==e||(t="bg-yellow-500 text-white"),t};var k=function(){var e=v.Z.get("tr"),t=v.Z.get("grouping"),a=v.Z.get("sorting"),r=T(null===e||void 0===e?void 0:e.date)?null:e.sf,m=T(null===e||void 0===e?void 0:e.date)?null:e.rd,g=(0,d.TH)(),D=(0,s.useState)(m?m.data:[]),b=(0,l.Z)(D,2),y=b[0],S=b[1],E=(0,s.useState)(m?m.totalcount:0),Z=(0,l.Z)(E,2),N=Z[0],k=Z[1],A=(0,s.useState)(r?r.pageIndex:0),M=(0,l.Z)(A,2),Y=M[0],R=M[1],F=(0,s.useState)(r?r.pageSize:100),L=(0,l.Z)(F,2),V=L[0],z=L[1],H=(0,s.useContext)(p.V).state,K=(0,s.useContext)(p.V),O=(0,d.s0)(),P=i.Z.useForm(),B=(0,l.Z)(P,1)[0],U=(0,s.useRef)(null);(0,s.useEffect)((function(){g.state&&B.setFieldValue(g.state.name,g.state.value),e||G(),K.action.changeMenuKey("/request/task")}),[]),(0,s.useEffect)((function(){y.length>0&&G()}),[Y,V]);var G=function(){var e;null===(e=U.current)||void 0===e||e.instance.beginCustomLoading(),(0,u.Z)({method:"post",url:"tas/requestdocument/documentlist",data:{model:B.getFieldsValue(),pageIndex:Y,pageSize:V}}).then((function(e){S(e.data.data),k(e.data.totalcount)})).finally((function(){var e;return null===(e=U.current)||void 0===e?void 0:e.instance.endCustomLoading()}))},W=[{label:"",name:"DaysAway",dataType:"string",width:"45px",alignment:"left",cellRender:function(e){var t=e.value;return(0,x.jsx)(o.Tooltip,{title:"Days Away",children:(0,x.jsx)("div",{className:(0,I.m6)("py-[1px] px-[3px] rounded inline-block text-xs min-w-[30px] text-center",q(t)),children:t})})}},{label:"#",name:"Id",dataType:"string",width:"65px",cellRender:function(e){return(0,x.jsx)("div",{className:"flex items-center text-blue-500 hover:underline",children:(0,x.jsx)(c.Link,{to:C(e),target:"_blank",children:e.value})})}},{label:"CurrentStatus",name:"CurrentStatusGroup",alignment:"left"},{label:"Description",name:"Description",alignment:"left",width:380,minWidth:100,cellRender:function(e){var t=e.value;return(0,x.jsx)("div",{className:"truncate whitespace-pre-wrap",children:t})}},{label:"Employer",name:"EmployerName",alignment:"left"},{label:"Subject",name:"EmployeeFullName",alignment:"left"},{label:"Date Requested",name:"RequestedDate",alignment:"left",width:80,cellRender:function(e){return(0,x.jsx)("div",{children:f()(e.value).format("YYYY-MM-DD ddd HH:mm")})}},{label:"Assigned To",name:"AssignedEmployeeFullName",alignment:"left",width:120,cellRender:function(e){return(0,x.jsx)("div",{className:H.userInfo.Id===e.data.AssignedEmployeeId?"font-bold":"",children:e.value})}},{label:"Requester",name:"RequesterFullName",alignment:"left",width:120},{label:"Updated",name:"UpdatedInfo",alignment:"left"}];return(0,x.jsxs)("div",{children:[(0,x.jsx)(w,{form:B,onFinish:function(e){var t;R(0),null===(t=U.current)||void 0===t||t.instance.beginCustomLoading(),(0,u.Z)({method:"post",url:"tas/requestdocument/documentlist",data:{model:(0,n.Z)((0,n.Z)({},e),{},{StartDate:e.StartDate?f()(e.StartDate).format("YYYY-MM-DD"):null,EndDate:e.EndDate?f()(e.EndDate).format("YYYY-MM-DD"):null}),pageIndex:0,pageSize:V}}).then((function(t){v.Z.set("tr",{rd:t.data,sf:{model:(0,n.Z)((0,n.Z)({},e),{},{StartDate:e.StartDate?f()(e.StartDate).format("YYYY-MM-DD"):null,EndDate:e.EndDate?f()(e.EndDate).format("YYYY-MM-DD"):null}),pageIndex:0,pageSize:V},date:f()().format("YYYY-MM-DD HH:mm")}),S(t.data.data),k(t.data.totalcount)})).finally((function(){var e;return null===(e=U.current)||void 0===e?void 0:e.instance.endCustomLoading()}))}}),(0,x.jsx)(o.CustomTable,{ref:U,data:y,keyExpr:"Id",columns:j(W,t,a),onChangePageSize:function(e){return z(e)},onChangePageIndex:function(e){return R(e)},pageSize:V,pageIndex:Y,totalCount:N,pagerPosition:"top",isGrouping:!0,columnAutoWidth:!0,showColumnLines:!1,onRowDblClick:function(e){return O(C(e))},wordWrapEnabled:!0,onOptionChanged:function(e){if("columns"===e.name)if(e.fullName.includes("groupIndex")){var t=v.Z.get("grouping")?v.Z.get("grouping"):{};if(void 0!==typeof e.value)t[e.fullName[8]]=e.value,v.Z.set("grouping",t);else if(void 0!==typeof e.previousValue){var a=h()(t);a.filter((function(t){return t!==e.fullName[8]}));var n={};a.map((function(e,t){return n[e]=t})),v.Z.set("grouping",n)}}else if(e.fullName.includes("sortOrder")){var l=v.Z.get("sorting")?v.Z.get("sorting"):{};if(void 0!==typeof e.value)l[e.fullName[8]]=e.value,v.Z.set("sorting",l);else if(void 0!==typeof e.previousValue){var r=h()(l);r.filter((function(t){return t!==e.fullName[8]}));var s={};r.map((function(e,t){return s[e]=t})),v.Z.set("sorting",s)}}},tableClass:"max-h-[calc(100vh-305px)]",containerClass:"rounded-t-none"})]})}}}]);