"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[2427],{72427:function(e,t,a){a.r(t),a.d(t,{default:function(){return w}});var n=a(45987),l=a(1413),s=a(29439),r=a(47313),o=a(2880),i=a(56573),d=a(65040),c=a(74294),u=a(21975),m=a(93031),p=a(58467),h=a(10658),x=a.n(h),f=a(82508),v=a(99649),b=a(98315),j=a(16031),y=a(58821),g=a(46417),Z=function(e){var t=e.name,a=e.form,n=e.rowData,l=e.dateLoading,c=(0,r.useState)(!1),u=(0,s.Z)(c,2),p=u[0],h=u[1];(0,r.useEffect)((function(){h(l)}),[l]);return(0,g.jsxs)("div",{className:"flex mb-0 w-full items-center gap-2",children:[(0,g.jsx)(d.Z.Item,{className:"m-0 flex-1",name:[t,"eventDate"],rules:[{required:!0,message:"Event Date is required"}],children:(0,g.jsx)(m.Z,{className:"w-full",disabledDate:function(e){return e<x()().subtract(1,"day").endOf("day")||e>x()().add(7,"day").endOf("day")},onChange:function(e){!function(e,t,n){t&&(h(!0),(0,i.Z)({method:"get",url:"tas/employee/deactive/check/".concat(e,"/").concat(x()(t).format("YYYY-MM-DD"))}).then((function(e){a.setFieldValue(["rosters",n,"DateValidationStatus"],e.data.DateValidationStatus),a.setFieldValue(["rosters",n,"FutureTransportValidationStatus"],e.data.FutureTransportValidationStatus)})).catch((function(e){a.setFieldValue(["rosters",n,"DateValidationStatus"],!1),a.setFieldValue(["rosters",n,"FutureTransportValidationStatus"],!1)})).then((function(){return h(!1)})))}(n.Id,e,t)}})}),(0,g.jsx)(d.Z.Item,{noStyle:!0,shouldUpdate:function(e,a){var n,l;return(null===(n=e.rosters[t])||void 0===n?void 0:n.DateValidationStatus)!==(null===(l=a.rosters[t])||void 0===l?void 0:l.DateValidationStatus)},className:"m-0",children:function(e){var a=e.getFieldValue;return(0,g.jsx)(d.Z.Item,{name:[t,"DateValidationStatus"],className:"mb-0",children:p?(0,g.jsx)(f.Z,{}):(0,j.isBoolean)(a(["rosters",t,"DateValidationStatus"]))&&(a(["rosters",t,"DateValidationStatus"])?(0,g.jsx)(o.Tooltip,{title:"The Date is available",children:(0,g.jsx)(v.Z,{style:{color:"#52c41a"}})}):(0,g.jsx)(o.Tooltip,{title:"The Date is unavailable",children:(0,g.jsx)(b.Z,{style:{color:"#ff4d4f"}})}))})}}),(0,g.jsx)(d.Z.Item,{noStyle:!0,shouldUpdate:function(e,a){var n,l;return(null===(n=e.rosters[t])||void 0===n?void 0:n.FutureTransportValidationStatus)!==(null===(l=a.rosters[t])||void 0===l?void 0:l.FutureTransportValidationStatus)},className:"m-0",children:function(e){var a=e.getFieldValue;return(0,g.jsx)(d.Z.Item,{name:[t,"FutureTransportValidationStatus"],className:"mb-0",children:p?(0,g.jsx)(f.Z,{}):(0,j.isBoolean)(a(["rosters",t,"FutureTransportValidationStatus"]))&&(a(["rosters",t,"FutureTransportValidationStatus"])?(0,g.jsx)(o.Tooltip,{title:"Has Future transport",children:(0,g.jsx)(y.dm9,{style:{color:"#ff4d4f"}})}):(0,g.jsx)(o.Tooltip,{title:"No Future transport",children:(0,g.jsx)(y.dm9,{style:{color:"#52c41a"}})}))})}})]})};var N=function(e){var t=e.data;return(0,g.jsx)("div",{children:(0,g.jsx)(o.Table,{data:t,columns:[{label:"Person #",name:"SAPID",alignment:"left"},{label:"SAP ID #",name:"SAPID",alignment:"left"},{label:"Full Name",name:"FullName"}],keyExpr:"EmployeeId"})})},D=a(14261),F=a(18711),S=a(2135),T=[{label:"Person #",name:"Id",dataType:"string"},{label:"SAP ID #",name:"SAPID",alignment:"left"},{label:"",name:"Active",width:"21px",alignment:"center",showInColumnChooser:!1,allowSorting:!1,cellRender:function(e){return(0,g.jsx)(F.DcD,{color:1===e.value?"lime":"lightgray"})}},{label:"Firstname",name:"Firstname",dataType:"string"},{label:"Lastname",name:"Lastname",dataType:"string"},{label:"Department",name:"DepartmentName",dataType:"string"},{label:"Employer",name:"EmployerName",dataType:"string"},{label:"Roster",name:"RosterName",dataType:"string",enableFilter:!0},{label:"Resource Type",name:"PeopleTypeName",dataType:"string"},{label:"Room",name:"RoomNumber",cellRender:function(e){return(0,g.jsx)("span",{children:e.value})}},{label:"Gender",name:"Gender",alignment:"center",width:"60px",cellRender:function(e){return(0,g.jsx)("span",{children:1===e.data.Gender?"M":"F"})},groupCellRender:function(e){return(0,g.jsxs)("span",{children:[1===e.value?"M":"F"," ",e.groupContinuesMessage?"- ".concat(e.groupContinuesMessage):""]})}},{label:"",name:"HasFutureTransport",width:"35px",cellRender:function(e){return(0,g.jsx)(D.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})},headerCellRender:function(e,t){return(0,g.jsx)(y.dm9,{})}},{label:"",name:"HasFutureRoomBooking",width:"35px",cellRender:function(e,t){return(0,g.jsx)(D.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})},headerCellRender:function(e,t){return(0,g.jsx)("i",{className:"dx-icon-home"})}},{label:"",name:"",width:"65px",alignment:"center",cellRender:function(e){return(0,g.jsx)("div",{className:"flex items-center",children:(0,g.jsx)(S.Link,{to:"/tas/people/search/".concat(e.data.Id),children:(0,g.jsx)("button",{type:"button",className:"edit-button",children:"View"})})})}}],V=["key","name"],I=function(e){return e<x()().subtract(1,"day").endOf("day")||e>x()().add(7,"day").endOf("day")};var w=function(){var e=(0,p.TH)(),t=(0,r.useState)(!1),a=(0,s.Z)(t,2),h=a[0],f=a[1],j=(0,r.useState)([]),D=(0,s.Z)(j,2),F=D[0],S=D[1],w=(0,r.useState)([]),C=(0,s.Z)(w,2),R=C[0],k=C[1],M=(0,r.useState)(!1),E=(0,s.Z)(M,2),Y=E[0],L=E[1],P=(0,r.useState)([]),A=(0,s.Z)(P,2),q=A[0],z=A[1],O=(0,r.useState)([]),B=(0,s.Z)(O,2),H=B[0],G=B[1],W=(0,r.useState)(!1),J=(0,s.Z)(W,2),U=J[0],_=J[1],K=(0,r.useState)(!1),Q=(0,s.Z)(K,2),X=Q[0],$=Q[1],ee=d.Z.useForm(),te=(0,s.Z)(ee,1)[0],ae=d.Z.useForm(),ne=(0,s.Z)(ae,1)[0],le=d.Z.useWatch("rosters",ne),se=(0,r.useRef)(null);(0,r.useEffect)((function(){e.state&&te.setFieldValue(e.state.name,e.state.value),(0,i.Z)({method:"get",url:"tas/requestdemobilisationtype?active=1"}).then((function(e){var t=[];e.data.map((function(e){t.push((0,l.Z)({label:"".concat(e.Code," - ").concat(e.Description),value:e.Id},e))})),z(t)})).catch((function(e){}))}),[]),(0,r.useEffect)((function(){ne.setFieldsValue({rosters:F})}),[F]);var re=function(e,t){var a,n;null===(a=ne.getFieldsValue())||void 0===a||null===(n=a.rosters)||void 0===n||n.map((function(a,n){ne.setFieldValue(["rosters",n,t],e)}))},oe=function(e,t){var a,n,l,s=[];null===(a=ne.getFieldsValue())||void 0===a||null===(n=a.rosters)||void 0===n||n.map((function(a,n){s.push({EmployeeId:a.Id,EventDate:e.format("YYYY-MM-DD"),Index:n}),ne.setFieldValue(["rosters",n,t],e)})),l=s,$(!0),(0,i.Z)({method:"put",url:"tas/employee/deactive/check/multiple",data:{data:l}}).then((function(e){e.data.forEach((function(e){ne.setFieldValue(["rosters",e.Index,"DateValidationStatus"],e.DateValidationStatus),ne.setFieldValue(["rosters",e.Index,"FutureTransportValidationStatus"],e.FutureTransportValidationStatus)}))})).catch((function(e){})).finally((function(){$(!1)}))},ie=function(){L(!1),S(ne.getFieldValue("rosters"))};return(0,g.jsxs)("div",{children:[(0,g.jsx)(o.PeolpeSelectionTable,{ref:se,onSelect:function(e){k(e)},onReturn:function(){var e=R.map((function(e){return(0,l.Z)((0,l.Z)({},e),{},{Fullname:"".concat(e.Firstname," ").concat(e.Lastname)})}));S(e),L(!0)},selectedRowsData:R,columns:T,searchDefaultValues:{Active:1},hideFields:["Active"]}),(0,g.jsxs)(o.Modal,{open:Y,onCancel:ie,title:(0,g.jsxs)("div",{children:["Deactivate ",(0,g.jsxs)("span",{className:"text-gray-400 font-normal",children:["(",null===le||void 0===le?void 0:le.length," people selected)"]})]}),width:1e3,children:[(0,g.jsxs)("div",{className:"flex justify-end gap-4 text-xs mb-1",children:[(0,g.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,g.jsx)(y.dm9,{style:{color:"#ff4d4f"}})," A future transport is scheduled"]}),(0,g.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,g.jsx)(y.dm9,{style:{color:"#52c41a"}})," No Future transport"]}),(0,g.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,g.jsx)(v.Z,{style:{color:"#52c41a"}})," The Date is available"]}),(0,g.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,g.jsx)(b.Z,{style:{color:"#ff4d4f"}})," The Date is unavailable"]})]}),(0,g.jsx)(d.Z,{form:ne,size:"small",onFinish:function(e){f(!0),(0,i.Z)({method:"post",url:"tas/employee/deactive",data:{employees:e.rosters.map((function(e){return{employeeId:e.Id,eventDate:e.eventDate?x()(e.eventDate).format("YYYY-MM-DD"):"",comment:e.comment,demobTypeTypeId:e.demobTypeTypeId}}))}}).then((function(e){var t;e.data.length>0&&(G(e.data),_(!0)),L(!1),S([]),null===(t=se.current)||void 0===t||t.instance.clearSelection(),te.submit()})).catch((function(e){})).then((function(){return f(!1)}))},children:(0,g.jsx)(d.Z.List,{name:"rosters",children:function(e,t){var a=t.remove;return(0,g.jsx)("div",{className:"border rounded-ot",children:(0,g.jsxs)("table",{className:"table-auto overflow-hidden w-full",children:[(0,g.jsx)("thead",{className:"text-[#959595]",children:(0,g.jsxs)("tr",{className:"text-left",children:[(0,g.jsx)("th",{className:"border-b px-1 font-normal w-[30px]",children:"#"}),(0,g.jsx)("th",{className:"border-b px-1 font-normal",children:"#Person"}),(0,g.jsx)("th",{className:"border-b px-1 font-normal",children:"Fullname"}),(0,g.jsx)("th",{className:"border-b px-1 font-normal",children:e.length>1?(0,g.jsx)(c.Z,{placeholder:"Change All",className:"w-full",options:q,onChange:function(e){return re(e,"demobTypeTypeId")},allowClear:!0,showSearch:!0,popupMatchSelectWidth:!1,filterOption:function(e,t){var a;return(null!==(a=null===t||void 0===t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())}}):"Demobilization Type"}),(0,g.jsx)("th",{className:"border-b px-1 font-normal",children:e.length>1?(0,g.jsx)(u.Z,{placeholder:"Change comments",onChange:function(e){return re(e.target.value,"comment")}}):"Comment"}),(0,g.jsx)("th",{className:"border-b px-1 font-normal",children:(0,g.jsx)(m.Z,{placeholder:"Event Date",disabledDate:I,onChange:function(e){return oe(e,"eventDate")}})}),(0,g.jsx)("th",{className:"border-b px-1 font-normal"})]})}),(0,g.jsx)("tbody",{children:e.map((function(e){var t=e.key,s=e.name,r=(0,n.Z)(e,V);return(0,g.jsxs)("tr",{className:"".concat((s+1)%2===0?"bg-[#fafafa]":"white"),children:[(0,g.jsx)("td",{className:"py-1 border-t px-1",children:(0,g.jsx)(d.Z.Item,(0,l.Z)((0,l.Z)({},r),{},{name:[s,"Id"],className:"mb-0",children:(0,g.jsx)("div",{className:"text-[13px] w-[30px]",children:s+1})}))}),(0,g.jsx)("td",{className:"py-1 border-t px-1",children:(0,g.jsx)(d.Z.Item,(0,l.Z)((0,l.Z)({},r),{},{name:[s,"Id"],className:"mb-0",children:(0,g.jsx)("div",{className:"text-[13px]",children:ne.getFieldValue(["rosters",s,"Id"])})}))}),(0,g.jsx)("td",{className:"py-1 border-t px-1",children:(0,g.jsx)(d.Z.Item,(0,l.Z)((0,l.Z)({},r),{},{className:"mb-0",children:(0,g.jsx)("div",{className:"text-[13px]",children:ne.getFieldValue(["rosters",s,"Fullname"])})}))}),(0,g.jsx)("td",{className:"py-1 border-t px-1",children:(0,g.jsx)(d.Z.Item,(0,l.Z)((0,l.Z)({},r),{},{name:[s,"demobTypeTypeId"],className:"mb-0",rules:[{required:!0,message:"Demobilization type is required"}],children:(0,g.jsx)(c.Z,{options:q,placeholder:"Demobilization Type",allowClear:!0,showSearch:!0,popupMatchSelectWidth:!1,filterOption:function(e,t){var a;return(null!==(a=null===t||void 0===t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())}})}))}),(0,g.jsx)("td",{className:"py-1 border-t px-1",children:(0,g.jsx)(d.Z.Item,(0,l.Z)((0,l.Z)({},r),{},{name:[s,"comment"],className:"mb-0",rules:[{required:!0,message:"Missing first name"}],children:(0,g.jsx)(u.Z,{placeholder:"Comment"})}))}),(0,g.jsx)("td",{className:"py-1 border-t px-1",children:(0,g.jsx)(d.Z.Item,{name:[s,"eventDate"],className:"mb-0",children:(0,g.jsx)(Z,{dateLoading:X,name:s,form:ne,rowData:F[s]})},"eventDate-".concat(t))}),(0,g.jsx)("td",{className:"py-1 border-t px-1",children:(0,g.jsx)("button",{type:"button",className:"dlt-button text-xs",onClick:function(){!function(e){var t;null===(t=se.current)||void 0===t||t.instance.deselectRows([e])}(ne.getFieldValue(["rosters",s,"Id"])),a(s)},children:"Remove"})})]},s)}))})]})})}})}),F.length>0&&(0,g.jsxs)("div",{className:"flex items-center justify-end gap-5 mt-4",children:[(0,g.jsx)(o.Button,{type:"primary",onClick:function(){return ne.submit()},loading:h,children:"Process"}),(0,g.jsx)(o.Button,{onClick:ie,disabled:h,children:"Cancel"})]})]}),(0,g.jsx)(o.Modal,{open:U,onCancel:function(){return _(!1)},title:"Skipped Employees",children:(0,g.jsx)(N,{data:H})})]})}}}]);