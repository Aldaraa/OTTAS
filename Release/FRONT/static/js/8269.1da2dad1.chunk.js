"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[8269],{98269:function(e,n,t){t.r(n);var o=t(1413),i=t(29439),l=t(56573),a=t(47313),u=t(58467),s=t(42614),d=t(65040),r=t(21975),c=t(2880),m=t(53979),v=t(14261),p=t(8251),f=t(10202),h=t(46417);n.default=function(){var e,n=(0,a.useState)(null),t=(0,i.Z)(n,2),g=t[0],x=t[1],y=(0,a.useState)(!0),I=(0,i.Z)(y,2),j=I[0],C=I[1],b=(0,a.useState)(null),Z=(0,i.Z)(b,2),A=Z[0],w=Z[1],N=(0,a.useState)(!1),S=(0,i.Z)(N,2),D=S[0],q=S[1],R=(0,a.useState)([]),k=(0,i.Z)(R,2),E=k[0],G=k[1],F=(0,a.useState)([]),T=(0,i.Z)(F,2),M=T[0],V=T[1],B=(0,a.useState)([]),L=(0,i.Z)(B,2),U=L[0],z=L[1],_=(0,a.useState)(null),P=(0,i.Z)(_,2),H=P[0],O=P[1],Y=(0,a.useState)(null),J=(0,i.Z)(Y,2),K=J[0],W=J[1],Q=(0,a.useState)(!1),X=(0,i.Z)(Q,2),$=X[0],ee=X[1],ne=(0,a.useState)(!1),te=(0,i.Z)(ne,2),oe=te[0],ie=te[1],le=(0,a.useState)(null),ae=(0,i.Z)(le,2),ue=ae[0],se=ae[1],de=(0,a.useState)(!1),re=(0,i.Z)(de,2),ce=re[0],me=re[1],ve=(0,a.useState)(null),pe=(0,i.Z)(ve,2),fe=pe[0],he=pe[1],ge=(0,u.UO)().documentId,xe=(0,a.useContext)(s.V),ye=xe.state,Ie=xe.action,je=d.Z.useForm(),Ce=(0,i.Z)(je,1)[0],be=d.Z.useForm(),Ze=(0,i.Z)(be,1)[0],Ae="requestDocumentDetail_".concat(ge),we=(0,u.s0)();(0,a.useEffect)((function(){return ye.connectionMultiViewer&&ye.userInfo&&(Ne(),ye.connectionMultiViewer.on("UsersInScreen",(function(e,n){var t=n.map((function(e){return{name:e.userName.split("_")[0],role:e.userName.split("_")[1],color:(0,f.Z)()}}));Ie.setMultiViewers(t.filter((function(e){var n,t;return e.name!=="".concat(null===(n=ye.userInfo)||void 0===n?void 0:n.Firstname," ").concat(null===(t=ye.userInfo)||void 0===t?void 0:t.Lastname)})))}))),function(){ye.connectionMultiViewer&&Se()}}),[ye.connectionMultiViewer,ye.userInfo]),(0,a.useEffect)((function(){ge&&(C(!0),Ie.changeMenuKey("/request/task"),l.Z.all(["tas/requestdemobilisation/".concat(ge),"tas/requestdocumenthistory/".concat(ge),"tas/requestdemobilisationtype?active=1","tas/requestdocument/myinfo"].map((function(e){return l.Z.get(e)}))).then(l.Z.spread((function(e,n,t,o){e.data&&(De(e.data.EmployeeId),x(e.data)),V(n.data),G(t.data),se(o.data)}))).catch((function(){})).then((function(){return C(!1)})))}),[ge]),(0,a.useEffect)((function(){g&&Re()}),[g]),(0,a.useEffect)((function(){U&&qe()}),[U]);var Ne=function(){try{var e,n,t,o;null===(e=ye.connectionMultiViewer)||void 0===e||e.invoke("JoinScreen","".concat(null===(n=ye.userInfo)||void 0===n?void 0:n.Firstname," ").concat(null===(t=ye.userInfo)||void 0===t?void 0:t.Lastname,"_").concat(null===(o=ye.userInfo)||void 0===o?void 0:o.Role),Ae)}catch(i){}},Se=function(){var e,n,t,o;Ie.setMultiViewers([]),null===(e=ye.connectionMultiViewer)||void 0===e||e.invoke("LeaveScreen","".concat(null===(n=ye.userInfo)||void 0===n?void 0:n.Firstname," ").concat(null===(t=ye.userInfo)||void 0===t?void 0:t.Lastname,"_").concat(null===(o=ye.userInfo)||void 0===o?void 0:o.Role),Ae)},De=function(e){(0,l.Z)({method:"get",url:"tas/employee/profile/".concat(e)}).then((function(e){Ie.saveUserProfileData(e.data),he(e.data)})).catch((function(e){}))},qe=function(){(0,l.Z)({method:"get",url:"tas/requestgroupconfig/documentroute/".concat(ge)}).then((function(e){ke(e.data)})).catch((function(e){}))},Re=function(e){(0,l.Z)({method:"get",url:"/tas/requestgroupconfig/groupandmembers/".concat(ge)}).then((function(e){z(e.data)}))},ke=function(e){var n=e.find((function(e){return 1===e.CurrentPosition}));if(W(n),"dataapproval"===(null===n||void 0===n?void 0:n.GroupTag))O(null);else if("Requester"===(null===n||void 0===n?void 0:n.GroupTag)){var t=e.findIndex((function(e){return 1===(null===e||void 0===e?void 0:e.CurrentPosition)})),o=e[t+1],i=U.find((function(e){return e.id===(null===o||void 0===o?void 0:o.GroupId)}));if(i){var l=[];i.groupMembers.map((function(e){l.push({value:e.employeeId,label:e.fullName})})),Ce.setFieldValue("nextGroupName",null===i||void 0===i?void 0:i.GroupName),Ce.setFieldValue("nextGroupId",null===i||void 0===i?void 0:i.id),Ce.setFieldValue("assignEmployeeOptions",l)}O(i)}},Ee=[{label:"Date of Completion",name:"CompletionDate",className:"col-span-12 mb-0",type:"date"},{label:"De-Mobilisation Type",name:"RequestDeMobilisationTypeId",className:"col-span-12 mb-0",type:"select",inputprops:{options:E.map((function(e){return{label:"".concat(e.Code," ").concat(e.Description),value:e.Id}}))}},{label:"Employer",name:"EmployerId",className:"col-span-12 mb-0",type:"select",inputprops:{options:null===(e=ye.referData)||void 0===e?void 0:e.employers}},{label:"Comments",name:"Comment",className:"col-span-12 mb-0",type:"textarea"}],Ge=function(e){w(e),"Approve"===e?Ce.submit():"Cancel"===e&&q(!0)};return(0,h.jsx)("div",{children:j?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"animate-skeleton h-[230px] flex rounded-ot mb-5 shadow-md"}),(0,h.jsx)("div",{className:"animate-skeleton h-[400px] flex rounded-ot shadow-md"})]}):(0,h.jsxs)("div",{className:"grid grid-cols-12 gap-3 relative",children:[(0,h.jsx)(c.RequestDocumentHeader,{profileData:fe,documentDetail:g}),(0,h.jsx)(c.Accordion,{className:"col-span-12 shadow-md rounded-ot overflow-hidden",title:"Travel Calendar",children:(0,h.jsx)("div",{className:"p-4",children:(0,h.jsx)(c.ProfileCalendar,{profile:fe})})}),(0,h.jsx)(c.Accordion,{className:"col-span-6 shadow-md rounded-ot overflow-hidden",title:"Detail",children:(0,h.jsx)(c.Form,{editData:null===g||void 0===g?void 0:g.info,fields:Ee,form:Ze,className:"grid grid-cols-12 gap-y-2 p-4",size:"small",disabled:!$,onFinish:function(e){var n;ie(!0),(0,l.Z)({method:"put",url:"tas/requestdemobilisation",data:(0,o.Z)((0,o.Z)({},e),{},{id:null===g||void 0===g||null===(n=g.info)||void 0===n?void 0:n.Id})}).then((function(e){ee(!1),C(!0),(0,l.Z)({method:"get",url:"tas/requestdemobilisation/".concat(ge)}).then((function(e){x(e.data)})).catch((function(e){})).then((function(){return C(!1)})),(0,l.Z)({method:"get",url:"tas/requestdocumenthistory/".concat(ge)}).then((function(e){V(e.data)})).catch((function(e){}))})).catch((function(e){})).then((function(){return ie(!1)}))},children:(0,h.jsx)("div",{className:"col-span-12 mt-3 flex justify-end",children:p.Z.getActionPermission({documentData:g,userData:ue,groupTag:null===K||void 0===K?void 0:K.GroupTag,userGroupIds:null===ue||void 0===ue?void 0:ue.ApprovalGroupIds})?$?(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)(c.Button,{type:"primary",loading:oe,onClick:function(){return Ze.submit()},icon:(0,h.jsx)(m.Z,{}),children:"Save"}),(0,h.jsx)(c.Button,{onClick:function(){return ee(!1)},disabled:oe,children:"Cancel"})]}):(0,h.jsx)(c.Button,{onClick:function(){return ee(!0)},children:"Edit"}):null})})}),"Complete"!==(null===g||void 0===g?void 0:g.Status)?(0,h.jsx)(c.Form,{className:"grid grid-cols-12 gap-y-5 col-span-6",size:"small",form:Ce,labelWrap:!0,onFinish:function(e){me(!0),"Approve"===A?(0,l.Z)({method:"put",url:"tas/requestdocument/approve",data:{id:ge,assignEmployeeId:e.assignedEmployeeId,nextGroupId:e.nextGroupId,comment:e.comment,impersonateUserId:null}}).then((function(e){q(!1),we("/guest/request")})).catch((function(e){})).then((function(){return me(!1)})):"Cancel"===A&&(0,l.Z)({method:"put",url:"tas/requestdocument/cancel",data:{id:ge,comment:e.comment,impersonateUserId:null}}).then((function(e){q(!1),we("/request/task")})).catch((function(e){})).then((function(){return me(!1)}))},children:(0,h.jsx)(c.Accordion,{title:"Request Document",className:"col-span-12 shadow-md rounded-ot overflow-hidden",children:(0,h.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,h.jsxs)("div",{children:["Comments:",(0,h.jsx)(c.Form.Item,{className:"m-0",name:"comment",children:(0,h.jsx)(r.Z.TextArea,{autoSize:{minRows:3,maxRows:5},maxLength:300,showCount:!0})})]}),(0,h.jsx)("div",{className:"flex items-center gap-3 justify-end",children:(0,h.jsx)(c.Form.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.comment!==n.comment},children:function(e){var n=e.getFieldValue;Boolean(n("comment"));return null===H||void 0===H||H.GroupTag,(null===ue||void 0===ue?void 0:ue.EmployeeId)===(null===g||void 0===g?void 0:g.RequestUserId)&&"Requester"===(null===K||void 0===K?void 0:K.GroupTag)?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.Button,{htmlType:"button",type:"primary",onClick:function(){return Ge("Approve")},disabled:ce,loading:ce&&"Approve"===A,children:"Submit"}),(0,h.jsx)(c.Button,{htmlType:"button",type:"danger",onClick:function(){return Ge("Cancel")},disabled:ce,children:"Cancel Request"})]}):(0,h.jsx)(c.Button,{htmlType:"button",type:"danger",onClick:function(){return Ge("Cancel")},disabled:ce,children:"Cancel Request"})}})})]})})}):null,(0,h.jsx)(c.Accordion,{title:"Document History & Comments, Document Route",defaultOpen:!1,className:"col-span-12 shadow-md rounded-ot overflow-hidden",children:(0,h.jsx)("div",{className:"grid grid-cols-12 items-start gap-4 p-4",children:(0,h.jsx)(c.DocumentTimeline,{data:M})})}),(0,h.jsx)(v.GI,{visible:D,showTitle:!1,height:120,width:350,children:(0,h.jsx)("div",{children:function(e){switch(e){case"Approve":return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{children:"Are you sure you want to approve this request?"}),(0,h.jsxs)("div",{className:"flex gap-5 mt-4 justify-center",children:[(0,h.jsx)(c.Button,{type:"success",onClick:function(){return Ce.submit()},loading:ce,children:"Yes"}),(0,h.jsx)(c.Button,{onClick:function(){return q(!1)},disabled:ce,children:"No"})]})]});case"Cancel":return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{children:"Are you sure you want to cancel this request?"}),(0,h.jsxs)("div",{className:"flex gap-5 mt-4 justify-center",children:[(0,h.jsx)(c.Button,{type:"danger",onClick:function(){return Ce.submit()},loading:ce,children:"Yes"}),(0,h.jsx)(c.Button,{onClick:function(){return q(!1)},disabled:ce,children:"No"})]})]})}}(A)})})]})})}},8251:function(e,n){var t={getDisabledStatus:function(e){var n,t,o=e.documentData,i=e.userData,l=e.groupTag;e.userGroupIds;return console.log("hello",o,i,l),"Completed"===l||"Cancelled"===l||(null!==o&&void 0!==o&&o.AssignedEmployeeId?!(null!==i&&void 0!==i&&null!==(n=i.LineManagerIds)&&void 0!==n&&n.includes(null===o||void 0===o?void 0:o.AssignedEmployeeId)||(null===o||void 0===o?void 0:o.AssignedEmployeeId)===(null===i||void 0===i?void 0:i.EmployeeId)||"Data Approval"===(null===i||void 0===i?void 0:i.Rolename)&&"linemanager"===l||"SystemAdministrator"===(null===i||void 0===i?void 0:i.Rolename)):!("SystemAdministrator"===(null===i||void 0===i?void 0:i.Rolename)||null!==i&&void 0!==i&&null!==(t=i.ApprovalGroupIds)&&void 0!==t&&t.includes(null===o||void 0===o?void 0:o.AssignedRouteConfigId)))},getActionPermission:function(e){var n,t,o=e.documentData,i=e.userData,l=e.groupTag,a=(e.userGroupIds,null);"Completed"===(null===o||void 0===o?void 0:o.CurrentStatus)||"Cancelled"===(null===o||void 0===o?void 0:o.CurrentStatus)?a=!1:a=null!==o&&void 0!==o&&o.AssignedEmployeeId?!!(null!==i&&void 0!==i&&null!==(n=i.LineManagerIds)&&void 0!==n&&n.includes(null===o||void 0===o?void 0:o.AssignedEmployeeId)||(null===o||void 0===o?void 0:o.AssignedEmployeeId)===(null===i||void 0===i?void 0:i.EmployeeId)||"Data Approval"===(null===i||void 0===i?void 0:i.Rolename)&&"linemanager"===l||"SystemAdministrator"===(null===i||void 0===i?void 0:i.Rolename)):!!("SystemAdministrator"===(null===i||void 0===i?void 0:i.Rolename)||null!==i&&void 0!==i&&null!==(t=i.ApprovalGroupIds)&&void 0!==t&&t.includes(null===o||void 0===o?void 0:o.AssignedRouteConfigId));return a},checkUpdateItinerary:function(e){var n,t=e.groupAndMembers,o=e.userData,i=!1,l=null===t||void 0===t?void 0:t.find((function(e){return"travelflight"===e.GroupTag}));return null!==o&&void 0!==o&&null!==(n=o.GroupIds)&&void 0!==n&&n.includes(null===l||void 0===l?void 0:l.GroupId)&&(i=!0),i}};n.Z=t},53979:function(e,n,t){t.d(n,{Z:function(){return s}});var o=t(87462),i=t(47313),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},a=t(17469),u=function(e,n){return i.createElement(a.Z,(0,o.Z)({},e,{ref:n,icon:l}))};var s=i.forwardRef(u)}}]);