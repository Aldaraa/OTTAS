"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[2159],{2159:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var n=a(45987),l=a(1413),s=a(29439),r=a(47313),d=a(2880),o=a(56573),i=a(12998),c=a(65040),m=a(93031),u=a(58467),x=a(10658),p=a.n(x),h=a(14261),f=a(58821),b=a(18711),j=a(46417),v=[{label:"Person #",name:"Id",dataType:"string",width:"70px"},{label:"",name:"Active",width:"21px",alignment:"center",showInColumnChooser:!1,allowSorting:!1,cellRender:function(e){return(0,j.jsx)(b.DcD,{color:1===e.value?"lime":"lightgray"})}},{label:"Firstname",name:"Firstname",dataType:"string"},{label:"Lastname",name:"Lastname",dataType:"string"},{label:"Department",name:"DepartmentName",dataType:"string",width:"220px"},{label:"Employer",name:"EmployerName",dataType:"string"},{label:"Roster",name:"RosterName",dataType:"string",width:"70px",enableFilter:!0,cellRender:function(e){var t=e.value;return(0,j.jsx)("div",{title:t,className:"truncate",children:t})}},{label:"Resource Type",name:"PeopleTypeName",dataType:"string"},{label:"Room",name:"RoomNumber",dataType:"string"},{label:"Gender",name:"Gender",alignment:"center",width:"70px",cellRender:function(e){return(0,j.jsx)("span",{children:1===e.data.Gender?"M":"F"})},groupCellRender:function(e){return(0,j.jsxs)("span",{children:[1===e.value?"M":"F"," ",e.groupContinuesMessage?"- ".concat(e.groupContinuesMessage):""]})}},{label:"",name:"HasFutureTransport",width:"50px",cellRender:function(e){return(0,j.jsx)(h.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})},headerCellRender:function(e,t){return(0,j.jsx)(f.dm9,{})}},{label:"",name:"HasFutureRoomBooking",width:"50px",cellRender:function(e,t){return(0,j.jsx)(h.Jg,{disabled:!0,iconSize:18,value:1===e.value||0})},headerCellRender:function(e,t){return(0,j.jsx)("i",{className:"dx-icon-home"})}}],N=["key","name"];var y=function(){var e=(0,u.TH)(),t=(0,r.useState)(!1),a=(0,s.Z)(t,2),x=a[0],h=a[1],f=(0,r.useState)([]),b=(0,s.Z)(f,2),y=b[0],g=b[1],Z=(0,r.useState)([]),w=(0,s.Z)(Z,2),R=w[0],I=w[1],D=(0,r.useState)(!1),F=(0,s.Z)(D,2),T=F[0],C=F[1],k=i.ZP.useNotification(),S=(0,s.Z)(k,2),Y=S[0],M=S[1],L=c.Z.useForm(),V=(0,s.Z)(L,1)[0],A=c.Z.useForm(),P=(0,s.Z)(A,1)[0],_=(0,r.useRef)(null);(0,r.useEffect)((function(){e.state&&V.setFieldValue(e.state.name,e.state.value)}),[]),(0,r.useEffect)((function(){P.setFieldsValue({employeeIds:y})}),[y]);var E=(0,r.useCallback)((function(e){I(e)}),[]),H=function(){C(!1),g(P.getFieldValue("employeeIds"))};return(0,j.jsxs)("div",{children:[(0,j.jsx)(d.PeolpeSelectionTable,{ref:_,onSelect:E,onReturn:function(){var e=R.map((function(e){return(0,l.Z)((0,l.Z)({},e),{},{Fullname:"".concat(e.Firstname," ").concat(e.Lastname)})}));g(e),C(!0)},selectedRowsData:R,columns:v}),(0,j.jsxs)(d.Modal,{open:T,onCancel:H,title:(0,j.jsxs)("div",{children:["Transport Audit ",(0,j.jsxs)("span",{className:"text-gray-400 font-normal",children:["(",null===y||void 0===y?void 0:y.length," people selected)"]})]}),width:1e3,children:[(0,j.jsxs)(c.Z,{form:P,size:"small",onFinish:function(e){h(!0),(0,o.Z)({method:"post",url:"tas/audit/transportaudit",responseType:"blob",data:(0,l.Z)((0,l.Z)({},e),{},{startDate:p()(e.startDate).format("YYYY-MM-DD"),endDate:p()(e.endDate).format("YYYY-MM-DD"),employeeIds:e.employeeIds.map((function(e){return e.Id}))})}).then((function(e){if(200===e.status){var t,a=window.URL.createObjectURL(e.data),n=document.createElement("a");n.href=a,n.download="TAS_TRANSPORT_AUDIT_".concat(p()().format("YYYY-MM-dd_HH-mm-ss"),".xlsx"),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),C(!1),null===(t=_.current)||void 0===t||t.instance.clearSelection(),g([])}else Y.error({message:"Audit data not found",duration:5})})).catch((function(e){})).then((function(){return h(!1)}))},children:[(0,j.jsx)(c.Z.List,{name:"employeeIds",children:function(e,t){var a=t.remove;return(0,j.jsx)("div",{className:"border rounded-ot",children:(0,j.jsxs)("table",{className:"table-auto overflow-hidden w-full",children:[(0,j.jsx)("thead",{className:"text-[#959595]",children:(0,j.jsxs)("tr",{className:"text-left",children:[(0,j.jsx)("th",{className:"border-b px-1 font-normal w-[30px]",children:"#"}),(0,j.jsx)("th",{className:"border-b px-1 font-normal",children:"#Person"}),(0,j.jsx)("th",{className:"border-b px-1 font-normal",children:"Fullname"}),(0,j.jsx)("th",{className:"border-b px-1 font-normal",children:"Department"}),(0,j.jsx)("th",{className:"border-b px-1 font-normal"})]})}),(0,j.jsx)("tbody",{children:e.map((function(e){e.key;var t=e.name,s=(0,n.Z)(e,N);return(0,j.jsxs)("tr",{className:"".concat((t+1)%2===0?"bg-[#fafafa]":"white"),children:[(0,j.jsx)("td",{className:"py-1 border-t px-1",children:(0,j.jsx)(c.Z.Item,(0,l.Z)((0,l.Z)({},s),{},{name:[t,"Id"],className:"mb-0",children:(0,j.jsx)("div",{className:"text-[13px] w-[30px]",children:t+1})}))}),(0,j.jsx)("td",{className:"py-1 border-t px-1",children:(0,j.jsx)(c.Z.Item,(0,l.Z)((0,l.Z)({},s),{},{name:[t,"Id"],className:"mb-0",children:(0,j.jsx)("div",{className:"text-[13px]",children:P.getFieldValue(["employeeIds",t,"Id"])})}))}),(0,j.jsx)("td",{className:"py-1 border-t px-1",children:(0,j.jsx)(c.Z.Item,(0,l.Z)((0,l.Z)({},s),{},{className:"mb-0",children:(0,j.jsx)("div",{className:"text-[13px]",children:P.getFieldValue(["employeeIds",t,"Fullname"])})}))}),(0,j.jsx)("td",{className:"py-1 border-t px-1",children:(0,j.jsx)(c.Z.Item,(0,l.Z)((0,l.Z)({},s),{},{className:"mb-0",children:(0,j.jsx)("div",{children:P.getFieldValue(["employeeIds",t,"DepartmentName"])})}))}),(0,j.jsx)("td",{className:"py-1 border-t px-1",children:(0,j.jsx)("button",{type:"button",className:"dlt-button text-xs",onClick:function(){!function(e){var t;null===(t=_.current)||void 0===t||t.instance.deselectRows([e])}(P.getFieldValue(["employeeIds",t,"Id"])),a(t)},children:"Remove"})})]})}))})]})})}}),(0,j.jsxs)("div",{className:"flex gap-4 mt-4",children:[(0,j.jsx)(c.Z.Item,{label:"StartDate",className:"mb-0",name:"startDate",rules:[{required:!0}],children:(0,j.jsx)(m.Z,{})},"form-startdate"),(0,j.jsx)(c.Z.Item,{label:"endDate",className:"mb-0",name:"endDate",rules:[{required:!0}],children:(0,j.jsx)(m.Z,{})},"form-enddate")]})]}),(null===y||void 0===y?void 0:y.length)>0&&(0,j.jsxs)("div",{className:"flex items-center justify-end gap-5 mt-4",children:[(0,j.jsx)(d.Button,{type:"primary",onClick:function(){return P.submit()},loading:x,children:"Download"}),(0,j.jsx)(d.Button,{onClick:H,disabled:x,children:"Cancel"})]})]}),M]})}}}]);