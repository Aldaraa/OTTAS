"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[2967],{32967:function(e,n,t){t.r(n);var l=t(74165),a=t(15861),s=t(29439),o=t(56573),i=t(2880),c=t(42614),r=t(14261),d=t(47313),u=t(81514),m=t(65040),p=t(12998),h=t(29074),f=t(40765),x=t(6986),v=t(22231),j=t(10658),w=t.n(j),b=t(76738),Z=t(46417),y=[{label:"Department Name",name:"Name",className:"col-span-3 mb-2"}];n.default=function(){var e,n,t,j,g,N,C=(0,d.useState)([]),k=(0,s.Z)(C,2),R=k[0],S=k[1],D=(0,d.useState)([]),F=(0,s.Z)(D,2),B=F[0],E=F[1],U=(0,d.useState)(!1),A=(0,s.Z)(U,2),T=A[0],Y=A[1],L=(0,d.useState)(!1),I=(0,s.Z)(L,2),_=I[0],M=I[1],P=(0,d.useState)([]),O=(0,s.Z)(P,2),q=O[0],K=O[1],G=(0,d.useState)(!1),V=(0,s.Z)(G,2),z=V[0],H=V[1],J=(0,d.useState)(!1),Q=(0,s.Z)(J,2),W=Q[0],X=Q[1],$=(0,d.useState)(!1),ee=(0,s.Z)($,2),ne=ee[0],te=ee[1],le=(0,d.useState)(null),ae=(0,s.Z)(le,2),se=ae[0],oe=ae[1],ie=(0,d.useState)(null),ce=(0,s.Z)(ie,2),re=ce[0],de=ce[1],ue=(0,d.useState)(!1),me=(0,s.Z)(ue,2),pe=me[0],he=me[1],fe=(0,d.useState)(!1),xe=(0,s.Z)(fe,2),ve=xe[0],je=xe[1],we=(0,d.useState)(null),be=(0,s.Z)(we,2),Ze=be[0],ye=be[1],ge=(0,d.useState)(!1),Ne=(0,s.Z)(ge,2),Ce=Ne[0],ke=Ne[1],Re=(0,d.useState)(!1),Se=(0,s.Z)(Re,2),De=Se[0],Fe=Se[1],Be=(0,d.useState)(null),Ee=(0,s.Z)(Be,2),Ue=Ee[0],Ae=Ee[1],Te=(0,d.useState)(null),Ye=(0,s.Z)(Te,2),Le=Ye[0],Ie=Ye[1],_e=(0,d.useContext)(c.V),Me=_e.state,Pe=(_e.action,m.Z.useForm()),Oe=(0,s.Z)(Pe,1)[0],qe=p.ZP.useNotification(),Ke=(0,s.Z)(qe,2),Ge=Ke[0],Ve=Ke[1];(0,d.useEffect)((function(){ze()}),[]);var ze=function(){Y(!0),(0,o.Z)({method:"get",url:"tas/department/minimum"}).then((function(e){S(e.data),E(e.data)})).catch((function(e){})).then((function(){return Y(!1)}))},He=[{label:"Department Name",name:"Name"},{label:"Parent Department",name:"parentdepartmentname",alignment:"left"},{label:"# Resource",name:"EmployeeCount",alignment:"left",cellRender:function(e){return e.value>0?(0,Z.jsx)("button",{onClick:function(){return n=e.data,ye(n),void he(!0);var n},className:"text-blue-400 hover:underline",children:e.value}):(0,Z.jsx)("span",{children:e.value})}}],Je=(0,d.useCallback)((function(e){K(e.selectedRowKeys)}),[]),Qe=(0,d.useCallback)((function(){H(!0),(0,o.Z)({method:"post",url:"tas/department/bulkrequest",responseType:"blob",data:{departmentIds:q}}).then(function(){var e=(0,a.Z)((0,l.Z)().mark((function e(n){var t,a,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.URL.createObjectURL(new Blob([n.data]));case 2:return t=e.sent,a="TAS_Department_Bulk_Download_".concat(w()().format("YYYY-MM-DD hh:mm:ss"),".xlsx"),e.next=6,document.createElement("a");case 6:return(s=e.sent).href=t,e.next=10,s.setAttribute("download",a);case 10:return e.next=12,document.body.appendChild(s);case 12:return e.next=14,s.click();case 14:return e.next=16,H(!1);case 16:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){H(!1)}))}),[q]),We=[{label:"Excel Row Index",name:"ExcelRowIndex",alignment:"left",width:"120px"},{label:"Error",name:"Error",alignment:"left"}];return(0,Z.jsxs)("div",{children:[(0,Z.jsxs)("div",{className:"rounded-ot bg-white px-3 py-2 mb-3 shadow-md",children:[(0,Z.jsx)("div",{className:"text-lg font-bold mb-2",children:"Bulk Department"}),(0,Z.jsx)(i.Form,{form:Oe,fields:y,className:"grid grid-cols-12 gap-x-8",onFinish:function(e){M(!0),(0,u.Z)(e,R,null,"ChildDepartments").then((function(e){E(e),M(!1)}))},noLayoutConfig:!0,children:(0,Z.jsx)("div",{className:"col-span-1 flex items-baseline",children:(0,Z.jsx)(i.Button,{htmlType:"submit",loading:_,icon:(0,Z.jsx)(f.Z,{}),children:"Search"})})})]}),(0,Z.jsx)(i.Table,{id:"room",dataSource:B,className:"overflow-hidden max-h-[calc(100vh-250px)] ".concat(!(null!==(e=Me.userInfo)&&void 0!==e&&e.ReadonlyAccess)&&"border-t"),columns:He,showRowLines:!0,keyExpr:"Id",selection:{mode:"multiple",recursive:!0,showCheckBoxesMode:"always",allowSelectAll:!0,selectAllMode:"page"},selectedRowKeys:q,rowAlternationEnabled:!1,onSelectionChanged:Je,autoExpandAll:!0,loading:T,title:null!==(n=Me.userInfo)&&void 0!==n&&n.ReadonlyAccess?"":(0,Z.jsxs)("div",{className:"flex justify-between py-2 gap-3 border-b",children:[(0,Z.jsxs)("div",{className:"ml-2",children:[(0,Z.jsx)("span",{className:"font-bold",children:q.length})," people selected"]}),(0,Z.jsxs)("div",{className:"flex gap-3",children:[(0,Z.jsx)(i.Button,{disabled:0===q.length,icon:(0,Z.jsx)(x.Z,{}),onClick:Qe,loading:z,children:"Download"}),(0,Z.jsx)(i.FileUploader,{icon:(0,Z.jsx)(v.Z,{}),onChange:function(e){if((0,b.Z)(e)){de(e),X(!0);var n=new FormData;n.append("BulkDepartmentFile",e),e&&(0,o.Z)({method:"post",url:"tas/department/bulkuploadpreview",headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},data:n}).then((function(e){oe(e.data),te(!0)})).catch((function(e){})).then((function(){return X(!1)}))}else Ge.error({message:"Error",placement:"top",duration:0,description:(0,Z.jsx)("div",{className:"flex items-center justify-center",children:"You can only upload an excel file !"})})},accept:".xlsx",loading:W,children:"Upload"}),(0,Z.jsx)(i.FileUploader,{icon:(0,Z.jsx)(v.Z,{}),onChange:function(e){if((0,b.Z)(e)){Ie(e),Fe(!0);var n=new FormData;n.append("BulkDepartmentFile",e),e&&(0,o.Z)({method:"post",url:"tas/department/bulkuploademployeespreview",headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},data:n}).then((function(e){Ae(e.data),je(!0)})).catch((function(e){})).then((function(){return Fe(!1)}))}else Ge.error({message:"Error",placement:"top",duration:0,description:(0,Z.jsx)("div",{className:"flex items-center justify-center",children:"You can only upload an excel file !"})})},accept:".xlsx",loading:De,children:"Upload Employees"})]})]})}),(0,Z.jsxs)(i.Modal,{title:"Uploaded",open:ne,onCancel:function(){return te(!1)},children:[(0,Z.jsxs)("div",{className:"mt-5 text-xs",children:[(0,Z.jsxs)("div",{className:"grid grid-cols-12 gap-2 mb-5",children:[(0,Z.jsxs)("div",{className:"col-span-4 text-green-500",children:["Added Row: ",(0,Z.jsx)(h.Z,{className:"ml-1",color:"green",children:null===se||void 0===se?void 0:se.AddRow})]}),(0,Z.jsxs)("div",{className:"col-span-4 text-blue-400",children:["Updated Row: ",(0,Z.jsx)(h.Z,{className:"ml-1",color:"blue",children:null===se||void 0===se?void 0:se.UpdateRow})]}),(0,Z.jsxs)("div",{className:"col-span-4 text-red-500",children:["Deactivated Row: ",(0,Z.jsx)(h.Z,{className:"ml-1",color:"red",children:null===se||void 0===se?void 0:se.DeleteRow})]}),(0,Z.jsxs)("div",{className:"col-span-4",children:["Failed Row: ",(0,Z.jsx)(h.Z,{className:"ml-1",children:null===se||void 0===se||null===(t=se.FailedRows)||void 0===t?void 0:t.length})]}),(0,Z.jsxs)("div",{className:"col-span-4",children:["None Row: ",(0,Z.jsx)(h.Z,{className:"ml-1",children:null===se||void 0===se?void 0:se.NoneRow})]})]}),(null===se||void 0===se||null===(j=se.FailedRows)||void 0===j?void 0:j.length)>0&&(0,Z.jsx)(i.Table,{columns:We,data:null===se||void 0===se?void 0:se.FailedRows,containerClass:"shadow-none border-t",tableClass:"max-h-[100px]"})]}),(0,Z.jsxs)("div",{className:"flex justify-end gap-5 items-center",children:[(0,Z.jsx)(i.Button,{type:"primary",loading:W,onClick:function(){return function(){X(!0);var e=new FormData;e.append("BulkDepartmentFile",re),re&&(0,o.Z)({method:"post",url:"tas/department/bulkupload",headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},data:e}).then((function(e){te(!1),de(null),Oe.submit(),ze()})).catch((function(e){})).then((function(){return X(!1)}))}()},children:"Process"}),(0,Z.jsx)(i.Button,{onClick:function(){te(!1),de(null)},disabled:W,children:"Cancel"})]})]}),(0,Z.jsxs)(i.Modal,{title:"Uploaded Employee",open:ve,onCancel:function(){return je(!1)},children:[(0,Z.jsxs)("div",{className:"mt-5 text-xs",children:[(0,Z.jsxs)("div",{className:"grid grid-cols-12 gap-2 mb-5",children:[(0,Z.jsxs)("div",{className:"col-span-4 text-blue-400",children:["Updated Row: ",(0,Z.jsx)(h.Z,{className:"ml-1",color:"blue",children:null===Ue||void 0===Ue?void 0:Ue.UpdateRow})]}),(0,Z.jsxs)("div",{className:"col-span-4",children:["Failed Row: ",(0,Z.jsx)(h.Z,{className:"ml-1",children:null===Ue||void 0===Ue||null===(g=Ue.FailedRows)||void 0===g?void 0:g.length})]}),(0,Z.jsxs)("div",{className:"col-span-4",children:["None Row: ",(0,Z.jsx)(h.Z,{className:"ml-1",children:null===Ue||void 0===Ue?void 0:Ue.NoneRow})]})]}),(null===Ue||void 0===Ue||null===(N=Ue.FailedRows)||void 0===N?void 0:N.length)>0&&(0,Z.jsx)(i.Table,{columns:We,data:null===Ue||void 0===Ue?void 0:Ue.FailedRows,containerClass:"shadow-none border-t",tableClass:"max-h-[100px]"})]}),(0,Z.jsxs)("div",{className:"flex justify-end gap-5 items-center",children:[(0,Z.jsx)(i.Button,{type:"primary",loading:W,onClick:function(){return function(){X(!0);var e=new FormData;e.append("BulkDepartmentFile",Le),Le&&(0,o.Z)({method:"post",url:"tas/department/bulkuploademployees",headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},data:e}).then((function(e){je(!1),Ie(null),Oe.submit(),ze()})).catch((function(e){})).then((function(){return X(!1)}))}()},children:"Process"}),(0,Z.jsx)(i.Button,{onClick:function(){je(!1),Ie(null)},disabled:W,children:"Cancel"})]})]}),(0,Z.jsx)(r.GI,{visible:pe,showTitle:!1,height:"auto",width:350,children:(0,Z.jsxs)("div",{children:[(0,Z.jsx)("div",{children:"Are you sure you want to download this record data?"}),(0,Z.jsxs)("div",{className:"flex gap-5 mt-3 justify-center",children:[(0,Z.jsx)(i.Button,{type:"success",onClick:function(){ke(!0),(0,o.Z)({method:"post",url:"tas/department/bulkrequestemployees",responseType:"blob",data:{departmentId:Ze.Id}}).then(function(){var e=(0,a.Z)((0,l.Z)().mark((function e(n){var t,a,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.URL.createObjectURL(new Blob([n.data]));case 2:return t=e.sent,a="TAS_".concat(Ze.Name,"_Employees_").concat(w()().format("YYYY-MM-DD hh:mm:ss"),".xlsx"),e.next=6,document.createElement("a");case 6:return(s=e.sent).href=t,e.next=10,s.setAttribute("download",a);case 10:return e.next=12,document.body.appendChild(s);case 12:return e.next=14,s.click();case 14:he(!1);case 15:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){})).then((function(){ke(!1)}))},loading:Ce,children:"Yes"}),(0,Z.jsx)(i.Button,{onClick:function(){return he(!1)},disabled:Ce,children:"No"})]})]})}),Ve]})}},81514:function(e,n,t){t.d(n,{Z:function(){return i}});var l=t(93433),a=t(4942),s=t(1413);var o=function e(n,t,l){var o=[],i=Object.keys(t);return n.map((function(n){if(n[l].length>0)o.push((0,s.Z)((0,s.Z)({},n),{},(0,a.Z)({},l,e(n[l],t,l))));else{var c=!1;i.map((function(e){var l,a;""!==t[e]&&"undefined"!==typeof t[e]&&null!==t[e]?c="string"===typeof t[e]?c||(null===(l=n[e])||void 0===l?void 0:l.toLowerCase().includes(null===(a=t[e])||void 0===a?void 0:a.toLowerCase())):c||n[e]===t[e]:c=!0})),c&&o.push(n)}})),o};function i(e,n,t,a){return"tree"===t?o(n,e,a):new Promise((function(t,a){var s=Object.keys(e),o=(0,l.Z)(n);s.map((function(n){""!==e[n]&&"undefined"!==typeof e[n]&&null!==e[n]&&(o="string"===typeof e[n]?o.filter((function(t){var l,a;return null===(l=t[n])||void 0===l?void 0:l.toLowerCase().includes(null===(a=e[n])||void 0===a?void 0:a.toLowerCase())})):o.filter((function(t){return t[n]===e[n]})))})),t(o)}))}},76738:function(e,n){var t=["text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"];n.Z=function(e){return!!t.includes(e.type)}}}]);