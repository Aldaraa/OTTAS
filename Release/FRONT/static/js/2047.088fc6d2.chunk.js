"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[2047],{92047:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var a=n(1413),o=n(29439),r=n(56573),l=n(2880),s=n(47313),i=n(65040),d=n(29074),c=n(93031),u=n(89720),m=n(40765),p=n(82138),f=n(58467),h=n(10658),v=n.n(h),D=n(42614),x=n(92350),I=n(74294),F=n(21975),j=n(31283),T=n(46417);var S=function(e){var t,n=e.data,a=e.editData,d=e.refreshData,u=e.handleCancel,m=e.flights,p=(0,s.useState)(!1),h=(0,o.Z)(p,2),S=h[0],g=h[1],b=i.Z.useForm(),N=(0,o.Z)(b,1)[0],C=(0,s.useContext)(D.V),w=C.state,Z=C.action,y=(0,f.UO)().employeeId;(0,s.useEffect)((function(){if(a){N.setFieldValue("CostCodeId",null===n||void 0===n?void 0:n.CostCodeId);var e=m[a.rowIndex+1];N.setFieldValue(["firstTransport","Date"],v()(null===a||void 0===a?void 0:a.EventDate)),N.setFieldValue(["firstTransport","Direction"],null===a||void 0===a?void 0:a.Direction),N.setFieldValue(["firstTransport","Description"],"".concat(a.Code," ").concat(a.Description," ").concat(a.TransportMode)),N.setFieldValue(["firstTransport","ScheduleId"],a.Id),e&&(N.setFieldValue(["lastTransport","Date"],v()(e.EventDate).format("YYYY-MM-DD")),N.setFieldValue(["lastTransport","Direction"],e.Direction),N.setFieldValue(["lastTransport","Description"],"".concat(e.Code," ").concat(e.Description," ").concat(a.TransportMode)),N.setFieldValue(["lastTransport","ScheduleId"],e.Id))}}),[a]);var V=[{type:"component",component:(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(l.Form.Item,{label:"First Transport",className:"col-span-12 mb-2",children:(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)(l.Form.Item,{name:["firstTransport","Date"],className:"mb-0 w-[130px]",children:(0,T.jsx)(c.Z,{disabled:!0,className:"w-full"})}),(0,T.jsx)(l.Form.Item,{name:["firstTransport","Direction"],className:"mb-0 w-[70px]",children:(0,T.jsx)(I.Z,{disabled:!0,options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],className:"w-full"})}),(0,T.jsx)(l.Form.Item,{className:"mb-0 flex-1",name:["firstTransport","Description"],rules:[{required:!0,message:"Flight is required"}],children:(0,T.jsx)(F.Z,{disabled:!0,className:"w-full"})}),(0,T.jsx)(l.Form.Item,{name:["firstTransport","ScheduleId"],noStyle:!0,rules:[{required:!0,message:"Flight is required"}]}),(0,T.jsx)(l.Form.Item,{name:["firstTransport","NoShow"],className:"mb-0",valuePropName:"checked",getValueFromEvent:function(e){var t;return null!==(t=e.target)&&void 0!==t&&t.checked?1:0},children:(0,T.jsx)(j.Z,{children:"No Show"})})]})})})},{type:"component",component:(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(l.Form.Item,{label:"Last Transport",className:"col-span-12 mb-2",children:(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)(l.Form.Item,{name:["lastTransport","Date"],className:"mb-0 w-[130px]",children:(0,T.jsx)(I.Z,{options:m.filter((function(e){return e.Direction!==(null===a||void 0===a?void 0:a.Direction)&&v()(e.EventDate).diff(v()(a.EventDate))>0})),fieldNames:{value:"EventDate",label:"label"},onChange:function(e,t){return n=t,N.setFieldValue(["lastTransport","Description"],"".concat(n.Code," ").concat(n.Description)),void N.setFieldValue(["lastTransport","ScheduleId"],n.Id);var n}})}),(0,T.jsx)(l.Form.Item,{name:["lastTransport","Direction"],className:"mb-0 w-[70px]",children:(0,T.jsx)(I.Z,{disabled:!0,options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],className:"w-full"})}),(0,T.jsx)(l.Form.Item,{noStyle:!0,name:["lastTransport","ScheduleId"],rules:[{required:!0,message:"Last Transport is required"}]}),(0,T.jsx)(l.Form.Item,{name:["lastTransport","Description"],className:"mb-0 flex-1",children:(0,T.jsx)(F.Z,{disabled:!0})}),(0,T.jsx)(l.Form.Item,{name:["lastTransport","NoShow"],className:"mb-0",valuePropName:"checked",getValueFromEvent:function(e){var t;return null!==(t=e.target)&&void 0!==t&&t.checked?1:0},children:(0,T.jsx)(j.Z,{children:"No Show"})})]})})})},{type:"component",component:(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){var n,a;return(null===(n=e.firstTransport)||void 0===n?void 0:n.Date)!==(null===(a=t.firstTransport)||void 0===a?void 0:a.Date)},children:function(e){var t,a,o=e.getFieldValue,s=o(["firstTransport","Date"]),i=null;return"IN"===o(["firstTransport","Direction"])?(i=0,s&&(a=v()(s).format("YYYY-MM-DD"),(0,r.Z)({method:"get",url:"tas/employeestatus/lasterstatus/offsite/".concat(n.Id,"/").concat(a)}).then((function(e){N.setFieldValue("ShiftId",e.data.ShiftId)})).catch((function(e){})))):(i=1,s&&function(e){(0,r.Z)({method:"get",url:"tas/employeestatus/lasterstatus/onsite/".concat(n.Id,"/").concat(e)}).then((function(e){N.setFieldValue("ShiftId",e.data.ShiftId)})).catch((function(e){}))}(v()(s).format("YYYY-MM-DD"))),(0,T.jsx)(l.Form.Item,{className:"col-span-12 mb-2",name:"ShiftId",label:"Shift Status",rules:[{required:!0,message:"Shift Status is required"}],children:(0,T.jsx)(I.Z,{options:"number"===typeof i?null===(t=w.referData)||void 0===t?void 0:t.roomStatuses.filter((function(e){return e.OnSite===i})):[],showSearch:!0,allowClear:!0})})}})},{label:"Cost Code",name:"CostCodeId",className:"col-span-12 mb-2",type:"select",rules:[{required:!0,message:"Cost Code is required"}],inputprops:{options:null===(t=w.referData)||void 0===t?void 0:t.costCodes}},{label:"No Show",name:"noShow",className:"col-span-12 mb-2",type:"check"}];return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Form,{form:N,fields:V,onFinish:function(e){g(!0),(0,r.Z)({method:"delete",url:"tas/transport/removetransport",data:{startScheduleId:e.firstTransport.ScheduleId,endScheduleId:e.lastTransport.ScheduleId,firstScheduleNoShow:e.firstTransport.NoShow,lastScheduleNoShow:e.lastTransport.NoShow,shiftId:e.ShiftId,noShow:e.noShow}}).then((function(e){u(),d(),(0,r.Z)({method:"get",url:"tas/employee/".concat(y)}).then((function(e){Z.saveUserProfileData(e.data)})).catch((function(e){}))})).catch((function(e){})).then((function(){return g(!1)}))},labelCol:{flex:"150px"},wrapperCol:{flex:1}}),(0,T.jsxs)("div",{className:"gap-3 flex justify-end mt-3",children:[(0,T.jsx)(l.Button,{type:"primary",onClick:function(){return N.submit()},loading:S,icon:(0,T.jsx)(x.Z,{}),children:"Remove"}),(0,T.jsx)(l.Button,{onClick:u,children:"Cancel"})]})]})};var g=function(e){var t,n,i=e.data,d=e.handleShowModal,u=e.refreshData,m=e.reScheduleForm,p=(0,s.useState)([]),h=(0,o.Z)(p,2),S=(h[0],h[1]),g=(0,s.useState)(!1),b=(0,o.Z)(g,2),N=b[0],C=b[1],w=(0,s.useState)(!1),Z=(0,o.Z)(w,2),y=Z[0],V=Z[1],Y=(0,s.useState)(null),R=(0,o.Z)(Y,2),E=R[0],k=R[1],L=(0,s.useState)(null),M=(0,o.Z)(L,2),q=M[0],O=M[1],U=(0,s.useContext)(D.V),P=U.state,B=U.action,G=(0,f.UO)().employeeId;(0,s.useEffect)((function(){var e,t;i&&(O((0,a.Z)((0,a.Z)({},i),{},{FromLocationId:null===i||void 0===i?void 0:i.fromLocationId,ToLocationId:null===i||void 0===i?void 0:i.toLocationId})),null===m||void 0===m||m.setFieldsValue({startDate:v()(i.EventDate),shiftId:null,Direction:i.Direction,startFlight:"".concat(i.Code," ").concat(i.Description," ").concat(i.TransportMode),DepartmentId:null===P||void 0===P||null===(e=P.userProfileData)||void 0===e?void 0:e.DepartmentId,CostCodeId:null===P||void 0===P||null===(t=P.userProfileData)||void 0===t?void 0:t.CostCodeId}))}),[i]);var A=function(){var e={StartDate:m.getFieldValue("endDate")?m.getFieldValue("endDate"):null,EndDate:m.getFieldValue("endDate")?m.getFieldValue("endDate"):null};q?(e.DepartLocationId=q.FromLocationId,e.ArriveLocationId=q.ToLocationId):e=(m.getFieldValue("Direction")&&m.getFieldValue("Direction"),(0,a.Z)((0,a.Z)({},e),{},{DepartLocationId:null===i||void 0===i?void 0:i.fromLocationId,ArriveLocationId:null===i||void 0===i?void 0:i.toLocationId})),k((0,a.Z)({},e)),V(!0)},z=function(e,t){!function(e){e&&(0,r.Z)({method:"get",url:"tas/ActiveTransport/getdatetransport?eventDate=".concat(e,"&Direction=").concat(i.Direction)}).then((function(e){var t,n,a=[];e.data.map((function(e){a.push({value:e.ScheduleId,label:"".concat(e.Description," ").concat(e.Seat,"/").concat(e.BookedCount)})})),null!==(t=e.data[0])&&void 0!==t&&t.ScheduleId?m.setFieldValue("reschdeleFlightId",null===(n=a[0])||void 0===n?void 0:n.value):m.setFieldValue("reschdeleFlightId",null),S(a)}))}(t),m.setFieldValue("reschdeleFlightId",null),m.setFieldValue("ReScheduleDescription",null)},W=function(e){m.setFieldValue("ReScheduleDescription","".concat(e.Code," ").concat(e.Description)),m.setFieldValue("reschdeleFlightId",e.Id)},X=[{type:"component",component:(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(l.Form.Item,{label:"Existing Transport",className:"col-span-12 mb-2",children:(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)(l.Form.Item,{name:"startDate",className:"mb-0 w-[130px]",children:(0,T.jsx)(c.Z,{disabled:!0,className:"w-full"})}),(0,T.jsx)(l.Form.Item,{name:"Direction",className:"mb-0 w-[70px]",children:(0,T.jsx)(I.Z,{disabled:!0,options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],className:"w-full"})}),(0,T.jsx)(l.Form.Item,{name:"startFlight",className:"mb-0 flex-1",rules:[{required:!0,message:"Flight is required"}],children:(0,T.jsx)(F.Z,{disabled:!0})}),(0,T.jsx)(l.Form.Item,{name:"existingScheduleIdNoShow",className:"mb-0",valuePropName:"checked",getValueFromEvent:function(e){var t;return null!==(t=e.target)&&void 0!==t&&t.checked?1:0},children:(0,T.jsx)(j.Z,{children:"No Show"})})]})})})},{type:"component",component:(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(l.Form.Item,{label:"Reschedule Transport",className:"col-span-12 mb-2",children:(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.startDate!==t.startDate||e.endDate!==t.endDate},children:function(e){var t=e.getFieldValue,n=!1;return t("endDate")||(n=t("startDate")),(0,T.jsx)(l.Form.Item,{name:"endDate",className:"mb-0 w-[130px]",children:(0,T.jsx)(c.Z,{defaultPickerValue:n,showWeek:!0,className:"w-full",onChange:z})})}}),(0,T.jsx)(l.Form.Item,{name:"Direction",className:"mb-0 w-[70px]",children:(0,T.jsx)(I.Z,{disabled:!0,options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],className:"w-full"})}),(0,T.jsx)(l.Form.Item,{noStyle:!0,name:"reschdeleFlightId"}),(0,T.jsx)(l.Form.Item,{name:"ReScheduleDescription",className:"flex-1 mb-0",children:(0,T.jsx)(F.Z,{readOnly:!0})}),(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.endDate!==t.endDate},children:function(e){var t=!(0,e.getFieldValue)("endDate");return(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",children:(0,T.jsx)(l.Button,{disabled:t,className:"text-xs py-[5px]",type:"primary",onClick:A,children:"..."})})}}),(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.endDate!==t.endDate},children:function(e){var t=e.getFieldValue,n=t("endDate"),a={eventDate:n,direction:t("Direction")};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",children:(0,T.jsx)(l.ButtonDrive,{onRecieve:W,searchValues:a,className:"py-[5px]",disabled:!n})}),(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",children:(0,T.jsx)(l.ButtonDrive,{onRecieve:W,searchValues:a,className:"py-[5px]",disabled:!n,mode:"evening"})})]})}}),(0,T.jsx)(l.Form.Item,{name:"reScheduleGoShow",className:"mb-0",valuePropName:"checked",getValueFromEvent:function(e){var t;return null!==(t=e.target)&&void 0!==t&&t.checked?1:0},children:(0,T.jsx)(j.Z,{children:"Go Show"})})]})})})},{type:"component",component:(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.endDate!==t.endDate},children:function(e){var t,n,a,o,s=e.getFieldValue,i=(e.setFieldValue,null),d=s("startDate"),c=s("endDate");return c&&d&&(v()(c)-v()(d)>0?"IN"===s("Direction")?(i=0,o=v()(c).format("YYYY-MM-DD"),(0,r.Z)({method:"get",url:"tas/employeestatus/lasterstatus/offsite/".concat(null===P||void 0===P?void 0:P.userProfileData.Id,"/").concat(o)}).then((function(e){m.setFieldValue("ShiftId",e.data.ShiftId)})).catch((function(e){}))):(i=1,function(e){(0,r.Z)({method:"get",url:"tas/employeestatus/lasterstatus/onsite/".concat(null===P||void 0===P?void 0:P.userProfileData.Id,"/").concat(e)}).then((function(e){m.setFieldValue("ShiftId",e.data.ShiftId)})).catch((function(e){}))}(v()(c).format("YYYY-MM-DD"))):"IN"===s("Direction")?(i=1,function(e){(0,r.Z)({method:"get",url:"tas/employeestatus/futurefirststatus/onsite/".concat(null===P||void 0===P?void 0:P.userProfileData.Id,"/").concat(e)}).then((function(e){m.setFieldValue("ShiftId",e.data.ShiftId)})).catch((function(e){}))}(v()(c).format("YYYY-MM-DD"))):(i=0,function(e){(0,r.Z)({method:"get",url:"tas/employeestatus/futurefirststatus/offsite/".concat(null===P||void 0===P?void 0:P.userProfileData.Id,"/").concat(e)}).then((function(e){m.setFieldValue("ShiftId",e.data.ShiftId)})).catch((function(e){}))}(v()(c).format("YYYY-MM-DD")))),(0,T.jsx)(l.Form.Item,{label:"Shift Status",name:"ShiftId",className:"col-span-12 mb-2",rules:[{required:!0,message:"Shift is required"}],children:(0,T.jsx)(I.Z,{options:"number"===typeof i?null===(t=P.referData)||void 0===t||null===(n=t.roomStatuses)||void 0===n?void 0:n.filter((function(e){return e.OnSite===i})):null===(a=P.referData)||void 0===a?void 0:a.roomStatuses,filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())},className:"w-full",showSearch:!0,allowClear:!0})})}})},{label:"Department",name:"DepartmentId",className:"col-span-12 mb-2",type:"treeSelect",rules:[{required:!0,message:"Department is required"}],inputprops:{treeData:null===(t=P.referData)||void 0===t?void 0:t.departments,fieldNames:{label:"Name",value:"Id",children:"ChildDepartments"},allowClear:!0,showSearch:!0,filterTreeNode:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.Name)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())}}},{label:"Cost Code",name:"CostCodeId",className:"col-span-12 mb-2",type:"select",rules:[{required:!0,message:"Cost Code is required"}],inputprops:{options:null===(n=P.referData)||void 0===n?void 0:n.costCodes}}];return(0,T.jsxs)("div",{children:[(0,T.jsx)(l.Form,{form:m,fields:X,onFinish:function(e){C(!0),(0,r.Z)({method:"put",url:"tas/transport/reschedule",data:{shiftId:e.ShiftId,scheduleId:e.reschdeleFlightId,oldTransportId:i.Id,departmentId:e.DepartmentId,costCodeId:e.CostCodeId,existingScheduleIdNoShow:e.existingScheduleIdNoShow,reScheduleGoShow:e.reScheduleGoShow}}).then((function(e){d(!1),m.resetFields(),u(),(0,r.Z)({method:"get",url:"tas/employee/".concat(G)}).then((function(e){B.saveUserProfileData(e.data)})).catch((function(e){}))})).catch((function(e){})).then((function(){return C(!1)}))},labelCol:{flex:"140px"},wrapperCol:{flex:1},children:(0,T.jsxs)("div",{className:"col-span-12 gap-3 flex justify-end mt-3",children:[(0,T.jsx)(l.Button,{type:"primary",onClick:function(){return m.submit()},loading:N,icon:(0,T.jsx)(x.Z,{}),children:"Reschedule"}),(0,T.jsx)(l.Button,{onClick:function(){return d(!1)},disabled:N,children:"Cancel"})]})}),(0,T.jsx)(l.Modal,{title:"Select Transport",open:y,width:900,onCancel:function(){return V(!1)},destroyOnClose:!1,children:(0,T.jsx)(l.TransportSearch,{initialSearchValues:E,handleSelect:function(e){O(e),m.setFieldValue("ReScheduleDescription","".concat(e.Code," ").concat(e.Description," ").concat(e.TransportMode)),m.setFieldValue("reschdeleFlightId",e.Id),V(!1)},directionDisabled:!0})})]})},b=n(81237),N=n(14261),C=n(45987),w=n(73030),Z=["form","startDate","endDate"],y=s.memo((function(e){var t=e.children,n=e.run;return(0,T.jsx)("div",{className:(0,w.m6)("origin-center",n?"animate-jump":""),children:t})}));var V=function(e){var t,n=e.form,a=e.startDate,i=void 0===a?null:a,d=e.endDate,c=void 0===d?null:d,u=(0,C.Z)(e,Z),m=(0,s.useState)(!1),p=(0,o.Z)(m,2),f=p[0],h=p[1],v=(0,s.useState)(!1),x=(0,o.Z)(v,2),F=x[0],j=x[1],S=(0,s.useState)(!1),g=(0,o.Z)(S,2),b=g[0],w=g[1],V=(0,s.useContext)(D.V).state;(0,s.useEffect)((function(){(null===n||void 0===n?void 0:n.getFieldValue("RoomId"))&&V.userProfileData&&Y()}),[i,c,V.userProfileData,n]);var Y=function(){var e,t=n.getFieldValue("RoomId");i&&c&&t&&(0,r.Z)({method:"post",url:"tas/room/findavailablebyroomid",data:{startDate:i,endDate:c,roomId:t,EmployeeId:null===(e=V.userProfileData)||void 0===e?void 0:e.Id}}).then((function(e){e.data.status?h(!1):(h(!0),R())})).catch((function(e){}))},R=function(){w(!0),setTimeout((function(){w(!1)}),700)};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Form.Item,{label:"Room",className:"col-span-12 mb-2",children:(0,T.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,T.jsx)(l.Form.Item,{name:"RoomId",className:"flex-1 mb-0",rules:[{required:!0,message:"Room is required"}],validateStatus:!!f&&"error",help:!!f&&(0,T.jsx)(y,{run:b,children:"Room is not available"}),children:(0,T.jsx)(I.Z,{disabled:!0,options:null===u||void 0===u||null===(t=u.inputprops)||void 0===t?void 0:t.options})},"form-item-RoomId"),(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.RoomId!==t.RoomId},children:function(e){var t=(0,e.getFieldValue)("RoomId");return f||!t?(0,T.jsx)(l.Button,{htmlType:"button",onClick:function(e){j(!0)},disabled:!i,children:"Set No Room"}):null}})]})}),(0,T.jsxs)(N.GI,{visible:F,showTitle:!1,height:135,width:400,children:[(0,T.jsxs)("div",{className:"font-bold",children:["Room is unavailable on ",i," - ",c]}),(0,T.jsx)("div",{className:"mt-4 text-center",children:"Do you wish to book No Room?"}),(0,T.jsxs)("div",{className:"flex gap-5 mt-3 justify-center",children:[(0,T.jsx)(l.Button,{type:"primary",onClick:function(){var e,t;j(!1),h(!1),n.setFieldValue("RoomId",null===(e=V.referData)||void 0===e||null===(t=e.noRoomId)||void 0===t?void 0:t.Id)},children:"Yes"}),(0,T.jsx)(l.Button,{onClick:function(){return j(!1)},children:"No"})]})]})]})};var Y=function(e){var t,n,i,d,u,m,p=e.onCancel,f=e.refresh,h=e.employeeId,x=(0,s.useContext)(D.V),S=x.state,g=(x.action,(0,s.useState)(null)),b=(0,o.Z)(g,2),N=b[0],C=b[1],w=(0,s.useState)(null),Z=(0,o.Z)(w,2),y=Z[0],Y=Z[1],R=(0,s.useState)(null),E=(0,o.Z)(R,2),k=E[0],L=E[1],M=(0,s.useState)(!1),q=(0,o.Z)(M,2),O=q[0],U=q[1],P=(0,s.useState)(!1),B=(0,o.Z)(P,2),G=B[0],A=B[1],z=l.Form.useForm(),W=(0,o.Z)(z,1)[0],X={DepartLocationId:null===(t=S.userProfileData)||void 0===t?void 0:t.LocationId,ArriveLocationId:null===(n=S.referData)||void 0===n||null===(i=n.locations)||void 0===i?void 0:i.find((function(e){return"OT"===e.Code})).Id},_={DepartLocationId:null===(d=S.referData)||void 0===d||null===(u=d.locations)||void 0===u?void 0:u.find((function(e){return"OT"===e.Code})).Id,ArriveLocationId:null===(m=S.userProfileData)||void 0===m?void 0:m.LocationId};(0,s.useEffect)((function(){S.userProfileData&&W.setFieldsValue(S.userProfileData)}),[S.userProfileData]);var H=function(){var e={StartDate:W.getFieldValue(["firstTransport","Date"])?W.getFieldValue(["firstTransport","Date"]):null,EndDate:null};y?(e.DepartLocationId=y.FromLocationId,e.ArriveLocationId=y.ToLocationId):e=W.getFieldValue(["firstTransport","Direction"])&&"IN"===W.getFieldValue(["firstTransport","Direction"])?(0,a.Z)((0,a.Z)({},e),X):(0,a.Z)((0,a.Z)({},e),_),C((0,a.Z)((0,a.Z)({},e),{},{transportType:"first"})),U(!0)},J=function(){var e={StartDate:W.getFieldValue(["lastTransport","Date"])?W.getFieldValue(["lastTransport","Date"]):null,EndDate:null};k?(e.DepartLocationId=null===k||void 0===k?void 0:k.FromLocationId,e.ArriveLocationId=null===k||void 0===k?void 0:k.ToLocationId):e=W.getFieldValue(["lastTransport","Direction"])&&"IN"===W.getFieldValue(["lastTransport","Direction"])?(0,a.Z)((0,a.Z)({},e),X):(0,a.Z)((0,a.Z)({},e),_),C((0,a.Z)((0,a.Z)({},e),{},{transportType:"last"})),U(!0)},K=function(e){Y(null),L(null),"IN"===e?(W.setFieldValue(["lastTransport","Direction"],"OUT"),W.setFieldValue(["firstTransport","Description"],null),W.setFieldValue(["firstTransport","flightId"],null),W.setFieldValue(["lastTransport","Description"],null),W.setFieldValue(["lastTransport","flightId"],null)):(W.setFieldValue(["lastTransport","Direction"],"IN"),W.setFieldValue(["firstTransport","flightId"],null),W.setFieldValue(["firstTransport","Description"],null),W.setFieldValue(["lastTransport","flightId"],null),W.setFieldValue(["lastTransport","Description"],null))},Q=function(e,t){W.setFieldValue([t,"Date"],v()(e.EventDate)),W.setFieldValue([t,"Description"],"".concat(e.Code," ").concat(e.Description)),W.setFieldValue([t,"flightId"],e.Id)},$=(0,s.useMemo)((function(){var e,t,n;return[{type:"component",component:(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(l.Form.Item,{label:"First Transport",className:"col-span-12 mb-2",children:(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)(l.Form.Item,{name:["firstTransport","Date"],className:"mb-0 w-[130px]",rules:[{required:!0,message:"First Transport Date is required"}],children:(0,T.jsx)(c.Z,{showWeek:!0,onChange:function(e){W.setFieldValue("RoomId","")},className:"w-full"})}),(0,T.jsx)(l.Form.Item,{name:["firstTransport","Direction"],className:"mb-0 w-[70px]",rules:[{required:!0,message:"Direction is required"}],children:(0,T.jsx)(I.Z,{options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],className:"w-full",onChange:K})}),(0,T.jsx)(l.Form.Item,{noStyle:!0,name:["firstTransport","flightId"]}),(0,T.jsx)(l.Form.Item,{name:["firstTransport","Description"],className:"flex-1 mb-0",children:(0,T.jsx)(F.Z,{readOnly:!0})}),(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",shouldUpdate:function(e,t){var n,a,o,r;return(null===(n=e.firstTransport)||void 0===n?void 0:n.Date)!==(null===(a=t.firstTransport)||void 0===a?void 0:a.Date)||(null===(o=e.firstTransport)||void 0===o?void 0:o.Direction)!==(null===(r=t.firstTransport)||void 0===r?void 0:r.Direction)},children:function(e){var t=e.getFieldValue;return(0,T.jsx)(l.Button,{className:"text-xs py-[5px]",type:"primary",onClick:H,disabled:!t(["firstTransport","Date"])||!t(["firstTransport","Direction"]),children:"..."})}}),(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){var n,a,o,r;return(null===(n=e.firstTransport)||void 0===n?void 0:n.Date)!==(null===(a=t.firstTransport)||void 0===a?void 0:a.Date)||(null===(o=e.firstTransport)||void 0===o?void 0:o.Direction)!==(null===(r=t.firstTransport)||void 0===r?void 0:r.Direction)},children:function(e){var t=e.getFieldValue,n={eventDate:t(["firstTransport","Date"]),direction:t(["firstTransport","Direction"])},a=!t(["firstTransport","Date"])||!t(["firstTransport","Direction"]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",children:(0,T.jsx)(l.ButtonDrive,{onRecieve:Q,searchValues:n,className:"py-[5px]",name:"firstTransport",disabled:a})}),(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",children:(0,T.jsx)(l.ButtonDrive,{onRecieve:Q,searchValues:n,name:"firstTransport",className:"py-[5px]",disabled:a,mode:"evening"})})]})}}),(0,T.jsx)(l.Form.Item,{name:["firstTransport","GoShow"],className:"mb-0",valuePropName:"checked",getValueFromEvent:function(e){var t;return null!==(t=e.target)&&void 0!==t&&t.checked?1:0},children:(0,T.jsx)(j.Z,{children:"Go Show"})})]})})})},{type:"component",component:(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(l.Form.Item,{label:"Last Transport",className:"col-span-12 mb-2",children:(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){var n,a;return(null===(n=e.firstTransport)||void 0===n?void 0:n.Date)!==(null===(a=t.firstTransport)||void 0===a?void 0:a.Date)},children:function(e){var t=e.getFieldValue,n=!1;return t(["lastTransport","Date"])||(n=t(["firstTransport","Date"])),(0,T.jsx)(l.Form.Item,{name:["lastTransport","Date"],className:"mb-0 w-[130px]",rules:[{required:!0,message:"Last Transport Date is required"}],children:(0,T.jsx)(c.Z,{defaultPickerValue:n,showWeek:!0,onChange:function(e){W.setFieldValue("RoomId","")},className:"w-full"})})}}),(0,T.jsx)(l.Form.Item,{name:["lastTransport","Direction"],className:"mb-0 w-[70px]",children:(0,T.jsx)(I.Z,{disabled:!0,options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],className:"w-full"})}),(0,T.jsx)(l.Form.Item,{noStyle:!0,name:["lastTransport","flightId"]}),(0,T.jsx)(l.Form.Item,{name:["lastTransport","Description"],className:"flex-1 mb-0",children:(0,T.jsx)(F.Z,{readOnly:!0})}),(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",shouldUpdate:function(e,t){var n,a,o,r;return(null===(n=e.lastTransport)||void 0===n?void 0:n.Date)!==(null===(a=t.lastTransport)||void 0===a?void 0:a.Date)||(null===(o=e.lastTransport)||void 0===o?void 0:o.Direction)!==(null===(r=t.lastTransport)||void 0===r?void 0:r.Direction)},children:function(e){var t=e.getFieldValue;return(0,T.jsx)(l.Button,{className:"text-xs py-[5px]",type:"primary",onClick:J,disabled:!t(["lastTransport","Date"])||!t(["lastTransport","Direction"]),children:"..."})}}),(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){var n,a,o,r;return(null===(n=e.lastTransport)||void 0===n?void 0:n.Date)!==(null===(a=t.lastTransport)||void 0===a?void 0:a.Date)||(null===(o=e.lastTransport)||void 0===o?void 0:o.Direction)!==(null===(r=t.lastTransport)||void 0===r?void 0:r.Direction)},children:function(e){var t=e.getFieldValue,n={eventDate:t(["lastTransport","Date"]),direction:t(["lastTransport","Direction"])},a=!t(["lastTransport","Date"])||!t(["lastTransport","Direction"]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",children:(0,T.jsx)(l.ButtonDrive,{onRecieve:Q,searchValues:n,className:"py-[5px]",name:"lastTransport",disabled:a})}),(0,T.jsx)(l.Form.Item,{className:"col-span-1 mb-0",children:(0,T.jsx)(l.ButtonDrive,{onRecieve:Q,searchValues:n,name:"lastTransport",className:"py-[5px]",disabled:a,mode:"evening"})})]})}}),(0,T.jsx)(l.Form.Item,{name:["lastTransport","GoShow"],className:"mb-0",valuePropName:"checked",getValueFromEvent:function(e){var t;return null!==(t=e.target)&&void 0!==t&&t.checked?1:0},children:(0,T.jsx)(j.Z,{children:"Go Show"})})]})})})},{type:"component",component:(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){var n,a,o,r,l,s;return(null===(n=e.firstTransport)||void 0===n?void 0:n.Direction)!==(null===(a=t.firstTransport)||void 0===a?void 0:a.Direction)||(null===(o=e.firstTransport)||void 0===o?void 0:o.Date)!==(null===(r=t.firstTransport)||void 0===r?void 0:r.Date)||(null===(l=e.lastTransport)||void 0===l?void 0:l.Date)!==(null===(s=t.lastTransport)||void 0===s?void 0:s.Date)},children:function(e){var t,n,a=e.getFieldValue,o=(e.setFieldValue,a(["firstTransport","Direction"])),r=a(["firstTransport","Date"]),l=a(["lastTransport","Date"]),s="IN"===o&&r&&l;s&&W.setFieldValue("RoomId",null===(n=S.userProfileData)||void 0===n?void 0:n.RoomId);return s&&(0,T.jsx)(V,{label:"Room Number",name:"RoomId",className:"col-span-12 mb-2",startDate:v()(r).format("YYYY-MM-DD"),endDate:v()(l).format("YYYY-MM-DD"),form:W,rules:[{required:!0,message:"Room is required"}],inputprops:{options:null===(t=S.referData)||void 0===t?void 0:t.rooms}})}})},{type:"component",component:(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){var n,a;return(null===(n=e.firstTransport)||void 0===n?void 0:n.Direction)!==(null===(a=t.firstTransport)||void 0===a?void 0:a.Direction)},children:function(e){var t,n,a=e.getFieldValue;e.setFieldValue;return"OUT"===a(["firstTransport","Direction"])?(0,T.jsx)(l.Form.Item,{label:"Shift",name:"ShiftId",className:"col-span-12 mb-2",rules:[{required:!0,message:"Shift is required"}],children:(0,T.jsx)(I.Z,{options:null===(t=S.referData)||void 0===t?void 0:t.roomStatuses.filter((function(e){return 0===e.OnSite})),className:"w-full",allowClear:!0,showSearch:!0,filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())}})}):(0,T.jsx)(l.Form.Item,{label:"Shift",name:"ShiftId",className:"col-span-12 mb-2",rules:[{required:!0,message:"Shift is required"}],children:(0,T.jsx)(I.Z,{options:null===(n=S.referData)||void 0===n?void 0:n.roomStatuses.filter((function(e){return 1===e.OnSite})),className:"w-full",allowClear:!0,showSearch:!0,filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())}})})}})},{label:"Department",name:"DepartmentId",className:"col-span-12 mb-2",type:"treeSelect",rules:[{required:!0,message:"Department is required"}],inputprops:{treeData:null===(e=S.referData)||void 0===e?void 0:e.departments,fieldNames:{label:"Name",value:"Id",children:"ChildDepartments"},allowClear:!0,showSearch:!0,filterTreeNode:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.Name)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())}}},{label:"Position",name:"PositionId",className:"col-span-12 mb-2",type:"select",rules:[{required:!0,message:"Position is required"}],inputprops:{options:null===(t=S.referData)||void 0===t?void 0:t.positions}},{type:"component",component:(0,T.jsx)(l.Form.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.DepartmentId!==t.DepartmentId},children:function(e){var t,n=e.getFieldValue,a=e.setFieldValue,o=null===(t=S.referData.departments)||void 0===t?void 0:t.find((function(e){return e.Id===n("DepartmentId")}));return o&&o.CostCodeId&&a("CostCodeId",o.CostCodeId),(0,T.jsx)(l.Form.Item,{name:"CostCodeId",label:"CostCodeId",rules:[{required:!0,message:"Cost Code is required"}],className:"col-span-12 mb-2",children:(0,T.jsx)(I.Z,{options:S.referData.costCodes,allowClear:!0,showSearch:!0,filterOption:function(e,t){var n;return(null!==(n=null===t||void 0===t?void 0:t.label)&&void 0!==n?n:"").toLowerCase().includes(e.toLowerCase())}})})}})},{label:"Employer",name:"EmployerId",className:"col-span-12 mb-2",type:"select",rules:[{required:!0,message:"Employer is required"}],inputprops:{options:null===(n=S.referData)||void 0===n?void 0:n.employers}}]}),[S]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Form,{form:W,fields:$,onFinish:function(e){A(!0);var t="IN"===e.firstTransport.Direction?{inScheduleId:e.firstTransport.flightId,inScheduleGoShow:e.firstTransport.GoShow,outScheduleId:e.lastTransport.flightId,outScheduleGoShow:e.lastTransport.GoShow}:{inScheduleId:e.lastTransport.flightId,inScheduleGoShow:e.lastTransport.GoShow,outScheduleId:e.firstTransport.flightId,outScheduleGoShow:e.firstTransport.GoShow};(0,r.Z)({method:"post",url:"tas/transport/addtravel",data:(0,a.Z)((0,a.Z)({},t),{},{employeeId:parseInt(h),roomId:e.RoomId,shiftId:e.ShiftId,departmentId:e.DepartmentId,positionId:e.PositionId,employerId:e.EmployerId,costCodeId:e.CostCodeId})}).then((function(e){p(),f(),W.resetFields()})).catch((function(e){})).then((function(){return A(!1)}))},labelCol:{flex:"120px"},wrapperCol:{flex:1},children:(0,T.jsxs)("div",{className:"col-span-12 gap-3 flex justify-end mt-3",children:[(0,T.jsx)(l.Button,{type:"primary",onClick:function(){return W.submit()},loading:G,children:"Create"}),(0,T.jsx)(l.Button,{onClick:p,children:"Cancel"})]})}),(0,T.jsx)(l.Modal,{title:"Select Transport",open:O,zIndex:1100,width:900,onCancel:function(){return U(!1)},destroyOnClose:!1,children:(0,T.jsx)(l.TransportSearch,{initialSearchValues:N,handleSelect:function(e){"first"===N.transportType?(Y(e),W.setFieldValue(["firstTransport","Date"],v()(e.EventDate)),W.setFieldValue(["firstTransport","Description"],"".concat(e.Code," ").concat(e.Description," ").concat(e.TransportMode)),W.setFieldValue(["firstTransport","flightId"],e.Id),U(!1)):(L(e),W.setFieldValue(["lastTransport","Date"],v()(e.EventDate)),W.setFieldValue(["lastTransport","Description"],"".concat(e.Code," ").concat(e.Description," ").concat(e.TransportMode)),W.setFieldValue(["lastTransport","flightId"],e.Id),U(!1))}})})]})},R=n(76629);var E=function(){var e,t=(0,s.useState)([]),n=(0,o.Z)(t,2),h=n[0],x=n[1],I=(0,s.useState)(!1),F=(0,o.Z)(I,2),j=F[0],C=F[1],w=(0,s.useState)(v()().startOf("month")),Z=(0,o.Z)(w,2),y=Z[0],V=Z[1],E=(0,s.useState)(!1),k=(0,o.Z)(E,2),L=k[0],M=k[1],q=(0,s.useState)("normal"),O=(0,o.Z)(q,2),U=O[0],P=O[1],B=(0,s.useState)(null),G=(0,o.Z)(B,2),A=G[0],z=G[1],W=(0,s.useState)(null),X=(0,o.Z)(W,2),_=X[0],H=X[1],J=(0,s.useState)(!1),K=(0,o.Z)(J,2),Q=K[0],$=K[1],ee=(0,s.useState)(!1),te=(0,o.Z)(ee,2),ne=te[0],ae=te[1],oe=(0,s.useState)(!1),re=(0,o.Z)(oe,2),le=re[0],se=re[1],ie=(0,s.useState)(!1),de=(0,o.Z)(ie,2),ce=de[0],ue=de[1],me=(0,s.useContext)(D.V),pe=me.state,fe=me.action,he=i.Z.useForm(),ve=(0,o.Z)(he,1)[0],De=(0,f.UO)().employeeId;(0,s.useEffect)((function(){xe(),R.Z.set("pp_rt","flight")}),[]);var xe=function(){C(!0),(0,r.Z)({method:"get",url:"tas/transport/all/".concat(De,"/").concat(v()(y).format("YYYY-MM-DD"))}).then((function(e){x(e.data.map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{label:v()(e.EventDate).format("YYYY-MM-DD")})})))})).catch((function(e){})).then((function(){return C(!1)}))},Ie=function(){(0,r.Z)({method:"get",url:"tas/employee/".concat(De)}).then((function(e){fe.saveUserProfileData(e.data)})).catch((function(e){}))},Fe=[{label:"Date",name:"EventDate",cellRender:function(e){return(0,T.jsx)("div",{children:v()(e.data.EventDate).format("YYYY-MM-DD ddd")})}},{label:"Transport Mode",name:"TransportMode"},{label:"Code",name:"Code"},{label:"Description",name:"Description"},{label:"Direction",name:"Direction",cellRender:function(e){var t,n=e.value;return(0,T.jsx)(d.Z,{className:"text-xs",color:null===(t=b.Z.Directions[n])||void 0===t?void 0:t.tagColor,children:n})}},{label:"Status",name:"Status",cellRender:function(e){return(0,T.jsx)(d.Z,{color:"Confirmed"===e.value?"success":"orange",className:"text-xs",children:e.value})}},{label:"Reschedule",name:"",alignment:"center",cellRender:function(e){return(0,T.jsx)("button",{type:"button",onClick:function(){return t=e.data,fe.setFlightCalendarDate(v()(t.EventDate).format("YYYY-MM-DD")),H(t),void $(!0);var t},className:"hover:bg-slate-200 p-[2px] rounded ",children:(0,T.jsx)(u.Z,{style:{fontSize:"18px"}})})}},{label:"",name:"action",width:"90px",alignment:"left",cellRender:function(e){return(0,T.jsx)("button",{type:"button",className:"dlt-button",onClick:function(){return function(e,t){z((0,a.Z)((0,a.Z)({},e),{},{rowIndex:t.rowIndex})),"EXTERNAL"===e.Direction?ue(!0):(P("EXTERNAL"===e.Direction?"externalRemove":"remove"),ae(!0))}(e.data,e)},children:"Remove"})}}],je=function(){xe(),Ie(),P("normal")},Te=function(){ae(!1)};return(0,T.jsxs)("div",{className:"bg-white rounded-ot px-3 pb-0 col-span-12 shadow-md",children:[(0,T.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,T.jsx)("div",{className:"text-lg font-bold",children:"Existing Transports"}),(0,T.jsxs)("div",{className:"flex gap-5",children:[(0,T.jsx)(c.Z,{value:y,onChange:function(e){return V(e)}}),(0,T.jsx)(l.Button,{onClick:function(){C(!0),(0,r.Z)({method:"get",url:"tas/transport/all/".concat(De,"/").concat(v()(y).format("YYYY-MM-DD"))}).then((function(e){x(e.data)})).catch((function(e){})).then((function(){return C(!1)}))},icon:(0,T.jsx)(m.Z,{}),disabled:!y,children:"Search"}),null!==(e=pe.userInfo)&&void 0!==e&&e.ReadonlyAccess?null:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.Button,{onClick:function(){return se(!0)},icon:(0,T.jsx)(p.Z,{}),children:"Add External"}),(0,T.jsx)(l.Button,{onClick:function(){P("add"),ae(!0)},icon:(0,T.jsx)(p.Z,{}),children:"Add"})]})]})]}),(0,T.jsx)(l.Table,{data:h,columns:Fe,allowColumnReordering:!1,loading:j,containerClass:"shadow-none border-t rounded-none",tableClass:"max-h-[calc(100vh-630px)]",keyExpr:"EventDate",pager:{showPageSizeSelector:(null===h||void 0===h?void 0:h.length)>100}}),(0,T.jsx)(l.Modal,{title:"add"===U?"Add Booking":"Remove Booking",open:ne,onCancel:Te,width:800,destroyOnClose:!0,children:function(){switch(U){case"add":return(0,T.jsx)(Y,{onCancel:Te,refresh:je,employeeId:De});case"remove":return(0,T.jsx)(S,{data:(0,a.Z)({},pe.userProfileData),editData:A,refreshData:xe,handleCancel:Te,flights:h})}}()}),(0,T.jsx)(l.Modal,{title:"Reschedule Existing Transport",open:Q,onCancel:function(){$(!1),ve.resetFields()},width:800,destroyOnClose:!0,zIndex:1100,children:"EXTERNAL"===(null===_||void 0===_?void 0:_.Direction)?(0,T.jsx)(l.ExternalReSchedule,{data:_,onCancel:function(){return $(!1)},refreshData:je}):(0,T.jsx)(g,{data:_,handleShowModal:$,refreshData:je,reScheduleForm:ve})}),(0,T.jsx)(l.Modal,{width:800,title:"Add External Transport",open:le,onCancel:function(){return se(!1)},children:(0,T.jsx)(l.ExternalTransport,{employeeId:De,refreshData:je,onCancel:function(){return se(!1)}})}),(0,T.jsx)(N.GI,{visible:ce,showTitle:!1,height:"auto",width:350,children:(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{children:"Are you sure you want to remove this transport?"}),(0,T.jsxs)("div",{className:"flex gap-5 mt-3 justify-center",children:[(0,T.jsx)(l.Button,{type:"danger",onClick:function(){M(!0),(0,r.Z)({method:"delete",url:"tas/transport/removeexternaltransport",data:{transportId:A.Id}}).then((function(e){P("normal"),xe(),Ie(),ue(!1)})).catch((function(e){})).finally((function(){M(!1)}))},loading:L,children:"Yes"}),(0,T.jsx)(l.Button,{onClick:function(){return ue(!1)},disabled:L,children:"No"})]})]})})]})}}}]);