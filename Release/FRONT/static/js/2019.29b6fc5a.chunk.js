"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[2019],{42019:function(e,n,t){t.r(n);var o=t(1413),i=t(29439),l=t(56573),s=t(47313),r=t(58467),a=t(42614),u=t(65040),d=t(21975),c=t(2880),m=t(53979),p=t(14261),v=t(8251),f=t(10202),h=t(82241),g=t(46417);n.default=function(){var e,n=(0,s.useState)(null),t=(0,i.Z)(n,2),x=t[0],j=t[1],y=(0,s.useState)(!0),C=(0,i.Z)(y,2),b=C[0],I=C[1],Z=(0,s.useState)(null),A=(0,i.Z)(Z,2),N=A[0],q=A[1],w=(0,s.useState)(!1),D=(0,i.Z)(w,2),k=D[0],S=D[1],F=(0,s.useState)([]),R=(0,i.Z)(F,2),T=R[0],B=R[1],E=(0,s.useState)([]),G=(0,i.Z)(E,2),M=(G[0],G[1],(0,s.useState)([])),V=(0,i.Z)(M,2),U=V[0],z=V[1],L=(0,s.useState)([]),P=(0,i.Z)(L,2),_=(P[0],P[1],(0,s.useState)(null)),Y=(0,i.Z)(_,2),H=Y[0],O=Y[1],W=(0,s.useState)(null),J=(0,i.Z)(W,2),K=J[0],Q=J[1],X=(0,s.useState)(!1),$=(0,i.Z)(X,2),ee=$[0],ne=$[1],te=(0,s.useState)(!1),oe=(0,i.Z)(te,2),ie=oe[0],le=oe[1],se=(0,s.useState)(null),re=(0,i.Z)(se,2),ae=re[0],ue=re[1],de=(0,s.useState)(!1),ce=(0,i.Z)(de,2),me=ce[0],pe=ce[1],ve=(0,s.useState)(null),fe=(0,i.Z)(ve,2),he=fe[0],ge=fe[1],xe=(0,r.UO)().documentId,je=(0,h.Z)(),ye=(0,s.useContext)(a.V),Ce=ye.state,be=ye.action,Ie=u.Z.useForm(),Ze=(0,i.Z)(Ie,1)[0],Ae=u.Z.useForm(),Ne=(0,i.Z)(Ae,1)[0],qe="requestDocumentDetail_".concat(xe),we=(0,r.s0)();(0,s.useEffect)((function(){return Ce.connectionMultiViewer&&Ce.userInfo&&(De(),Ce.connectionMultiViewer.on("UsersInScreen",(function(e,n){var t=n.map((function(e){return{name:e.userName.split("_")[0],role:e.userName.split("_")[1],color:(0,f.Z)()}}));be.setMultiViewers(t.filter((function(e){var n,t;return e.name!=="".concat(null===(n=Ce.userInfo)||void 0===n?void 0:n.Firstname," ").concat(null===(t=Ce.userInfo)||void 0===t?void 0:t.Lastname)})))}))),function(){Ce.connectionMultiViewer&&ke()}}),[Ce.connectionMultiViewer,Ce.userInfo]),(0,s.useEffect)((function(){xe&&(I(!0),be.changeMenuKey("/request/task"),l.Z.all(["tas/requestdemobilisation/".concat(xe),"tas/requestdocumenthistory/".concat(xe),"tas/requestdemobilisationtype?active=1","tas/requestdocument/myinfo","tas/requestgroupconfig/documentroute/".concat(xe),"/tas/requestgroupconfig/groupandmembers/".concat(xe)].map((function(e){return l.Z.get(e)}))).then(l.Z.spread((function(e,n,t,o,i,l){e.data&&(Se(e.data.EmployeeId),j(e.data)),z(n.data),B(t.data),ue(o.data),Fe(i.data,l.data)}))).catch((function(){})).finally((function(){return I(!1)})))}),[xe]);var De=function(){try{var e,n,t,o;null===(e=Ce.connectionMultiViewer)||void 0===e||e.invoke("JoinScreen","".concat(null===(n=Ce.userInfo)||void 0===n?void 0:n.Firstname," ").concat(null===(t=Ce.userInfo)||void 0===t?void 0:t.Lastname,"_").concat(null===(o=Ce.userInfo)||void 0===o?void 0:o.Role),qe)}catch(i){}},ke=function(){var e,n,t,o;be.setMultiViewers([]),null===(e=Ce.connectionMultiViewer)||void 0===e||e.invoke("LeaveScreen","".concat(null===(n=Ce.userInfo)||void 0===n?void 0:n.Firstname," ").concat(null===(t=Ce.userInfo)||void 0===t?void 0:t.Lastname,"_").concat(null===(o=Ce.userInfo)||void 0===o?void 0:o.Role),qe)},Se=function(e){(0,l.Z)({method:"get",url:"tas/employee/profile/".concat(e)}).then((function(e){be.saveUserProfileData(e.data),ge(e.data)})).catch((function(e){}))},Fe=function(e,n){var t=null===e||void 0===e?void 0:e.find((function(e){return 1===e.CurrentPosition}));if(Q(t),"Requester"===(null===t||void 0===t?void 0:t.GroupTag)){var o=null===e||void 0===e?void 0:e.findIndex((function(e){return 1===(null===e||void 0===e?void 0:e.CurrentPosition)})),i=e[o+1],l=null===n||void 0===n?void 0:n.find((function(e){return e.id===(null===i||void 0===i?void 0:i.GroupId)}));if(l){var s=[];l.groupMembers.map((function(e){s.push({value:e.employeeId,label:e.fullName})})),Ze.setFieldValue("nextGroupName",null===l||void 0===l?void 0:l.GroupName),Ze.setFieldValue("nextGroupId",null===l||void 0===l?void 0:l.id),Ze.setFieldValue("assignEmployeeOptions",s)}O(l)}else O({GroupTag:"complete"})},Re=function(e){pe(!0),"Approve"===N?(0,l.Z)({method:"put",url:"tas/requestdocument/approve",data:{id:xe,assignEmployeeId:e.assignedEmployeeId,nextGroupId:e.nextGroupId,comment:e.comment,impersonateUserId:je.get("impersonateuser")}}).then((function(e){S(!1),je.get("impersonateuser")?we("/request/impersonateuser/".concat(je.get("impersonateuser"))):we("/request/task")})).catch((function(e){})).then((function(){return pe(!1)})):"Cancel"===N?(0,l.Z)({method:"put",url:"tas/requestdocument/cancel",data:{id:xe,comment:e.comment,impersonateUserId:je.get("impersonateuser")}}).then((function(e){S(!1),je.get("impersonateuser")?we("/request/impersonateuser/".concat(je.get("impersonateuser"))):we("/request/task")})).catch((function(e){})).then((function(){return pe(!1)})):"Decline"===N?(0,l.Z)({method:"put",url:"tas/requestdocument/decline",data:{id:xe,assignEmployeeId:e.assignedEmployeeId,comment:e.comment,impersonateUserId:je.get("impersonateuser")}}).then((function(e){S(!1),je.get("impersonateuser")?we("/request/impersonateuser/".concat(je.get("impersonateuser"))):we("/request/task")})).catch((function(e){})).then((function(){return pe(!1)})):"Complete"===N&&(0,l.Z)({method:"put",url:"tas/requestdemobilisation/complete/".concat(xe),data:{id:xe,comment:e.comment,impersonateUserId:je.get("impersonateuser")}}).then((function(e){S(!1),je.get("impersonateuser")?we("/request/impersonateuser/".concat(je.get("impersonateuser"))):we("/request/task")})).catch((function(e){})).then((function(){return pe(!1)}))},Te=[{label:"Date of Completion",name:"CompletionDate",className:"col-span-12 mb-0",type:"date"},{label:"De-Mobilisation Type",name:"RequestDeMobilisationTypeId",className:"col-span-12 mb-0",type:"select",inputprops:{options:T.map((function(e){return{label:"".concat(e.Code," ").concat(e.Description),value:e.Id}}))}},{label:"Employer",name:"EmployerId",className:"col-span-12 mb-0",type:"select",inputprops:{options:null===(e=Ce.referData)||void 0===e?void 0:e.employers}},{label:"Comments",name:"comment",className:"col-span-12 mb-0",type:"textarea"}],Be=function(e){q(e),"Approve"===e||"Complete"===e||"Decline"===e?Ze.submit():S(!0)},Ee=(0,s.useMemo)((function(){return v.Z.getActionPermission({documentData:x,userData:ae,groupTag:null===K||void 0===K?void 0:K.GroupTag,userGroupIds:null===ae||void 0===ae?void 0:ae.ApprovalGroupIds})}),[x,ae,K]);return(0,g.jsx)("div",{children:b?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"animate-skeleton h-[230px] flex rounded-ot mb-5 shadow-md"}),(0,g.jsx)("div",{className:"animate-skeleton h-[400px] flex rounded-ot shadow-md"})]}):(0,g.jsxs)("div",{className:"grid grid-cols-12 gap-3 relative",children:[(0,g.jsx)(c.RequestDocumentHeader,{profileData:he,documentDetail:x}),(0,g.jsx)(c.Accordion,{className:"col-span-12 shadow-md rounded-ot overflow-hidden",title:"Travel Calendar",children:(0,g.jsx)("div",{className:"p-4",children:(0,g.jsx)(c.ProfileCalendar,{profile:he})})}),(0,g.jsx)(c.Accordion,{className:"col-span-6 shadow-md rounded-ot overflow-hidden",title:"Detail",children:(0,g.jsx)(c.Form,{editData:null===x||void 0===x?void 0:x.info,fields:Te,form:Ne,className:"grid grid-cols-12 gap-y-2 p-4",size:"small",disabled:!ee,onFinish:function(e){var n;le(!0),(0,l.Z)({method:"put",url:"tas/requestdemobilisation",data:(0,o.Z)((0,o.Z)({},e),{},{id:null===x||void 0===x||null===(n=x.info)||void 0===n?void 0:n.Id})}).then((function(e){ne(!1),I(!0),(0,l.Z)({method:"get",url:"tas/requestdemobilisation/".concat(xe)}).then((function(e){j(e.data)})).catch((function(e){})).then((function(){return I(!1)})),(0,l.Z)({method:"get",url:"tas/requestdocumenthistory/".concat(xe)}).then((function(e){z(e.data)})).catch((function(e){}))})).catch((function(e){})).then((function(){return le(!1)}))},children:(0,g.jsx)("div",{className:"col-span-12 mt-3 flex justify-end",children:Ee?ee?(0,g.jsxs)("div",{className:"flex items-center gap-3",children:[(0,g.jsx)(c.Button,{type:"primary",loading:ie,onClick:function(){return Ne.submit()},icon:(0,g.jsx)(m.Z,{}),children:"Save"}),(0,g.jsx)(c.Button,{onClick:function(){return ne(!1)},disabled:ie,children:"Cancel"})]}):(0,g.jsx)(c.Button,{onClick:function(){return ne(!0)},children:"Edit"}):null})})}),Ee?(0,g.jsx)(c.Form,{className:"grid grid-cols-12 gap-y-5 col-span-6",size:"small",form:Ze,labelWrap:!0,onFinish:Re,children:(0,g.jsx)(c.Accordion,{title:"Request Document",className:"col-span-12 shadow-md rounded-ot overflow-hidden",children:(0,g.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,g.jsxs)("div",{children:["Comments:",(0,g.jsx)(c.Form.Item,{className:"m-0",name:"comment",children:(0,g.jsx)(d.Z.TextArea,{autoSize:{minRows:3,maxRows:5},maxLength:300,showCount:!0})})]}),(0,g.jsx)("div",{className:"flex items-center gap-3 justify-end",children:(0,g.jsx)(c.Form.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.comment!==n.comment},children:function(e){var n=e.getFieldValue,t=!Boolean(n("comment"));return function(e,n){return e?"complete"!==e?(0,g.jsx)(g.Fragment,{children:"Requester"===(null===K||void 0===K?void 0:K.GroupTag)?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(c.Button,{htmlType:"button",type:"success",onClick:function(){return Be("Approve")},disabled:me,loading:me&&"Approve"===N,children:"Approve"}),(0,g.jsx)(c.Button,{htmlType:"button",type:"danger",onClick:function(){return Be("Cancel")},disabled:me,children:"Cancel Request"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(c.Button,{htmlType:"button",type:"success",onClick:function(){return Be("Approve")},disabled:me,loading:me&&"Approve"===N,children:"Approve"}),(0,g.jsx)(c.Button,{htmlType:"button",type:"danger",onClick:function(){return Be("Cancel")},disabled:me,children:"Cancel Request"}),(0,g.jsx)(c.Tooltip,{title:n?"Please fill comment field!":"",children:(0,g.jsx)("div",{children:(0,g.jsx)(c.Button,{htmlType:"button",onClick:function(){return Be("Decline")},disabled:n||me,loading:me&&"Decline"===N,children:"Decline"})})})]})}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(c.Button,{htmlType:"button",type:"success",onClick:function(){return Be("Complete")},disabled:me,loading:me&&"Complete"===N,children:"Complete"}),(0,g.jsx)(c.Button,{htmlType:"button",type:"danger",onClick:function(){return Be("Cancel")},disabled:me,children:"Cancel Request"}),(0,g.jsx)(c.Tooltip,{title:n?"Please fill comment field!":"",children:(0,g.jsx)("div",{children:(0,g.jsx)(c.Button,{htmlType:"button",onClick:function(){return Be("Decline")},disabled:n||me,loading:me&&"Decline"===N,children:"Decline"})})})]}):null}(null===H||void 0===H?void 0:H.GroupTag,t)}})})]})})}):(null===ae||void 0===ae?void 0:ae.EmployeeId)===(null===x||void 0===x?void 0:x.RequestUserId)&&"Completed"!==(null===x||void 0===x?void 0:x.CurrentStatus)?(0,g.jsx)(c.Form,{className:"grid grid-cols-12 gap-y-5 col-span-6",size:"small",form:Ze,labelWrap:!0,onFinish:Re,children:(0,g.jsx)(c.Accordion,{title:"Request Document",className:"col-span-12 shadow-md rounded-ot overflow-hidden",children:(0,g.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,g.jsxs)("div",{children:["Comments:",(0,g.jsx)(c.Form.Item,{className:"m-0",name:"comment",children:(0,g.jsx)(d.Z.TextArea,{autoSize:{minRows:3,maxRows:5},maxLength:300,showCount:!0})})]}),(0,g.jsx)("div",{className:"flex items-center gap-3 justify-end",children:(0,g.jsx)(c.Button,{htmlType:"button",type:"danger",onClick:function(){return Be("Cancel")},disabled:me,children:"Cancel Request"})})]})})}):null,(0,g.jsx)(c.Accordion,{title:"Document History & Comments, Document Route",defaultOpen:!1,className:"col-span-12 shadow-md rounded-ot overflow-hidden",children:(0,g.jsx)("div",{className:"grid grid-cols-12 items-start gap-4 p-4 pl-10",children:(0,g.jsx)(c.DocumentTimeline,{data:U})})}),(0,g.jsx)(p.GI,{visible:k,showTitle:!1,height:120,width:350,children:(0,g.jsx)("div",{children:function(e){switch(e){case"Approve":return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{children:"Are you sure you want to approve this request?"}),(0,g.jsxs)("div",{className:"flex gap-5 mt-4 justify-center",children:[(0,g.jsx)(c.Button,{type:"success",onClick:function(){return Ze.submit()},loading:me,children:"Yes"}),(0,g.jsx)(c.Button,{onClick:function(){return S(!1)},disabled:me,children:"No"})]})]});case"Cancel":return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{children:"Are you sure you want to cancel this request?"}),(0,g.jsxs)("div",{className:"flex gap-5 mt-4 justify-center",children:[(0,g.jsx)(c.Button,{type:"danger",onClick:function(){return Ze.submit()},loading:me,children:"Yes"}),(0,g.jsx)(c.Button,{onClick:function(){return S(!1)},disabled:me,children:"No"})]})]});case"Save":return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{children:"Are you sure you want to save this request?"}),(0,g.jsxs)("div",{className:"flex gap-5 mt-4 justify-center",children:[(0,g.jsx)(c.Button,{type:"primary",onClick:function(){return Ze.submit()},loading:me,children:"Yes"}),(0,g.jsx)(c.Button,{onClick:function(){return S(!1)},disabled:me,children:"No"})]})]});case"Decline":return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{children:"Are you sure you want to decline this request?"}),(0,g.jsxs)("div",{className:"flex gap-5 mt-4 justify-center",children:[(0,g.jsx)(c.Button,{onClick:function(){return Ze.submit()},loading:me,children:"Yes"}),(0,g.jsx)(c.Button,{onClick:function(){return S(!1)},disabled:me,children:"No"})]})]});case"Complete":return(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{children:"Are you sure you want to complete this document?"}),(0,g.jsxs)("div",{className:"flex gap-5 mt-4 justify-center",children:[(0,g.jsx)(c.Button,{type:"success",onClick:function(){return Ze.submit()},loading:me,children:"Yes"}),(0,g.jsx)(c.Button,{onClick:function(){return S(!1)},disabled:me,children:"No"})]})]})}}(N)})})]})})}},8251:function(e,n){var t={getDisabledStatus:function(e){var n,t,o=e.documentData,i=e.userData,l=e.groupTag;e.userGroupIds;return console.log("hello",o,i,l),"Completed"===l||"Cancelled"===l||(null!==o&&void 0!==o&&o.AssignedEmployeeId?!(null!==i&&void 0!==i&&null!==(n=i.LineManagerIds)&&void 0!==n&&n.includes(null===o||void 0===o?void 0:o.AssignedEmployeeId)||(null===o||void 0===o?void 0:o.AssignedEmployeeId)===(null===i||void 0===i?void 0:i.EmployeeId)||"Data Approval"===(null===i||void 0===i?void 0:i.Rolename)&&"linemanager"===l||"SystemAdministrator"===(null===i||void 0===i?void 0:i.Rolename)):!("SystemAdministrator"===(null===i||void 0===i?void 0:i.Rolename)||null!==i&&void 0!==i&&null!==(t=i.ApprovalGroupIds)&&void 0!==t&&t.includes(null===o||void 0===o?void 0:o.AssignedRouteConfigId)))},getActionPermission:function(e){var n,t,o=e.documentData,i=e.userData,l=e.groupTag,s=(e.userGroupIds,null);"Completed"===(null===o||void 0===o?void 0:o.CurrentStatus)||"Cancelled"===(null===o||void 0===o?void 0:o.CurrentStatus)?s=!1:s=null!==o&&void 0!==o&&o.AssignedEmployeeId?!!(null!==i&&void 0!==i&&null!==(n=i.LineManagerIds)&&void 0!==n&&n.includes(null===o||void 0===o?void 0:o.AssignedEmployeeId)||(null===o||void 0===o?void 0:o.AssignedEmployeeId)===(null===i||void 0===i?void 0:i.EmployeeId)||"Data Approval"===(null===i||void 0===i?void 0:i.Rolename)&&"linemanager"===l||"SystemAdministrator"===(null===i||void 0===i?void 0:i.Rolename)):!!("SystemAdministrator"===(null===i||void 0===i?void 0:i.Rolename)||null!==i&&void 0!==i&&null!==(t=i.ApprovalGroupIds)&&void 0!==t&&t.includes(null===o||void 0===o?void 0:o.AssignedRouteConfigId));return s},checkUpdateItinerary:function(e){var n,t=e.groupAndMembers,o=e.userData,i=!1,l=null===t||void 0===t?void 0:t.find((function(e){return"travelflight"===e.GroupTag}));return null!==o&&void 0!==o&&null!==(n=o.GroupIds)&&void 0!==n&&n.includes(null===l||void 0===l?void 0:l.GroupId)&&(i=!0),i}};n.Z=t},53979:function(e,n,t){t.d(n,{Z:function(){return a}});var o=t(87462),i=t(47313),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},s=t(17469),r=function(e,n){return i.createElement(s.Z,(0,o.Z)({},e,{ref:n,icon:l}))};var a=i.forwardRef(r)}}]);