"use strict";(self.webpackChunkot_tas=self.webpackChunkot_tas||[]).push([[2663],{12663:function(e,a,t){t.r(a),t.d(a,{default:function(){return Z}});var n=t(1413),l=t(29439),o=t(47313),r=t(2880),s=t(10658),d=t.n(s),i=t(56573),c=t(2135),m=t(42614),u=t(58922),p=t(46417),x=function(e){switch(e){case"full":return"bg-[#ebedf0] border-[#ebedf0]";case"available":return"bg-[#fadb14] border-[#fadb14]";case"empty":return"bg-[#00c75e] border-[#00c75e]";case"double":return" bg-[#ff5b5b] border-[#ff5b5b] text-white"}},v=o.memo((function(e){var a,t,n,l,o,r=e.event,s=e.index,i=e.currentDate,c=e.handleSelectDate,m=e.selectedDate,u=d()(i).date(s).format("YYYY-MM-DD"),v=r.value===(null===(a=r.data)||void 0===a||null===(t=a.OccupancyData[u])||void 0===t?void 0:t.BedCount)?"empty":r.value<(null===(n=r.data)||void 0===n||null===(l=n.OccupancyData[u])||void 0===l?void 0:l.BedCount)&&r.value>0?"available":r.value<0?"double":"full";return(0,p.jsxs)("div",{className:"relative rounded select-none cursor-pointer hover:border-slate-400 py-1 text-xs border ".concat(x(v)),onClick:function(e){return c(r.data.RoomId,u,r,v,e)},children:[(null===m||void 0===m?void 0:m.roomId)===(null===(o=r.data)||void 0===o?void 0:o.RoomId)&&(null===m||void 0===m?void 0:m.date)===u?(0,p.jsx)("div",{className:"absolute inset-0 border border-black rounded"}):"","empty"===v?(0,p.jsx)("span",{className:"select-none",children:"\xa0"}):r.value]})}),(function(e,a){return JSON.stringify(e.selectedDate)===JSON.stringify(a.selectedDate)})),h=t(45442),f=t(95585),b=t.n(f),g=t(2880).DepartmentTooltip,D=t(10658),j=t(26672),N=j.FaMale,y=j.FaFemale,w=t(2135).Link,Y=function(e){switch(e){case"ADD":return"addtravel";case"REMOVE":return"remove";case"RESCHEDULE":return"reschedule"}},S=[{label:"Person #",name:"Id",alignment:"left"},{label:"Fullname",name:"FullName",cellRender:function(e){var a;return(0,p.jsxs)("div",{className:"flex",children:[1===e.data.Gender?(0,p.jsx)(N,{size:14,className:"text-blue-600"}):(0,p.jsx)(y,{size:14,className:"text-pink-500"}),(0,p.jsx)("i",{className:"dx-icon-home text-green-500 mr-1"}),(0,p.jsx)(w,{to:"/tas/roomassign/".concat(null===(a=e.data)||void 0===a?void 0:a.EmployeeId,"/roombooking"),children:(0,p.jsx)("span",{className:"cursor-pointer text-blue-500 hover:underline whitespace-normal",children:e.value})})]})}},{label:"Department",name:"DepartmentName",cellRender:function(e){var a;return(0,p.jsx)(g,{id:null===(a=e.data)||void 0===a?void 0:a.DepartmentId,showStatus:!1,children:(0,p.jsx)("span",{className:" whitespace-normal",children:e.value})})}},{label:"People Type",name:"PeopleTypeCode"},{label:"Employer",name:"EmployerName",cellRender:function(e){return(0,p.jsx)("span",{className:" whitespace-normal",children:e.value})}},{label:"Shift",name:"ShiftCode",width:50},{label:"Start",name:"StartDate",width:"80px",cellRender:function(e){return(0,p.jsx)("div",{children:e.value?D(e.value).format("YYYY-MM-DD"):""})}},{label:"End",name:"EndDate",width:"80px",cellRender:function(e){return(0,p.jsx)("div",{children:e.value?D(e.value).format("YYYY-MM-DD"):""})}}],k=[{label:"Person #",name:"Id",alignment:"left"},{label:"Fullname",name:"FullName",cellRender:function(e){var a;return(0,p.jsxs)("div",{className:"flex",children:[1===e.data.Gender?(0,p.jsx)(N,{size:14,className:"text-blue-600"}):(0,p.jsx)(y,{size:14,className:"text-pink-500"}),e.data.RoomOwner?(0,p.jsx)("i",{className:"dx-icon-home text-green-500 mr-1"}):(0,p.jsx)("i",{className:"dx-icon-home text-gray-400 mr-1"}),(0,p.jsx)(w,{to:"/tas/roomassign/".concat(null===(a=e.data)||void 0===a?void 0:a.EmployeeId,"/roombooking"),children:(0,p.jsx)("span",{className:"cursor-pointer text-blue-500 hover:underline whitespace-normal",children:e.value})})]})}},{label:"Department",name:"DepartmentName",cellRender:function(e){var a;return(0,p.jsx)(g,{id:null===(a=e.data)||void 0===a?void 0:a.DepartmentId,showStatus:!1,children:(0,p.jsx)("span",{className:" whitespace-normal",children:e.value})})}},{label:"People Type",name:"PeopleTypeCode"},{label:"Employer",name:"EmployerName",cellRender:function(e){return(0,p.jsx)("span",{className:" whitespace-normal",children:e.value})}},{label:"Shift",name:"ShiftCode",width:50},{label:"Start",name:"StartDate",width:"80px",cellRender:function(e){return(0,p.jsx)("div",{children:e.value?D(e.value).format("YYYY-MM-DD"):""})}},{label:"End",name:"EndDate",width:"80px",cellRender:function(e){return(0,p.jsx)("div",{children:e.value?D(e.value).format("YYYY-MM-DD"):""})}},{label:"Document",name:"DocumentId",alignment:"left",cellRender:function(e){return(0,p.jsx)("div",{className:"flex items-center text-blue-500 hover:underline",children:(0,p.jsx)(w,{to:"/request/task/sitetravel/".concat(Y(e.data.DocumentTag),"/").concat(e.value),target:"_blank",children:e.value})})}}],R=[{label:"Person #",name:"Id",alignment:"left"},{label:"Fullname",name:"FullName",cellRender:function(e){var a;return(0,p.jsxs)("div",{className:"flex gap-1",children:[(0,p.jsxs)("div",{className:"flex",children:[1===e.data.Gender?(0,p.jsx)(N,{size:14,className:"text-blue-600"}):(0,p.jsx)(y,{size:14,className:"text-pink-500"}),e.data.RoomOwner?(0,p.jsx)("i",{className:"dx-icon-home text-green-500"}):(0,p.jsx)("i",{className:"dx-icon-home text-gray-400"})]}),(0,p.jsx)(w,{to:"/tas/roomassign/".concat(null===(a=e.data)||void 0===a?void 0:a.EmployeeId,"/roombooking"),children:(0,p.jsx)("span",{className:"cursor-pointer text-blue-500 hover:underline ml-1 whitespace-normal",children:e.value})})]})}},{label:"Department",name:"DepartmentName",cellRender:function(e){var a;return(0,p.jsx)(g,{id:null===(a=e.data)||void 0===a?void 0:a.DepartmentId,showStatus:!1,children:(0,p.jsx)("span",{className:" whitespace-normal",children:e.value})})}},{label:"People Type",name:"PeopleTypeCode"},{label:"Employer",name:"EmployerName",cellRender:function(e){return(0,p.jsx)("span",{className:" whitespace-normal",children:e.value})}},{label:"Shift",name:"ShiftCode",width:50},{label:"End",name:"EndDate",width:"80px",cellRender:function(e){return(0,p.jsx)("div",{children:e.value?D(e.value).format("YYYY-MM-DD"):""})}}],I=t(83313),C=t(73030),E=t(14261),M=o.memo((function(e){var a,t,n=e.open,s=e.handleCloseDrawer,d=e.selectedDate,c=e.store,m=(0,o.useState)(null),u=(0,l.Z)(m,2),x=u[0],v=u[1],h=(0,o.useState)([]),f=(0,l.Z)(h,2),b=f[0],g=f[1],D=(0,o.useState)(!1),j=(0,l.Z)(D,2),N=j[0],y=j[1],w=(0,o.useState)(0),Y=(0,l.Z)(w,2),M=Y[0],O=Y[1],Z=(0,o.useState)(0),F=(0,l.Z)(Z,2),P=F[0],T=F[1],z=(0,o.useState)(100),B=(0,l.Z)(z,2),V=B[0],L=B[1],A=(0,o.useState)(!1),G=(0,l.Z)(A,2),H=G[0],q=G[1],_=(0,o.useRef)(null);(0,o.useEffect)((function(){d&&(y(!0),(0,i.Z)({method:"post",url:"tas/room/ownerandlockdateprofile",data:{currentDate:d.date,roomId:null===d||void 0===d?void 0:d.roomId}}).then((function(e){v(e.data)})).catch((function(e){})).then((function(){return y(!1)})))}),[d]),(0,o.useEffect)((function(){d&&J()}),[d,P]);var J=function(){q(!0),(0,i.Z)({method:"post",url:"tas/room/dateprofile",data:{pageIndex:P+1,pageSize:V,model:{currentDate:d.date,roomId:null===d||void 0===d?void 0:d.roomId}}}).then((function(e){g(e.data.data),O(e.data.totalcount)})).catch((function(e){})).then((function(){return q(!1)}))},K=(0,o.useMemo)((function(){var e,a,t,n,l,o;return[null===(e=c.referData)||void 0===e||null===(a=e.noRoomId)||void 0===a?void 0:a.Id,null===(t=c.referData)||void 0===t||null===(n=t.noRoomId)||void 0===n?void 0:n.NoAccommdationId,null===(l=c.referData)||void 0===l||null===(o=l.noRoomId)||void 0===o?void 0:o.KhanbogdRoomId].includes(null===d||void 0===d?void 0:d.roomId)}),[c,d]);return(0,p.jsx)(I.Z,{title:(0,p.jsxs)("div",{className:"flex justify-between",children:[null===d||void 0===d?void 0:d.roomNumber," ",(0,p.jsx)("span",{className:"text-gray-400",children:null===d||void 0===d?void 0:d.date})]}),open:n,footer:!1,onClose:s,width:1e3,destroyOnClose:!1,children:(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)(r.Accordion,{title:(0,p.jsxs)("div",{className:"py-1 font-bold",children:["Owners (",null===x||void 0===x||null===(a=x.OwnerFutureBooking)||void 0===a?void 0:a.length,")"]}),className:(0,C.m6)("mb-4 border",K?"hidden":"block"),children:(0,p.jsx)(r.Table,{ref:_,data:null!==x&&void 0!==x&&x.OwnerFutureBooking?null===x||void 0===x?void 0:x.OwnerFutureBooking:[],columns:S,pager:(null===x||void 0===x?void 0:x.OwnerFutureBooking)>20,loading:N,keyExpr:"Id",containerClass:"shadow-none border-none rounded-none",tableClass:""})}),(0,p.jsxs)(r.Accordion,{title:(0,p.jsxs)("div",{className:"py-1 font-bold",children:["On Site Employees (",M,")"]}),className:(0,C.m6)("border",K?"mb-0":"mb-4"),children:[(0,p.jsx)("div",{id:"on-site",children:(0,p.jsx)(r.CustomTable,{data:b,keyExpr:"Id",columns:R,onChangePageSize:function(e){return L(e)},onChangePageIndex:function(e){return T(e)},pageSize:V,pageIndex:P,totalCount:M,pagerPosition:"bottom",showColumnLines:!1,pageSizeDisabled:!0,wordWrapEnabled:!0,isPagination:M>100,containerClass:"shadow-none rounded px-0 border-none",tableClass:(0,C.m6)(K?"max-h-[calc(100vh-195px)] rounded-none border-none":"max-h-[500px]")})}),(0,p.jsx)(E.BH,{visible:H,position:{of:"#on-site"}})]}),(0,p.jsx)(r.Accordion,{title:(0,p.jsxs)("div",{className:"py-1 font-bold",children:["Locked Employee in the room (",null===x||void 0===x||null===(t=x.LockedEmployees)||void 0===t?void 0:t.length,")"]}),className:(0,C.m6)("mb-4 border",K?"hidden":"block"),children:(0,p.jsx)(r.Table,{data:null!==x&&void 0!==x&&x.LockedEmployees?null===x||void 0===x?void 0:x.LockedEmployees:[],columns:k,pager:(null===x||void 0===x?void 0:x.OwnerFutureBooking)>20,loading:N,keyExpr:"Id",containerClass:"shadow-none border-none mb-4",tableClass:"border-none"})})]})})}),(function(e,a){return e.open===a.open&&e.selectedDate===a.selectedDate})),O="YYYY-MM-DD";var Z=function(){var e=(0,o.useContext)(m.V),a=e.state,t=e.action,s=(0,o.useState)(null),x=(0,l.Z)(s,2),f=x[0],g=x[1],D=(0,o.useState)(!1),j=(0,l.Z)(D,2),N=j[0],y=j[1],w=(0,o.useState)(!1),Y=(0,l.Z)(w,2),S=Y[0],k=Y[1],R=(0,o.useState)(d()().startOf("month")),I=(0,l.Z)(R,2),E=I[0],Z=I[1],F=(0,o.useState)(new h.Z({key:"RoomId",load:function(e){var t,l,o,r,s,c=null;return(null===(t=e.sort)||void 0===t?void 0:t.length)>0&&(c={sortby:e.sort[0].selector,sortDirection:e.sort[0].desc?"desc":"asc"}),y(!0),(0,i.Z)({method:"post",url:"tas/room/statusbetweendates",data:e.filter&&!b()(null===e||void 0===e?void 0:e.filter)?{model:(0,n.Z)((0,n.Z)({},e.filter),{},{startDate:d()(e.filter.startDate).format("YYYY-MM-DD"),endDate:d()(e.filter.endDate).format("YYYY-MM-DD")}),sort:{sortby:(null===(l=c)||void 0===l?void 0:l.sortby)||"",sortDirection:(null===(o=c)||void 0===o?void 0:o.sortDirection)||""},pageIndex:e.skip/e.take+1,pageSize:e.take}:{model:a.roomSearchValues?(0,n.Z)((0,n.Z)({},a.roomSearchValues),{},{startDate:d()(a.roomSearchValues.startDate).format("YYYY-MM-DD"),endDate:d()(a.roomSearchValues.endDate).format("YYYY-MM-DD")}):{startDate:d()().startOf("month").format("YYYY-MM-DD"),endDate:d()().endOf("month").format("YYYY-MM-DD"),campId:null,roomTypeId:null,private:null,bedCount:null,roomNumber:""},sort:{sortby:(null===(r=c)||void 0===r?void 0:r.sortby)||"",sortDirection:(null===(s=c)||void 0===s?void 0:s.sortDirection)||""},pageIndex:e.skip/e.take+1,pageSize:e.take}}).then((function(e){return{data:e.data.data,totalCount:e.data.totalcount}})).finally((function(){y(!1)}))}})),P=(0,l.Z)(F,1)[0],T=r.Form.useForm(),z=(0,l.Z)(T,1)[0],B=(0,o.useRef)(null);(0,o.useEffect)((function(){a.roomSearchValues&&z.setFieldsValue(a.roomSearchValues)}),[a.roomSearchValues]);var V=(0,o.useCallback)((function(){var e=[];if(z&&E){e=[{label:"Room",name:"RoomNumber",alignment:"left",width:"80px",fixed:"left",allowSorting:!0,cellRender:function(e){return(0,p.jsx)("div",{className:"flex items-center",children:(0,p.jsx)(c.Link,{to:"/tas/roomcalendar/".concat(e.data.RoomId,"/").concat(E.startOf("month").format(O)),children:(0,p.jsx)("span",{className:"text-xs flex items-center gap-3 group cursor-pointer text-blue-500 hover:underline",children:e.value})})})}},{label:"Beds",name:"BedCount",alignment:"left",fixed:"left",width:"30px",allowSorting:!0,cellRender:function(e){return(0,p.jsx)("div",{className:"text-center",children:e.value})}},{label:"",name:"RoowOwners",alignment:"center",fixed:"left",width:"35px",allowSorting:!0,cellRender:function(e){return(0,p.jsx)("div",{className:"text-center",children:e.value})},headerCellRender:function(e){return(0,p.jsx)("i",{className:"dx-icon-home text-green-500"})}}];for(var a=function(a){e.push({label:a,headerCellRender:function(e,t){return(0,p.jsxs)("div",{className:(0,C.m6)("flex flex-col items-center",d()(E).date(a).format("D")===d()().format("D")?"text-blue-400 font-bold":""),children:[(0,p.jsx)("div",{children:d()(E).date(a).format("D")}),(0,p.jsx)("div",{className:"text-[10px] leading-none",children:d()(E).date(a).format("dd")})]})},name:"OccupancyData.".concat(d()(E).date(a).format(O),".ActiveBeds"),alignment:"center",allowSorting:!1,cellRender:function(e){return(0,p.jsx)(v,{event:e,index:a,currentDate:E,selectedDate:f,handleSelectDate:L})}})},t=1;t<=d()(E).daysInMonth();t++)a(t)}return e}),[z,E]),L=function(e,a,t,n,l){var o;(null===l||void 0===l||l.stopPropagation(),e!==(null===f||void 0===f?void 0:f.roomId)||a!==(null===f||void 0===f?void 0:f.date))&&(k(!0),g({roomId:e,date:a,roomNumber:null===(o=t.data)||void 0===o?void 0:o.RoomNumber}))},A=(0,o.useMemo)((function(){var e;return[{label:"Month",name:"startDate",className:"col-span-12 xl:col-span-3 2xl:col-span-3 mb-2",type:"date",rules:[{required:!0,message:"Month is required"}],inputprops:{allowClear:!1,picker:"month"}},{label:"Camp",name:"campId",className:"col-span-12 xl:col-span-3 2xl:col-span-3 mb-2",type:"select",inputprops:{options:null===(e=a.referData)||void 0===e?void 0:e.camps}},{label:"Room Type",name:"roomTypeId",className:"col-span-12 xl:col-span-3 2xl:col-span-3 mb-2",type:"select",depindex:"campId",inputprops:{optionsurl:"tas/roomtype?active=1&campId=",loading:a.customLoading,optionvalue:"Id",optionlabel:"Description"}},{label:"Room Number",name:"roomNumber",className:"col-span-12 xl:col-span-3 2xl:col-span-3 mb-2"},{label:"Bed Count",name:"bedCount",className:"col-span-12 xl:col-span-3 2xl:col-span-3 mb-2",type:"number",inputprops:{min:0}},{label:"Private",name:"private",className:"col-span-12 xl:col-span-3 2xl:col-span-2 mb-2",type:"check",inputprops:{indeterminatewith:!0}},{label:"Locked Room",name:"locked",className:"col-span-12 xl:col-span-3 2xl:col-span-2 mb-2",type:"check",inputprops:{indeterminatewith:!0}},{label:"Has Owner",name:"hasOwner",className:"col-span-12 xl:col-span-3 2xl:col-span-2 mb-2",type:"check",inputprops:{indeterminatewith:!0}}]}),[a]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"rounded-ot",children:[(0,p.jsx)("div",{className:"flex gap-4 items-start z-50",children:(0,p.jsx)(r.Form,{form:z,fields:A,className:"flex-1 grid grid-cols-12 gap-x-5 border p-3 rounded-ot bg-white shadow-card",onFinish:function(e){var a;Z(d()(e.startDate).startOf("month"));var l=(0,n.Z)((0,n.Z)({},e),{},{startDate:d()(e.startDate).startOf("month"),endDate:d()(e.startDate).endOf("month")});null===(a=B.current)||void 0===a||a.instance.filter(l),t.saveRoomSearchValues(l)},noLayoutConfig:!0,initValues:{startDate:d()().startOf("month"),private:null,locked:null,hasOwner:null},children:(0,p.jsx)("div",{className:"col-span-12 flex justify-end",children:(0,p.jsx)(r.Button,{className:"py-0",htmlType:"submit",type:"primary",loading:N,children:"Search"})})})}),(0,p.jsx)("div",{className:"mt-5 flex gap-4 items-start",children:(0,p.jsx)(u.Z,{ref:B,data:P,columns:V(f),focusedRowEnabled:!1,remoteOperations:!0,containerClass:"shadow-none flex-1 border",tableClass:"max-h-[calc(100vh-280px)] border-t",scrolling:!0,allowColumnReordering:!1,title:(0,p.jsxs)("div",{className:"flex justify-end gap-5 my-2",children:[(0,p.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[(0,p.jsx)("div",{className:"h-3 w-6 bg-[#ebedf0] rounded"}),"Full"]}),(0,p.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[(0,p.jsx)("div",{className:"h-3 w-6 bg-[#fadb14] rounded"}),"Have a person"]}),(0,p.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[(0,p.jsx)("div",{className:"h-3 w-6 bg-[#00c75e] rounded"}),"Empty"]}),(0,p.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[(0,p.jsx)("div",{className:"h-3 w-6 bg-[#ff5b5b] rounded"}),"Double"]}),(0,p.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[(0,p.jsx)("i",{className:"dx-icon-home text-green-500 "}),"Owner"]}),(0,p.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[(0,p.jsx)("i",{className:"dx-icon-home text-gray-400"}),"Guest"]})]})})})]}),(0,p.jsx)(M,{open:S,handleCloseDrawer:function(){k(!1)},store:a,selectedDate:f})]})}}}]);