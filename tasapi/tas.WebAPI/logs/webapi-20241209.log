2024-12-09 09:30:38.484 +08:00  ERR  An unhandled exception has occurred while executing the request.System.InvalidOperationException: The LINQ expression 'DbSet<RequestDocument>()
    .Where(r => DbSet<RequestDocument>()
        .Where(r0 => !(__NotAllowDocs_0
            .Contains(r0.CurrentAction)))
        .Where(r0 => r0.Active == 1)
        .Contains(r))
    .LeftJoin(
        inner: DbSet<Employee>(), 
        outerKeySelector: r => (object)r.UserIdCreated, 
        innerKeySelector: e0 => (object)(int?)e0.Id, 
        resultSelector: (r, e0) => new TransparentIdentifier<RequestDocument, Employee>(
            Outer = r, 
            Inner = e0
        ))
    .LeftJoin(
        inner: DbSet<Employee>(), 
        outerKeySelector: ti => (object)ti.Outer.EmployeeId, 
        innerKeySelector: e1 => (object)(int?)e1.Id, 
        resultSelector: (ti, e1) => new TransparentIdentifier<TransparentIdentifier<RequestDocument, Employee>, Employee>(
            Outer = ti, 
            Inner = e1
        ))
    .LeftJoin(
        inner: DbSet<Employer>(), 
        outerKeySelector: ti0 => (object)ti0.Inner.EmployerId, 
        innerKeySelector: e2 => (object)(int?)e2.Id, 
        resultSelector: (ti0, e2) => new TransparentIdentifier<TransparentIdentifier<TransparentIdentifier<RequestDocument, Employee>, Employee>, Employer>(
            Outer = ti0, 
            Inner = e2
        ))
    .LeftJoin(
        inner: DbSet<Employee>(), 
        outerKeySelector: ti1 => (object)ti1.Outer.Outer.Outer.UserIdUpdated, 
        innerKeySelector: e3 => (object)(int?)e3.Id, 
        resultSelector: (ti1, e3) => new TransparentIdentifier<TransparentIdentifier<TransparentIdentifier<TransparentIdentifier<RequestDocument, Employee>, Employee>, Employer>, Employee>(
            Outer = ti1, 
            Inner = e3
        ))
    .OrderBy(ti2 => (int?)ti2.Outer.Outer.Outer.Outer.DaysAwayDate.HasValue ? DateTime.Now.Subtract(ti2.Outer.Outer.Outer.Outer.DaysAwayDate.Value).Days * -1 : DateTime.Now.Subtract(ti2.Outer.Outer.Outer.Outer.DateCreated.Value).Days * -1)' could not be translated. Additional information: Translation of method 'System.DateTime.Subtract' failed. If this method can be mapped to your custom function, see https://go.microsoft.com/fwlink/?linkid=2132413 for more information.
Translation of method 'System.DateTime.Subtract' failed. If this method can be mapped to your custom function, see https://go.microsoft.com/fwlink/?linkid=2132413 for more information. Either rewrite the query in a form that can be translated, or switch to client evaluation explicitly by inserting a call to 'AsEnumerable', 'AsAsyncEnumerable', 'ToList', or 'ToListAsync'. See https://go.microsoft.com/fwlink/?linkid=2101038 for more information.
   at Microsoft.EntityFrameworkCore.Query.QueryableMethodTranslatingExpressionVisitor.Translate(Expression expression)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutor[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Storage.Database.CompileQuery[TResult](Expression query, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.CompileQueryCore[TResult](IDatabase database, Expression query, IModel model, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.<>c__DisplayClass11_0`1.<ExecuteCore>b__0()
   at Microsoft.EntityFrameworkCore.Query.Internal.CompiledQueryCache.GetOrAddQuery[TResult](Object cacheKey, Func`1 compiler)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteCore[TResult](Expression query, Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteAsync[TResult](Expression query, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.ExecuteAsync[TResult](Expression expression, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryable`1.GetAsyncEnumerator(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.ConfiguredCancelableAsyncEnumerable`1.GetAsyncEnumerator()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at tas.Persistence.Repositories.RequestDocumentRepository.GetDocumentListCancelled(GetDocumentListCancelledRequest request, CancellationToken cancellationToken) in D:\00 Fractal\Development\OT\V8\tas.WebAPI\tas.Persistence\Repositories\RequestDocumentRepository.cs:line 1916
   at tas.Application.Features.RequestDocumentFeature.GetDocumentListCancelled.GetDocumentListCancelledHandler.Handle(GetDocumentListCancelledRequest request, CancellationToken cancellationToken) in D:\00 Fractal\Development\OT\V8\tas.WebAPI\tas.Application\Features\RequestDocumentFeature\GetDocumentListCancelled\GetDocumentListCancelledHandler.cs:line 21
   at tas.Application.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\00 Fractal\Development\OT\V8\tas.WebAPI\tas.Application\Common\Behaviors\ValidatorBehavior.cs:line 24
   at MediatR.Pipeline.RequestExceptionProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestExceptionProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestExceptionActionProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestExceptionActionProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestPostProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestPreProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at tas.WebAPI.Controllers.Tas.RequestDocumentController.DocumentListCancelled(GetDocumentListCancelledRequest request, CancellationToken cancellationToken) in D:\00 Fractal\Development\OT\V8\tas.WebAPI\tas.WebAPI\Controllers\Tas\RequestDocumentController.cs:line 75
   at lambda_method530(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)

2024-12-09 09:31:43.605 +08:00  ERR  An unhandled exception has occurred while executing the request.System.InvalidOperationException: The LINQ expression 'DbSet<RequestDocument>()
    .Where(r => DbSet<RequestDocument>()
        .Where(r0 => !(__NotAllowDocs_0
            .Contains(r0.CurrentAction)))
        .Where(r0 => r0.Active == 1)
        .Contains(r))
    .LeftJoin(
        inner: DbSet<Employee>(), 
        outerKeySelector: r => (object)r.UserIdCreated, 
        innerKeySelector: e0 => (object)(int?)e0.Id, 
        resultSelector: (r, e0) => new TransparentIdentifier<RequestDocument, Employee>(
            Outer = r, 
            Inner = e0
        ))
    .LeftJoin(
        inner: DbSet<Employee>(), 
        outerKeySelector: ti => (object)ti.Outer.EmployeeId, 
        innerKeySelector: e1 => (object)(int?)e1.Id, 
        resultSelector: (ti, e1) => new TransparentIdentifier<TransparentIdentifier<RequestDocument, Employee>, Employee>(
            Outer = ti, 
            Inner = e1
        ))
    .LeftJoin(
        inner: DbSet<Employer>(), 
        outerKeySelector: ti0 => (object)ti0.Inner.EmployerId, 
        innerKeySelector: e2 => (object)(int?)e2.Id, 
        resultSelector: (ti0, e2) => new TransparentIdentifier<TransparentIdentifier<TransparentIdentifier<RequestDocument, Employee>, Employee>, Employer>(
            Outer = ti0, 
            Inner = e2
        ))
    .LeftJoin(
        inner: DbSet<Employee>(), 
        outerKeySelector: ti1 => (object)ti1.Outer.Outer.Outer.UserIdUpdated, 
        innerKeySelector: e3 => (object)(int?)e3.Id, 
        resultSelector: (ti1, e3) => new TransparentIdentifier<TransparentIdentifier<TransparentIdentifier<TransparentIdentifier<RequestDocument, Employee>, Employee>, Employer>, Employee>(
            Outer = ti1, 
            Inner = e3
        ))
    .OrderBy(ti2 => (int?)ti2.Outer.Outer.Outer.Outer.DaysAwayDate.HasValue ? DateTime.Now.Subtract(ti2.Outer.Outer.Outer.Outer.DaysAwayDate.Value).Days * -1 : DateTime.Now.Subtract(ti2.Outer.Outer.Outer.Outer.DateCreated.Value).Days * -1)' could not be translated. Additional information: Translation of method 'System.DateTime.Subtract' failed. If this method can be mapped to your custom function, see https://go.microsoft.com/fwlink/?linkid=2132413 for more information.
Translation of method 'System.DateTime.Subtract' failed. If this method can be mapped to your custom function, see https://go.microsoft.com/fwlink/?linkid=2132413 for more information. Either rewrite the query in a form that can be translated, or switch to client evaluation explicitly by inserting a call to 'AsEnumerable', 'AsAsyncEnumerable', 'ToList', or 'ToListAsync'. See https://go.microsoft.com/fwlink/?linkid=2101038 for more information.
   at Microsoft.EntityFrameworkCore.Query.QueryableMethodTranslatingExpressionVisitor.Translate(Expression expression)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutor[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Storage.Database.CompileQuery[TResult](Expression query, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.CompileQueryCore[TResult](IDatabase database, Expression query, IModel model, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.<>c__DisplayClass11_0`1.<ExecuteCore>b__0()
   at Microsoft.EntityFrameworkCore.Query.Internal.CompiledQueryCache.GetOrAddQuery[TResult](Object cacheKey, Func`1 compiler)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteCore[TResult](Expression query, Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteAsync[TResult](Expression query, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.ExecuteAsync[TResult](Expression expression, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryable`1.GetAsyncEnumerator(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.ConfiguredCancelableAsyncEnumerable`1.GetAsyncEnumerator()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at tas.Persistence.Repositories.RequestDocumentRepository.GetDocumentListCancelled(GetDocumentListCancelledRequest request, CancellationToken cancellationToken) in D:\00 Fractal\Development\OT\V8\tas.WebAPI\tas.Persistence\Repositories\RequestDocumentRepository.cs:line 1916
   at tas.Application.Features.RequestDocumentFeature.GetDocumentListCancelled.GetDocumentListCancelledHandler.Handle(GetDocumentListCancelledRequest request, CancellationToken cancellationToken) in D:\00 Fractal\Development\OT\V8\tas.WebAPI\tas.Application\Features\RequestDocumentFeature\GetDocumentListCancelled\GetDocumentListCancelledHandler.cs:line 21
   at tas.Application.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in D:\00 Fractal\Development\OT\V8\tas.WebAPI\tas.Application\Common\Behaviors\ValidatorBehavior.cs:line 24
   at MediatR.Pipeline.RequestExceptionProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestExceptionProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestExceptionActionProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestExceptionActionProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestPostProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at MediatR.Pipeline.RequestPreProcessorBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken)
   at tas.WebAPI.Controllers.Tas.RequestDocumentController.DocumentListCancelled(GetDocumentListCancelledRequest request, CancellationToken cancellationToken) in D:\00 Fractal\Development\OT\V8\tas.WebAPI\tas.WebAPI\Controllers\Tas\RequestDocumentController.cs:line 75
   at lambda_method530(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)

